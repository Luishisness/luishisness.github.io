/************************************************************* 
Benevoltek Klixel8® Image Map Collection Data Processing
Copyright (©) 2016 Benevoltek, Inc. All Rights Reserved
v2.0.1
**************************************************************/

/*
 * OpenSeadragon
 *
 * Copyright (C) 2009 CodePlex Foundation
 * Copyright (C) 2010-2013 OpenSeadragon contributors
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * - Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * - Neither the name of CodePlex Foundation nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Portions of this source file taken from jQuery:
 *
 * Copyright 2011 John Resig
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

/*
 * Portions of this source file taken from mattsnider.com:
 *
 * Copyright (c) 2006-2013 Matt Snider
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
 * OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR
 * THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
 
 
function K8Image(h,g,d){this.div=h;this.aspectRatio;this.osd;this.c=-1;this.lastMove=-1;this.lastLayer;this.p;this.zoomLevel;this.lastZoomTime=0;this.panCenterX=.5;this.panCenterY=.5;this.lastPanTime=0;this.doneLoading=false;this.pointerStartTime=0;this.pointerStartX;this.pointerStartY;this.isDoing="";this.pressAndHoldTime=3e3;this.panTime=500;this.moveThreshold=10;var i="http://app.klixel8.com/images/flatbtns",j=encodeURIComponent(i),c,a,b=g.split("?");this.K8Src="https://img.klixel8.com/"+b[0].trim();if(b[1])for(var e=b[1].trim().split("&"),d=0;d<e.length;d++){var f=e[d].split("=");c=f[0].trim();a=decodeURIComponent(f[1]).trim();if(c=="buttons"){if(a.substring(a.length-1)!="/")a+="/";this.buttons=a}else if(c=="initialZoom")this.defaultZoomLevel=a}this.init()}window.addEventListener("load",function(){for(var b=document.getElementsByTagName("div"),a=0;a<b.length;a++)b[a].getAttribute("data-klixel8src")&&new K8Image(b[a],b[a].getAttribute("data-klixel8src"),a)});K8Image.prototype.init=function(){var a=this;if(window.addEventListener)this.div.addEventListener("contextmenu",function(b){var a=b?b:window.event;if(a.preventDefault)a.preventDefault();else a.returnValue=false},false);else window.attachEvent&&this.div.attachEvent("oncontextmenu",function(b){var a=b?b:window.event;if(a.preventDefault)a.preventDefault();else a.returnValue=false});if(window.XDomainRequest){this.K8Src=this.K8Src.replace("https:","http:");this.xhr=new window.XDomainRequest;this.xhr.onload=function(){var b=a.loadP();if(b){typeof klixel8Status=="function"&&klixel8Status({message:"unable to fetch "+a.K8Src});this.osd.style.visibility="hidden"}};this.xhr.open("GET",a.K8Src+"/0.gz",true);this.xhr.send()}else{this.xhr=new XMLHttpRequest;this.xhr.onreadystatechange=function(){if(a.xhr.readyState===4)if(a.xhr.status===200)var b=a.loadP();else{typeof klixel8Status=="function"&&klixel8Status({message:"unable to fetch "+a.K8Src});this.div.onfocus=function(){this.style.outline=0}}};this.xhr.open("GET",a.K8Src+"/0.gz");this.xhr.send(null)}};K8Image.prototype.K8Pan=function(c,a){var b=c.source.dimensions,d={x:Math.round(a.x*b.x),y:Math.round(a.y*b.x)};if(this.findItem(d))layerName=this.p[1][0][this.c][0];else{this.c=-1;layerName="None"}typeof(klixel8Pan=="function")&&klixel8Pan({imgNum:c.parentObj.p[0][3],hsNum:this.c,layerName:layerName})};K8Image.prototype.K8Zoom=function(a,b){typeof klixel8Zoom=="function"&&klixel8Zoom({imgNum:a.parentObj.p[0][3],zoomLevel:b})};K8Image.prototype.loadP=function(){try{this.p=JSON.parse(this.xhr.responseText)}catch(e){delete this.xhr;return "parse error"}delete this.xhr;try{for(var b=0;b<this.p[0][7];b++)for(var a=1;a<=this.p[0][8];a++){this.p[1][b][a][4]=this.p[1][b][a][2]+this.p[1][b][a][4]-1;this.p[1][b][a][5]=this.p[1][b][a][3]+this.p[1][b][a][5]-1;this.p[1][b][a][6]=unescape(this.p[1][b][a][6])}}catch(e){return "processing error"}this.osd=OpenSeadragon({parentObj:this,element:this.div,prefixUrl:this.buttons?this.buttons:"https://rs.klixel8.com/images/os/",defaultZoomLevel:this.defaultZoomLevel?this.defaultZoomLevel:0,tileSources:this.K8Src+"/0.xml",tabIndex:-1,showNavigator:false,showFullPageControl:false,showNavigationControl:true,hideNavCtrlPx:this.hideNavCtrlPx?this.hideNavCtrlPx:200,navigationControlAnchor:2,zoomPerClick:1.6,minZoomLevel:1,maxZoomLevel:4,visibilityRatio:1,constrainDuringPan:true,springStiffness:1,animationTime:0,clickTimeThreshold:300,dblClickTimeThreshold:300,gestureSettingsMouse:{clickToZoom:false,dblClickToZoom:true},gestureSettingsTouch:{dblClickToZoom:true,pinchToZoom:true,flickEnabled:true,flickMomentum:.125,flickMinSpeed:60},panHorizontal:true,panVertical:true});this.osd.addHandler("tile-load-failed",function(a){typeof klixel8Status=="function"&&klixel8Status({message:"unable to fetch "+a.eventSource.parentObj.src});a.eventSource.buttons.element.style.visibility="hidden"});this.osd.addHandler("pan",function(a){if(a.eventSource.parentObj.p==undefined)return;if(!a.eventSource.parentObj.doneLoading)return;if(Math.abs(a.eventSource.viewport._oldCenterX-a.eventSource.parentObj.panCenterX)<.001&&Math.abs(a.eventSource.viewport._oldCenterY-a.eventSource.parentObj.panCenterY)<.001)return;a.eventSource.parentObj.panCenterX=a.eventSource.viewport._oldCenterX;a.eventSource.parentObj.panCenterY=a.eventSource.viewport._oldCenterY;a.eventSource.parentObj.K8Pan(a.eventSource,a.center)});this.osd.addHandler("zoom",function(a){if(!a.eventSource.parentObj.doneLoading){if(a.eventSource.minZoomImageRatio-a.zoom<.01){a.eventSource.parentObj.doneLoading=true;a.eventSource.parentObj.panCenterX=a.eventSource.viewport._oldCenterX;a.eventSource.parentObj.panCenterY=a.eventSource.viewport._oldCenterY;a.eventSource.parentObj.zoomLevel=a.zoom}return}var b=(new Date).getTime();if(b-a.eventSource.parentObj.lastZoomTime<10)return;if(Math.abs(a.eventSource.parentObj.zoomLevel-a.zoom)<.01||a.zoom<a.eventSource.minZoomLevel-.01||a.zoom>a.eventSource.maxZoomLevel+.01)return;a.eventSource.parentObj.zoomLevel=a.zoom;a.eventSource.parentObj.lastZoomTime=b;a.eventSource.parentObj.K8Zoom(a.eventSource,a.zoom)});this.osd.canvas.onfocus=function(){this.style.outline=0};var c=this.div.currentStyle||window.getComputedStyle(this.div,false);if(c.backgroundImage=="none")this.div.style.backgroundImage='url("'+this.K8Src+'/0.jpg")';var d=new Image,f=this;d.onload=function(){f.loadImg(this)};d.src=c.backgroundImage.slice(5,c.backgroundImage.length-2)};K8Image.prototype.loadImg=function(a){this.div.setAttribute("k8aspectratio",a.height/a.width);this.div.style.backgroundSize="cover";this.div.style.height=this.div.clientWidth*a.height/a.width+"px"};K8Image.prototype.k8Move=function(b,d,c){var a;if(this.findItem(d))b.canvas.style.cursor="pointer";else{this.c=-1;b.canvas.style.cursor="auto"}if(this.c>-1)a=this.p[1][0][this.c][0];else a="None";typeof(klixel8Move=="function")&&klixel8Move({imgNum:this.p[0][3],hsNum:this.c,point:c,layerName:a});this.lastMove=this.c;this.lastLayer=a};K8Image.prototype.k8PressAndHold=function(d,b){var a,c=this.findItem(d);if(c==true)a=this.p[1][0][this.c][0];else{this.c=-1;a="None"}typeof(klixel8PressAndHold=="function")&&klixel8PressAndHold({imgNum:this.p[0][3],hsNum:this.c,point:b,layerName:a})};K8Image.prototype.k8Click=function(b,e,c,a){var d=this.findItem(e);if(d==true){if(a!=true)b.canvas.style.cursor="pointer";layerName=this.p[1][0][this.c][0]}else{this.c=-1;b.canvas.style.cursor="auto";layerName="None"}typeof(klixel8Click=="function")&&klixel8Click({imgNum:this.p[0][3],hsNum:this.c,point:c,layerName:layerName,shift:a})};K8Image.prototype.k8ContextMenu=function(e,c,a,d){var b=this.findItem(c);if(b==true)layerName=this.p[1][0][this.c][0];else{this.c=-1;layerName="None"}typeof(klixel8ContextMenu=="function")&&klixel8ContextMenu({imgNum:this.p[0][3],hsNum:this.c,point:a,layerName:layerName,shift:d})};K8Image.prototype.k8DoubleClick=function(e,b,c){var a,d=this.findItem(b);if(d!=true){this.c=-1;a="None"}else a=this.p[1][0][this.c][0];typeof(klixel8DoubleClick=="function")&&klixel8DoubleClick({imgNum:this.p[0][3],hsNum:this.c,point:b,position:c,layerName:a})};K8Image.prototype.findItem=function(f){if(this.p==undefined)return false;if(this.p[1][0]==undefined)return false;for(var b=false,c=f.x,d=f.y,a=1;a<=this.p[0][8];a++){switch(this.p[1][0][a][1]){case 0:b=false;break;case 1:b=false;break;case 2:if(c>=this.p[1][0][a][2]&&c<=this.p[1][0][a][4]&&d>=this.p[1][0][a][3]&&d<=this.p[1][0][a][5])b=true;else b=false;break;default:var e=(d-this.p[1][0][a][3])*(this.p[1][0][a][4]-this.p[1][0][a][2]+1)+(c-this.p[1][0][a][2]);if(c>=this.p[1][0][a][2]&&c<=this.p[1][0][a][4]&&d>=this.p[1][0][a][3]&&d<=this.p[1][0][a][5]&&Boolean(String(this.p[1][0][a][6]).charCodeAt(Math.floor(e/8))&Math.pow(2,(e/8-Math.floor(e/8))*8)))b=true;else b=false}if(b==true)break}this.c=a;return b};window.OpenSeadragon=window.OpenSeadragon||function(a){return new OpenSeadragon.Viewer(a)};typeof define==="function"&&define.amd&&define(function(){return window.OpenSeadragon});(function(a){a.version={versionStr:"<%= osdVersion.versionStr %>",major:parseInt("<%= osdVersion.major %>",10),minor:parseInt("<%= osdVersion.minor %>",10),revision:parseInt("<%= osdVersion.revision %>",10)};var c={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},d=Object.prototype.toString,b=Object.prototype.hasOwnProperty;a.isFunction=function(b){return a.type(b)==="function"};a.isArray=Array.isArray||function(b){return a.type(b)==="array"};a.isWindow=function(a){return a&&typeof a==="object"&&"setInterval" in a};a.type=function(a){return a===null||a===undefined?String(a):c[d.call(a)]||"object"};a.isPlainObject=function(c){if(!c||OpenSeadragon.type(c)!=="object"||c.nodeType||a.isWindow(c))return false;if(c.constructor&&!b.call(c,"constructor")&&!b.call(c.constructor.prototype,"isPrototypeOf"))return false;var d;for(var e in c)d=e;return d===undefined||b.call(c,d)};a.isEmptyObject=function(a){for(var b in a)return false;return true};a.supportsCanvas=function(){var b=document.createElement("canvas");return !!(a.isFunction(b.getContext)&&b.getContext("2d"))}();a.isCanvasTainted=function(b){var a=false;try{var d=b.getContext("2d").getImageData(0,0,1,1)}catch(c){a=true}return a};a.pixelDensityRatio=function(){if(a.supportsCanvas){var b=document.createElement("canvas").getContext("2d"),d=window.devicePixelRatio||1,c=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return d/c}else return 1}()})(OpenSeadragon);(function($){$.extend=function(){var e,f,c,b,g,h,a=arguments[0]||{},j=arguments.length,i=false,d=1;if(typeof a==="boolean"){i=a;a=arguments[1]||{};d=2}if(typeof a!=="object"&&!OpenSeadragon.isFunction(a))a={};if(j===d){a=this;--d}for(;d<j;d++){e=arguments[d];if(e!==null||e!==undefined)for(f in e){c=a[f];b=e[f];if(a===b)continue;if(i&&b&&(OpenSeadragon.isPlainObject(b)||(g=OpenSeadragon.isArray(b)))){if(g){g=false;h=c&&OpenSeadragon.isArray(c)?c:[]}else h=c&&OpenSeadragon.isPlainObject(c)?c:{};a[f]=OpenSeadragon.extend(i,h,b)}else if(b!==undefined)a[f]=b}}return a};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:false,ajaxWithCredentials:false,panHorizontal:true,panVertical:true,constrainDuringPan:false,wrapHorizontal:false,wrapVertical:false,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:false,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:true,clickToZoom:true,dblClickToZoom:false,pinchToZoom:false,flickEnabled:false,flickMinSpeed:120,flickMomentum:.25,pinchRotate:false},gestureSettingsTouch:{scrollToZoom:false,clickToZoom:false,dblClickToZoom:true,pinchToZoom:true,flickEnabled:true,flickMinSpeed:120,flickMomentum:.25,pinchRotate:false},gestureSettingsPen:{scrollToZoom:false,clickToZoom:true,dblClickToZoom:false,pinchToZoom:false,flickEnabled:false,flickMinSpeed:120,flickMomentum:.25,pinchRotate:false},gestureSettingsUnknown:{scrollToZoom:false,clickToZoom:false,dblClickToZoom:true,pinchToZoom:true,flickEnabled:true,flickMinSpeed:120,flickMomentum:.25,pinchRotate:false},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:false,autoHideControls:true,immediateRender:false,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,pixelsPerWheelLine:40,autoResize:true,preserveImageSizeOnResize:false,minScrollDeltaTime:50,showSequenceControl:true,sequenceControlAnchor:null,preserveViewport:false,preserveOverlays:false,navPrevNextWrap:false,showNavigationControl:true,navigationControlAnchor:null,showZoomControl:true,showHomeControl:true,showFullPageControl:true,showRotationControl:false,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:true,showNavigator:false,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:false,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:true,navigatorRotate:true,degrees:0,opacity:1,placeholderFillStyle:null,showReferenceStrip:false,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:false,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:true,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:false,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(b,a){return function(){var c=arguments;if(c===undefined)c=[];return a.apply(b,c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(a){if(typeof a=="string")a=document.getElementById(a);return a},getElementPosition:function(a){var c=new $.Point,b,d;a=$.getElement(a);b=$.getElementStyle(a).position=="fixed";d=getOffsetParent(a,b);while(d){c.x+=a.offsetLeft;c.y+=a.offsetTop;if(b)c=c.plus($.getPageScroll());a=d;b=$.getElementStyle(a).position=="fixed";d=getOffsetParent(a,b)}return c},getElementOffset:function(b){b=$.getElement(b);var a=b&&b.ownerDocument,c,e,d={top:0,left:0};if(!a)return new $.Point;c=a.documentElement;if(typeof b.getBoundingClientRect!==typeof undefined)d=b.getBoundingClientRect();e=a==a.window?a:a.nodeType===9?a.defaultView||a.parentWindow:false;return new $.Point(d.left+(e.pageXOffset||c.scrollLeft)-(c.clientLeft||0),d.top+(e.pageYOffset||c.scrollTop)-(c.clientTop||0))},getElementSize:function(a){a=$.getElement(a);return new $.Point(a.clientWidth,a.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(a){a=$.getElement(a);return a.currentStyle}:function(a){a=$.getElement(a);return window.getComputedStyle(a,"")},pointInElement:function(a,c){a=$.getElement(a);var b=$.getElementOffset(a),d=$.getElementSize(a);return c.x>=b.x&&c.x<b.x+d.x&&c.y<b.y+d.y&&c.y>=b.y},getEvent:function(a){if(a)$.getEvent=function(a){return a};else $.getEvent=function(){return window.event};return $.getEvent(a)},getMousePosition:function(a){if(typeof a.pageX=="number")$.getMousePosition=function(a){var b=new $.Point;a=$.getEvent(a);b.x=a.pageX;b.y=a.pageY;return b};else if(typeof a.clientX=="number")$.getMousePosition=function(a){var b=new $.Point;a=$.getEvent(a);b.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;b.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return b};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(a)},getPageScroll:function(){var a=document.documentElement||{},b=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(b.scrollLeft||b.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(a.scrollLeft||a.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(a){if(typeof window.scrollTo!=="undefined")$.setPageScroll=function(a){window.scrollTo(a.x,a.y)};else{var b=$.getPageScroll();if(b.x===a.x&&b.y===a.y)return;document.body.scrollLeft=a.x;document.body.scrollTop=a.y;var c=$.getPageScroll();if(c.x!==b.x&&c.y!==b.y){$.setPageScroll=function(a){document.body.scrollLeft=a.x;document.body.scrollTop=a.y};return}document.documentElement.scrollLeft=a.x;document.documentElement.scrollTop=a.y;c=$.getPageScroll();if(c.x!==b.x&&c.y!==b.y){$.setPageScroll=function(a){document.documentElement.scrollLeft=a.x;document.documentElement.scrollTop=a.y};return}$.setPageScroll=function(){}}return $.setPageScroll(a)},getWindowSize:function(){var a=document.documentElement||{},b=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(a.clientWidth||a.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(b.clientWidth||b.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(b){b=$.getElement(b);var a=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];$.extend(a[0].style,{display:"table",height:"100%",width:"100%"});$.extend(a[1].style,{display:"table-row"});$.extend(a[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"});a[0].appendChild(a[1]);a[1].appendChild(a[2]);a[2].appendChild(b);return a[0]},makeNeutralElement:function(c){var b=document.createElement(c),a=b.style;a.background="transparent none";a.border="none";a.margin="0px";a.padding="0px";a.position="static";return b},now:function(){if(Date.now)$.now=Date.now;else $.now=function(){return (new Date).getTime()};return $.now()},makeTransparentImage:function(a){$.makeTransparentImage=function(b){var a=$.makeNeutralElement("img");a.src=b;return a};if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7)$.makeTransparentImage=function(c){var b=$.makeNeutralElement("img"),a=null;a=$.makeNeutralElement("span");a.style.display="inline-block";b.onload=function(){a.style.width=a.style.width||b.width+"px";a.style.height=a.style.height||b.height+"px";b.onload=null;b=null};b.src=c;a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"', sizingMethod='scale')";return a};return $.makeTransparentImage(a)},setElementOpacity:function(b,a,e){var c,d;b=$.getElement(b);if(e&&!$.Browser.alpha)a=Math.round(a);if($.Browser.opacity)b.style.opacity=a<1?a:"";else if(a<1){c=Math.round(100*a);d="alpha(opacity="+c+")";b.style.filter=d}else b.style.filter=""},setElementTouchActionNone:function(a){a=$.getElement(a);if(typeof a.style.touchAction!=="undefined")a.style.touchAction="none";else if(typeof a.style.msTouchAction!=="undefined")a.style.msTouchAction="none"},addClass:function(a,b){a=$.getElement(a);if(!a.className)a.className=b;else if((" "+a.className+" ").indexOf(" "+b+" ")===-1)a.className+=" "+b},indexOf:function(c,a,b){if(Array.prototype.indexOf)this.indexOf=function(c,a,b){return c.indexOf(a,b)};else this.indexOf=function(d,f,e){var c,b=e?e:0,a;if(!d)throw new TypeError;a=d.length;if(a===0||b>=a)return -1;if(b<0)b=a-Math.abs(b);for(c=b;c<a;c++)if(d[c]===f)return c;return -1};return this.indexOf(c,a,b)},removeClass:function(c,e){var b,d=[],a;c=$.getElement(c);b=c.className.split(/\s+/);for(a=0;a<b.length;a++)b[a]&&b[a]!==e&&d.push(b[a]);c.className=d.join(" ")},addEvent:function(){if(window.addEventListener)return function(a,c,d,b){a=$.getElement(a);a.addEventListener(c,d,b)};else if(window.attachEvent)return function(a,b,c){a=$.getElement(a);a.attachEvent("on"+b,c)};else throw new Error("No known event model.");}(),removeEvent:function(){if(window.removeEventListener)return function(a,c,d,b){a=$.getElement(a);a.removeEventListener(c,d,b)};else if(window.detachEvent)return function(a,b,c){a=$.getElement(a);a.detachEvent("on"+b,c)};else throw new Error("No known event model.");}(),cancelEvent:function(a){a=$.getEvent(a);if(a.preventDefault)$.cancelEvent=function(a){a.preventDefault()};else $.cancelEvent=function(a){a=$.getEvent(a);a.cancel=true;a.returnValue=false};$.cancelEvent(a)},stopEvent:function(a){a=$.getEvent(a);if(a.stopPropagation)$.stopEvent=function(a){a.stopPropagation()};else $.stopEvent=function(a){a=$.getEvent(a);a.cancelBubble=true};$.stopEvent(a)},createCallback:function(d,c){for(var b=[],a=2;a<arguments.length;a++)b.push(arguments[a]);return function(){for(var e=b.concat([]),a=0;a<arguments.length;a++)e.push(arguments[a]);return c.apply(d,e)}},getUrlParameter:function(b){var a=URLPARAMS[b];return a?a:null},getUrlProtocol:function(b){var a=b.match(/^([a-z]+:)\/\//i);if(a===null)return window.location.protocol;return a[1].toLowerCase()},createAjaxRequest:function(b){var a;try{a=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=false}if(a)if(window.XMLHttpRequest)$.createAjaxRequest=function(a){if(a)return new ActiveXObject("Microsoft.XMLHTTP");return new XMLHttpRequest};else $.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(b)},makeAjaxRequest:function(b,f,c){var h;if($.isPlainObject(b)){f=b.success;c=b.error;h=b.withCredentials;b=b.url}var g=$.getUrlProtocol(b),a=$.createAjaxRequest(g==="file:");if(!$.isFunction(f))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){if(a.readyState==4){a.onreadystatechange=function(){};if(a.status===200||a.status===0&&g!=="http:"&&g!=="https:")f(a);else{$.console.log("AJAX request returned %d: %s",a.status,b);$.isFunction(c)&&c(a)}}};if(h)a.withCredentials=true;try{a.open("GET",b,true);a.send(null)}catch(e){var i=e.message,j=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(j&&typeof e.number!="undefined"&&e.number==-2147024891)i+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain";$.console.log("%s while making AJAX request: %s",e.name,i);a.onreadystatechange=function(){};if(window.XDomainRequest){var d=new XDomainRequest;if(d){d.onload=function(){$.isFunction(f)&&f({responseText:d.responseText,status:200,statusText:"OK"})};d.onerror=function(){$.isFunction(c)&&c({responseText:d.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{d.open("GET",b);d.send()}catch(k){$.isFunction(c)&&c(a,e)}}}else $.isFunction(c)&&c(a,e)}},jsonp:function(b){var a,d=b.url,e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,c=b.callbackName||"openseadragon"+$.now(),g=window[c],i="$1"+c+"$2",h=b.param||"callback",f=b.callback;d=d.replace(/(\=)\?(&|$)|\?\?/i,i);d+=(/\?/.test(d)?"&":"?")+h+"="+c;window[c]=function(a){if(!g)try{delete window[c]}catch(b){}else window[c]=g;f&&$.isFunction(f)&&f(a)};a=document.createElement("script");if(undefined!==b.async||false!==b.async)a.async="async";if(b.scriptCharset)a.charset=b.scriptCharset;a.src=d;a.onload=a.onreadystatechange=function(c,b){if(b||!a.readyState||/loaded|complete/.test(a.readyState)){a.onload=a.onreadystatechange=null;e&&a.parentNode&&e.removeChild(a);a=undefined}};e.insertBefore(a,e.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open.";},parseXml:function(a){if(window.DOMParser)$.parseXml=function(c){var b=null,a;a=new DOMParser;b=a.parseFromString(c,"text/xml");return b};else if(window.ActiveXObject)$.parseXml=function(b){var a=null;a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(b);return a};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(a)},parseJSON:function(string){if(window.JSON&&window.JSON.parse)$.parseJSON=window.JSON.parse;else $.parseJSON=function(string){return eval("("+string+")")};return $.parseJSON(string)},imageFormatSupported:function(a){a=a?a:"";return !!FILEFORMATS[a.toLowerCase()]}});$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:true};var FILEFORMATS={bmp:false,jpeg:true,jpg:true,png:true,tif:false,wdp:false},URLPARAMS={};(function(){var i=navigator.appName,h=navigator.appVersion,a=navigator.userAgent,f;switch(navigator.appName){case "Microsoft Internet Explorer":if(!!window.attachEvent&&!!window.ActiveXObject){$.Browser.vendor=$.BROWSERS.IE;$.Browser.version=parseFloat(a.substring(a.indexOf("MSIE")+5,a.indexOf(";",a.indexOf("MSIE"))))}break;case "Netscape":if(!!window.addEventListener)if(a.indexOf("Firefox")>=0){$.Browser.vendor=$.BROWSERS.FIREFOX;$.Browser.version=parseFloat(a.substring(a.indexOf("Firefox")+8))}else if(a.indexOf("Safari")>=0){$.Browser.vendor=a.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI;$.Browser.version=parseFloat(a.substring(a.substring(0,a.indexOf("Safari")).lastIndexOf("/")+1,a.indexOf("Safari")))}else{f=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(f.exec(a)!==null){$.Browser.vendor=$.BROWSERS.IE;$.Browser.version=parseFloat(RegExp.$1)}}break;case "Opera":$.Browser.vendor=$.BROWSERS.OPERA;$.Browser.version=parseFloat(h)}for(var g=window.location.search.substring(1),e=g.split("&"),b,c,d=0;d<e.length;d++){b=e[d];c=b.indexOf("=");if(c>0)URLPARAMS[b.substring(0,c)]=decodeURIComponent(b.substring(c+1))}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2);$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})();var nullfunction=function(){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,"assert":nullfunction};(function(a){var e=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,f=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame;if(e&&f){$.requestAnimationFrame=function(){return e.apply(a,arguments)};$.cancelAnimationFrame=function(){return f.apply(a,arguments)}}else{var b=[],c=[],g=0,d;$.requestAnimationFrame=function(a){b.push([++g,a]);if(!d)d=setInterval(function(){if(b.length){var e=$.now(),a=c;c=b;b=a;while(c.length)c.shift()[1](e)}else{clearInterval(d);d=undefined}},1e3/50);return g};$.cancelAnimationFrame=function(e){var a,d;for(a=0,d=b.length;a<d;a+=1)if(b[a][0]===e){b.splice(a,1);return}for(a=0,d=c.length;a<d;a+=1)if(c[a][0]===e){c.splice(a,1);return}}}})(window);function getOffsetParent(a,b){if(b&&a!=document.body)return document.body;else return a.offsetParent}function processDZIResponse(a,e){var b,d,c=null;if(!a)throw new Error($.getString("Errors.Security"));else if(a.status!==200&&a.status!==0){b=a.status;d=b==404?"Not Found":a.statusText;throw new Error($.getString("Errors.Status",b,d));}if(a.responseXML&&a.responseXML.documentElement)c=a.responseXML;else if(a.responseText)c=$.parseXml(a.responseText);return processDZIXml(c,e)}function processDZIXml(b,e){if(!b||!b.documentElement)throw new Error($.getString("Errors.Xml"));var c=b.documentElement,a=c.tagName;if(a=="Image")try{return processDZI(c,e)}catch(d){throw d instanceof Error?d:new Error($.getString("Errors.Dzi"));}else if(a=="Collection")throw new Error($.getString("Errors.Dzc"));else if(a=="Error")return $._processDZIError(c);throw new Error($.getString("Errors.Dzi"));}function processDZI(a,k){var e=a.getAttribute("Format"),h=a.getElementsByTagName("Size")[0],f=a.getElementsByTagName("DisplayRect"),m=parseInt(h.getAttribute("Width"),10),l=parseInt(h.getAttribute("Height"),10),j=parseInt(a.getAttribute("TileSize"),10),i=parseInt(a.getAttribute("Overlap"),10),g=[],d,b,c;if(!$.imageFormatSupported(e))throw new Error($.getString("Errors.ImageFormat",e.toUpperCase()));for(c=0;c<f.length;c++){d=f[c];b=d.getElementsByTagName("Rect")[0];g.push(new $.DisplayRect(parseInt(b.getAttribute("X"),10),parseInt(b.getAttribute("Y"),10),parseInt(b.getAttribute("Width"),10),parseInt(b.getAttribute("Height"),10),0,parseInt(d.getAttribute("MaxLevel"),10)))}return new $.DziTileSource(m,l,j,i,k,e,g)}function processDZIJSON(b,j){var d=b.Format,g=b.Size,e=b.DisplayRect||[],l=parseInt(g.Width,10),k=parseInt(g.Height,10),i=parseInt(b.TileSize,10),h=parseInt(b.Overlap,10),f=[],a,c;if(!$.imageFormatSupported(d))throw new Error($.getString("Errors.ImageFormat",d.toUpperCase()));for(c=0;c<e.length;c++){a=e[c].Rect;f.push(new $.DisplayRect(parseInt(a.X,10),parseInt(a.Y,10),parseInt(a.Width,10),parseInt(a.Height,10),0,parseInt(a.MaxLevel,10)))}return new $.DziTileSource(l,k,i,h,j,d,f)}$._processDZIError=function(b){var a=b.getElementsByTagName("Message")[0],c=a.firstChild.nodeValue;throw new Error(c);}})(OpenSeadragon);(function(a){a.EventSource=function(){this.events={}};a.EventSource.prototype={addHandler:function(d,c,e){var b=this.events[d];if(!b)this.events[d]=b=[];if(c&&a.isFunction(c))b[b.length]={handler:c,userData:e||null}},removeHandler:function(d,f){var b=this.events[d],e=[],c;if(!b)return;if(a.isArray(b)){for(c=0;c<b.length;c++)b[c].handler!==f&&e.push(b[c]);this.events[d]=e}},removeAllHandlers:function(a){if(a)this.events[a]=[];else for(var b in this.events)this.events[b]=[]},getHandler:function(b){var a=this.events[b];if(!a||!a.length)return null;a=a.length===1?[a[0]]:Array.apply(null,a);return function(e,c){for(var d=a.length,b=0;b<d;b++)if(a[b]){c.eventSource=e;c.userData=a[b].userData;a[b].handler(c)}}},raiseEvent:function(c,a){var b=this.getHandler(c);if(b){if(!a)a={};b(this,a)}}}})(OpenSeadragon);(function(a){a.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5};a.Control=function(c,b,d){var e=c.parentNode;if(typeof b==="number"){a.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013");b={anchor:b}}b.attachToViewer=typeof b.attachToViewer==="undefined"?true:b.attachToViewer;this.autoFade=typeof b.autoFade==="undefined"?true:b.autoFade;this.element=c;this.anchor=b.anchor;this.container=d;if(this.anchor==a.ControlAnchor.ABSOLUTE){this.wrapper=a.makeNeutralElement("div");this.wrapper.style.position="absolute";this.wrapper.style.top=typeof b.top=="number"?b.top+"px":b.top;this.wrapper.style.left=typeof b.left=="number"?b.left+"px":b.left;this.wrapper.style.height=typeof b.height=="number"?b.height+"px":b.height;this.wrapper.style.width=typeof b.width=="number"?b.width+"px":b.width;this.wrapper.style.margin="0px";this.wrapper.style.padding="0px";this.element.style.position="relative";this.element.style.top="0px";this.element.style.left="0px";this.element.style.height="100%";this.element.style.width="100%"}else{this.wrapper=a.makeNeutralElement("div");this.wrapper.style.display="inline-block";if(this.anchor==a.ControlAnchor.NONE)this.wrapper.style.width=this.wrapper.style.height="100%"}this.wrapper.appendChild(this.element);if(b.attachToViewer)if(this.anchor==a.ControlAnchor.TOP_RIGHT||this.anchor==a.ControlAnchor.BOTTOM_RIGHT)this.container.insertBefore(this.wrapper,this.container.firstChild);else this.container.appendChild(this.wrapper);else e.appendChild(this.wrapper)};a.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element);this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(b){this.wrapper.style.display=b?this.anchor==a.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(b){if(this.element[a.SIGNAL]&&a.Browser.vendor==a.BROWSERS.IE)a.setElementOpacity(this.element,b,true);else a.setElementOpacity(this.wrapper,b,true)}}})(OpenSeadragon);(function(a){a.ControlDock=function(e){var d=["topleft","topright","bottomright","bottomleft"],b,c;a.extend(true,this,{id:"controldock-"+a.now()+"-"+Math.floor(Math.random()*1e6),container:a.makeNeutralElement("div"),controls:[]},e);this.container.onsubmit=function(){return false};if(this.element){this.element=a.getElement(this.element);this.element.appendChild(this.container);this.element.style.position="relative";this.container.style.width="100%";this.container.style.height="100%"}for(c=0;c<d.length;c++){b=d[c];this.controls[b]=a.makeNeutralElement("div");this.controls[b].style.position="absolute";if(b.match("left"))this.controls[b].style.left="0px";if(b.match("right"))this.controls[b].style.right="0px";if(b.match("top"))this.controls[b].style.top="0px";if(b.match("bottom"))this.controls[b].style.bottom="0px"}this.container.appendChild(this.controls.topleft);this.container.appendChild(this.controls.topright);this.container.appendChild(this.controls.bottomright);this.container.appendChild(this.controls.bottomleft)};a.ControlDock.prototype={addControl:function(c,e){c=a.getElement(c);var d=null;if(b(this,c)>=0)return;switch(e.anchor){case a.ControlAnchor.TOP_RIGHT:d=this.controls.topright;c.style.position="relative";c.style.paddingRight="0px";c.style.paddingTop="0px";break;case a.ControlAnchor.BOTTOM_RIGHT:d=this.controls.bottomright;c.style.position="relative";c.style.paddingRight="0px";c.style.paddingBottom="0px";break;case a.ControlAnchor.BOTTOM_LEFT:d=this.controls.bottomleft;c.style.position="relative";c.style.paddingLeft="0px";c.style.paddingBottom="0px";break;case a.ControlAnchor.TOP_LEFT:d=this.controls.topleft;c.style.position="relative";c.style.paddingLeft="0px";c.style.paddingTop="0px";break;case a.ControlAnchor.ABSOLUTE:d=this.container;c.style.margin="0px";c.style.padding="0px";break;default:case a.ControlAnchor.NONE:d=this.container;c.style.margin="0px";c.style.padding="0px"}this.controls.push(new a.Control(c,e,d));c.style.display="inline-block"},removeControl:function(c){c=a.getElement(c);var d=b(this,c);if(d>=0){this.controls[d].destroy();this.controls.splice(d,1)}return this},clearControls:function(){while(this.controls.length>0)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var a=this.controls.length-1;a>=0;a--)if(this.controls[a].isVisible())return true;return false},setControlsEnabled:function(b){for(var a=this.controls.length-1;a>=0;a--)this.controls[a].setVisible(b);return this}};function b(d,c){for(var b=d.controls,a=b.length-1;a>=0;a--)if(b[a].element==c)return a;return -1}})(OpenSeadragon);(function(a){var b={},X=1,i,h;a.Viewer=function(e){var f=arguments,c=this,g;if(!a.isPlainObject(e))e={id:f[0],xmlPath:f.length>1?f[1]:undefined,prefixUrl:f.length>2?f[2]:undefined,controls:f.length>3?f[3]:undefined,overlays:f.length>4?f[4]:undefined};if(e.config){a.extend(true,e,e.config);delete e.config}a.extend(true,this,{id:e.id,hash:e.hash||X++,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},a.DEFAULT_SETTINGS,e);if(typeof this.hash==="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");typeof b[this.hash]!=="undefined"&&a.console.warn("Hash "+this.hash+" has already been used.");b[this.hash]={fsBoundsDelta:new a.Point(1,1),prevContainerSize:null,animating:false,forceRedraw:false,mouseInside:false,group:null,zooming:false,zoomFactor:null,lastZoomTime:null,fullPage:false,onfullscreenchange:null};this._sequenceIndex=0;this._firstOpen=true;this._updateRequestId=null;this._loadQueue=[];this.currentOverlays=[];this._lastScrollTime=a.now();a.EventSource.call(this);this.addHandler("open-failed",function(b){var d=a.getString("Errors.OpenFailed",b.eventSource,b.message);c._showMessage(d)});a.ControlDock.call(this,e);if(this.xmlPath)this.tileSources=[this.xmlPath];this.element=this.element||document.getElementById(this.id);this.canvas=a.makeNeutralElement("div");this.canvas.className="openseadragon-canvas";(function(a){a.width="100%";a.height="100%";a.overflow="hidden";a.position="absolute";a.top="0px";a.left="0px"})(this.canvas.style);a.setElementTouchActionNone(this.canvas);this.canvas.tabIndex=e.tabIndex||0;this.container.className="openseadragon-container";(function(a){a.width="100%";a.height="100%";a.position="relative";a.overflow="hidden";a.left="0px";a.top="0px";a.textAlign="left"})(this.container.style);this.container.insertBefore(this.canvas,this.container.firstChild);this.element.appendChild(this.container);this.bodyWidth=document.body.style.width;this.bodyHeight=document.body.style.height;this.bodyOverflow=document.body.style.overflow;this.docOverflow=document.documentElement.style.overflow;this.innerTracker=new a.MouseTracker({element:this.canvas,startDisabled:this.mouseNavEnabled?false:true,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:a.delegate(this,F),keyHandler:a.delegate(this,B),clickHandler:a.delegate(this,K),dblClickHandler:a.delegate(this,A),dragHandler:a.delegate(this,P),dragEndHandler:a.delegate(this,E),enterHandler:a.delegate(this,L),exitHandler:a.delegate(this,Q),pressHandler:a.delegate(this,N),releaseHandler:a.delegate(this,G),nonPrimaryPressHandler:a.delegate(this,w),nonPrimaryReleaseHandler:a.delegate(this,u),scrollHandler:a.delegate(this,J),pinchHandler:a.delegate(this,M),moveHandler:a.delegate(this,y)});this.outerTracker=new a.MouseTracker({element:this.container,startDisabled:this.mouseNavEnabled?false:true,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:a.delegate(this,l),exitHandler:a.delegate(this,n)});if(this.toolbar)this.toolbar=new a.ControlDock({element:this.toolbar});this.bindStandardControls();b[this.hash].prevContainerSize=m(this.container);this.world=new a.World({viewer:this});this.world.addHandler("add-item",function(){c.source=c.world.getItemAt(0).source;b[c.hash].forceRedraw=true;if(!c._updateRequestId)c._updateRequestId=p(c,q)});this.world.addHandler("remove-item",function(){if(c.world.getItemCount())c.source=c.world.getItemAt(0).source;else c.source=null;b[c.hash].forceRedraw=true});this.world.addHandler("metrics-change",function(){c.viewport&&c.viewport.setHomeBounds(c.world.getHomeBounds(),c.world.getContentFactor())});this.world.addHandler("item-index-change",function(){c.source=c.world.getItemAt(0).source});this.viewport=new a.Viewport({containerSize:b[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins});this.viewport.setHomeBounds(this.world.getHomeBounds(),this.world.getContentFactor());this.imageLoader=new a.ImageLoader({jobLimit:this.imageLoaderLimit});this.tileCache=new a.TileCache({maxImageCacheCount:this.maxImageCacheCount});this.drawer=new a.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor});this.overlaysContainer=a.makeNeutralElement("div");this.canvas.appendChild(this.overlaysContainer);if(!this.drawer.canRotate()){if(this.rotateLeft){g=this.buttons.buttons.indexOf(this.rotateLeft);this.buttons.buttons.splice(g,1);this.buttons.element.removeChild(this.rotateLeft.element)}if(this.rotateRight){g=this.buttons.buttons.indexOf(this.rotateRight);this.buttons.buttons.splice(g,1);this.buttons.element.removeChild(this.rotateRight.element)}}if(this.showNavigator)this.navigator=new a.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy});this.sequenceMode&&this.bindSequenceControls();this.tileSources&&this.open(this.tileSources);for(g=0;g<this.customControls.length;g++)this.addControl(this.customControls[g].id,{anchor:this.customControls[g].anchor});a.requestAnimationFrame(function(){d(c)})};a.extend(a.Viewer.prototype,a.EventSource.prototype,a.ControlDock.prototype,{isOpen:function(){return !!this.world.getItemCount()},openDzi:function(b){a.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead.");return this.open(b)},openTileSource:function(b){a.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead.");return this.open(b)},open:function(c){var b=this;this.close();if(!c)return;if(this.sequenceMode&&a.isArray(c)){if(this.referenceStrip){this.referenceStrip.destroy();this.referenceStrip=null}this.tileSources=c;this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage));if(this.tileSources.length){this.open(this.tileSources[this._sequenceIndex]);if(this.showReferenceStrip)this.referenceStrip=new a.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this})}this._updateSequenceButtons(this._sequenceIndex);return}if(!a.isArray(c))c=[c];if(!c.length)return;this._opening=true;for(var i=c.length,e=0,h=0,d,g=function(){if(e+h===i)if(e){if(b._firstOpen||!b.preserveViewport){b.viewport.goHome(true);b.viewport.update()}b._firstOpen=false;var a=c[0];if(a.tileSource)a=a.tileSource;if(b.overlays&&!b.preserveOverlays)for(var f=0;f<b.overlays.length;f++)b.currentOverlays[f]=k(b,b.overlays[f]);b._drawOverlays();b._opening=false;b.raiseEvent("open",{source:a})}else{b._opening=false;b.raiseEvent("open-failed",d)}},j=function(c){if(!a.isPlainObject(c)||!c.tileSource)c={tileSource:c};if(c.index!==undefined){a.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead");delete c.index}if(c.collectionImmediately===undefined)c.collectionImmediately=true;var f=c.success;c.success=function(d){e++;if(c.tileSource.overlays)for(var a=0;a<c.tileSource.overlays.length;a++)b.addOverlay(c.tileSource.overlays[a]);f&&f(d);g()};var i=c.error;c.error=function(a){h++;if(!d)d=a;i&&i(a);g()};b.addTiledImage(c)},f=0;f<c.length;f++)j(c[f]);return this},close:function(){if(!b[this.hash])return this;this._opening=false;this.navigator&&this.navigator.close();if(!this.preserveOverlays){this.clearOverlays();this.overlaysContainer.innerHTML=""}b[this.hash].animating=false;this.world.removeAll();this.imageLoader.clear();this.raiseEvent("close");return this},destroy:function(){if(!b[this.hash])return;this.close();this.clearOverlays();this.overlaysContainer.innerHTML="";if(this.referenceStrip){this.referenceStrip.destroy();this.referenceStrip=null}if(this._updateRequestId!==null){a.cancelAnimationFrame(this._updateRequestId);this._updateRequestId=null}this.drawer&&this.drawer.destroy();this.removeAllHandlers();if(this.element)while(this.element.firstChild)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy();this.outerTracker&&this.outerTracker.destroy();b[this.hash]=null;delete b[this.hash];this.canvas=null;this.container=null;this.element=null},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(a){this.innerTracker.setTracking(a);this.raiseEvent("mouse-enabled",{enabled:a});return this},areControlsEnabled:function(){for(var a=this.controls.length,b=0;b<this.controls.length;b++)a=a&&this.controls[b].isVisibile();return a},setControlsEnabled:function(a){if(a)e(this);else d(this);this.raiseEvent("controls-enabled",{enabled:a});return this},isFullPage:function(){return b[this.hash].fullPage},setFullPage:function(g){var d=document.body,c=d.style,e=document.documentElement.style,i=this,o,h,f;if(g==this.isFullPage())return this;var k={fullPage:g,preventDefaultAction:false};this.raiseEvent("pre-full-page",k);if(k.preventDefaultAction)return this;if(g){this.elementSize=a.getElementSize(this.element);this.pageScroll=a.getPageScroll();this.elementMargin=this.element.style.margin;this.element.style.margin="0";this.elementPadding=this.element.style.padding;this.element.style.padding="0";this.bodyMargin=c.margin;this.docMargin=e.margin;c.margin="0";e.margin="0";this.bodyPadding=c.padding;this.docPadding=e.padding;c.padding="0";e.padding="0";this.bodyWidth=c.width;this.bodyHeight=c.height;c.width="100%";c.height="100%";this.previousBody=[];b[this.hash].prevElementParent=this.element.parentNode;b[this.hash].prevNextSibling=this.element.nextSibling;b[this.hash].prevElementWidth=this.element.style.width;b[this.hash].prevElementHeight=this.element.style.height;h=d.childNodes.length;for(f=0;f<h;f++){this.previousBody.push(d.childNodes[0]);d.removeChild(d.childNodes[0])}if(this.toolbar&&this.toolbar.element){this.toolbar.parentNode=this.toolbar.element.parentNode;this.toolbar.nextSibling=this.toolbar.element.nextSibling;d.appendChild(this.toolbar.element);a.addClass(this.toolbar.element,"fullpage")}a.addClass(this.element,"fullpage");d.appendChild(this.element);this.element.style.height=a.getWindowSize().y+"px";this.element.style.width=a.getWindowSize().x+"px";if(this.toolbar&&this.toolbar.element)this.element.style.height=a.getElementSize(this.element).y-a.getElementSize(this.toolbar.element).y+"px";b[this.hash].fullPage=true;a.delegate(this,l)({})}else{this.element.style.margin=this.elementMargin;this.element.style.padding=this.elementPadding;c.margin=this.bodyMargin;e.margin=this.docMargin;c.padding=this.bodyPadding;e.padding=this.docPadding;c.width=this.bodyWidth;c.height=this.bodyHeight;d.removeChild(this.element);h=this.previousBody.length;for(f=0;f<h;f++)d.appendChild(this.previousBody.shift());a.removeClass(this.element,"fullpage");b[this.hash].prevElementParent.insertBefore(this.element,b[this.hash].prevNextSibling);if(this.toolbar&&this.toolbar.element){d.removeChild(this.toolbar.element);a.removeClass(this.toolbar.element,"fullpage");this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling);delete this.toolbar.parentNode;delete this.toolbar.nextSibling}this.element.style.width=b[this.hash].prevElementWidth;this.element.style.height=b[this.hash].prevElementHeight;var j=0,m=function(){a.setPageScroll(i.pageScroll);var b=a.getPageScroll();j++;(j<10&&b.x!==i.pageScroll.x||b.y!==i.pageScroll.y)&&a.requestAnimationFrame(m)};a.requestAnimationFrame(m);b[this.hash].fullPage=false;a.delegate(this,n)({})}this.navigator&&this.viewport&&this.navigator.update(this.viewport);this.raiseEvent("full-page",{fullPage:g});return this},setFullScreen:function(d){var b=this;if(!a.supportsFullScreen)return this.setFullPage(d);if(a.isFullScreen()===d)return this;var e={fullScreen:d,preventDefaultAction:false};this.raiseEvent("pre-full-screen",e);if(e.preventDefaultAction)return this;if(d){this.setFullPage(true);if(!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width;this.fullPageStyleHeight=this.element.style.height;this.element.style.width="100%";this.element.style.height="100%";var c=function(){var d=a.isFullScreen();if(!d){a.removeEvent(document,a.fullScreenEventName,c);a.removeEvent(document,a.fullScreenErrorEventName,c);b.setFullPage(false);if(b.isFullPage()){b.element.style.width=b.fullPageStyleWidth;b.element.style.height=b.fullPageStyleHeight}}b.navigator&&b.viewport&&b.navigator.update(b.viewport);b.raiseEvent("full-screen",{fullScreen:d})};a.addEvent(document,a.fullScreenEventName,c);a.addEvent(document,a.fullScreenErrorEventName,c);a.requestFullScreen(document.body)}else a.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(a){this.container.style.visibility=a?"":"hidden";this.raiseEvent("visible",{visible:a});return this},addTiledImage:function(c){a.console.assert(c,"[Viewer.addTiledImage] options is required");a.console.assert(c.tileSource,"[Viewer.addTiledImage] options.tileSource is required");a.console.assert(!c.replace||c.index>-1&&c.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var b=this;if(c.replace)c.replaceItem=b.world.getItemAt(c.index);this._hideMessage();if(c.placeholderFillStyle===undefined)c.placeholderFillStyle=this.placeholderFillStyle;if(c.opacity===undefined)c.opacity=this.opacity;var d={options:c};function e(e){for(var a=0;a<b._loadQueue.length;a++)if(b._loadQueue[a]===d){b._loadQueue.splice(a,1);break}b._loadQueue.length===0&&f(d);b.raiseEvent("add-item-failed",e);c.error&&c.error(e)}function f(a){if(b.collectionMode){b.world.arrange({immediately:a.options.collectionImmediately,rows:b.collectionRows,columns:b.collectionColumns,layout:b.collectionLayout,tileSize:b.collectionTileSize,tileMargin:b.collectionTileMargin});b.world.setAutoRefigureSizes(true)}}if(a.isArray(c.tileSource)){setTimeout(function(){e({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:c.tileSource,options:c})});return}this._loadQueue.push(d);t(this,c.tileSource,function(i){d.tileSource=i;var c,e,g;while(b._loadQueue.length){c=b._loadQueue[0];if(!c.tileSource)break;b._loadQueue.splice(0,1);if(c.options.replace){var h=b.world.getIndexOfItem(c.options.replaceItem);if(h!=-1)c.options.index=h;b.world.removeItem(c.options.replaceItem)}e=new a.TiledImage({viewer:b,source:c.tileSource,viewport:b.viewport,drawer:b.drawer,tileCache:b.tileCache,imageLoader:b.imageLoader,x:c.options.x,y:c.options.y,width:c.options.width,height:c.options.height,clip:c.options.clip,placeholderFillStyle:c.options.placeholderFillStyle,opacity:c.options.opacity,springStiffness:b.springStiffness,animationTime:b.animationTime,minZoomImageRatio:b.minZoomImageRatio,wrapHorizontal:b.wrapHorizontal,wrapVertical:b.wrapVertical,immediateRender:b.immediateRender,blendTime:b.blendTime,alwaysBlend:b.alwaysBlend,minPixelRatio:b.minPixelRatio,crossOriginPolicy:b.crossOriginPolicy,debugMode:b.debugMode});b.collectionMode&&b.world.setAutoRefigureSizes(false);b.world.addItem(e,{index:c.options.index});b._loadQueue.length===0&&f(c);b.world.getItemCount()===1&&!b.preserveViewport&&b.viewport.goHome(true);if(b.navigator){g=a.extend({},c.options,{originalTiledImage:e,tileSource:c.tileSource});b.navigator.addTiledImage(g)}c.options.success&&c.options.success({item:e})}},function(a){a.options=c;e(a)})},addLayer:function(b){var c=this;a.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var d=a.extend({},b,{success:function(a){c.raiseEvent("add-layer",{options:b,drawer:a.item})},error:function(a){c.raiseEvent("add-layer-failed",a)}});this.addTiledImage(d);return this},getLayerAtLevel:function(b){a.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead.");return this.world.getItemAt(b)},getLevelOfLayer:function(b){a.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead.");return this.world.getIndexOfItem(b)},getLayersCount:function(){a.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead.");return this.world.getItemCount()},setLayerLevel:function(b,c){a.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead.");return this.world.setItemIndex(b,c)},removeLayer:function(b){a.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead.");return this.world.removeItem(b)},forceRedraw:function(){b[this.hash].forceRedraw=true;return this},bindSequenceControls:function(){var d=a.delegate(this,r),e=a.delegate(this,s),h=a.delegate(this,bb),g=a.delegate(this,U),b=this.navImages,f=true;if(this.showSequenceControl){if(this.previousButton||this.nextButton)f=false;this.previousButton=new a.Button({element:this.previousButton?a.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.PreviousPage"),srcRest:c(this.prefixUrl,b.previous.REST),srcGroup:c(this.prefixUrl,b.previous.GROUP),srcHover:c(this.prefixUrl,b.previous.HOVER),srcDown:c(this.prefixUrl,b.previous.DOWN),onRelease:g,onFocus:d,onBlur:e});this.nextButton=new a.Button({element:this.nextButton?a.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.NextPage"),srcRest:c(this.prefixUrl,b.next.REST),srcGroup:c(this.prefixUrl,b.next.GROUP),srcHover:c(this.prefixUrl,b.next.HOVER),srcDown:c(this.prefixUrl,b.next.DOWN),onRelease:h,onFocus:d,onBlur:e});!this.navPrevNextWrap&&this.previousButton.disable();(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable();if(f){this.paging=new a.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold});this.pagingControl=this.paging.element;if(this.toolbar)this.toolbar.addControl(this.pagingControl,{anchor:a.ControlAnchor.BOTTOM_RIGHT});else this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||a.ControlAnchor.TOP_LEFT})}}return this},bindStandardControls:function(){var i=a.delegate(this,H),g=a.delegate(this,T),l=a.delegate(this,I),h=a.delegate(this,C),k=a.delegate(this,D),p=a.delegate(this,ab),n=a.delegate(this,R),o=a.delegate(this,S),m=a.delegate(this,O),e=a.delegate(this,r),f=a.delegate(this,s),b=this.navImages,d=[],j=true;if(this.showNavigationControl){if(this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)j=false;if(this.showZoomControl){d.push(this.zoomInButton=new a.Button({element:this.zoomInButton?a.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomIn"),srcRest:c(this.prefixUrl,b.zoomIn.REST),srcGroup:c(this.prefixUrl,b.zoomIn.GROUP),srcHover:c(this.prefixUrl,b.zoomIn.HOVER),srcDown:c(this.prefixUrl,b.zoomIn.DOWN),onPress:i,onRelease:g,onClick:l,onEnter:i,onExit:g,onFocus:e,onBlur:f}));d.push(this.zoomOutButton=new a.Button({element:this.zoomOutButton?a.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomOut"),srcRest:c(this.prefixUrl,b.zoomOut.REST),srcGroup:c(this.prefixUrl,b.zoomOut.GROUP),srcHover:c(this.prefixUrl,b.zoomOut.HOVER),srcDown:c(this.prefixUrl,b.zoomOut.DOWN),onPress:h,onRelease:g,onClick:k,onEnter:h,onExit:g,onFocus:e,onBlur:f}))}this.showHomeControl&&d.push(this.homeButton=new a.Button({element:this.homeButton?a.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.Home"),srcRest:c(this.prefixUrl,b.home.REST),srcGroup:c(this.prefixUrl,b.home.GROUP),srcHover:c(this.prefixUrl,b.home.HOVER),srcDown:c(this.prefixUrl,b.home.DOWN),onRelease:p,onFocus:e,onBlur:f}));this.showFullPageControl&&d.push(this.fullPageButton=new a.Button({element:this.fullPageButton?a.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.FullPage"),srcRest:c(this.prefixUrl,b.fullpage.REST),srcGroup:c(this.prefixUrl,b.fullpage.GROUP),srcHover:c(this.prefixUrl,b.fullpage.HOVER),srcDown:c(this.prefixUrl,b.fullpage.DOWN),onRelease:n,onFocus:e,onBlur:f}));if(this.showRotationControl){d.push(this.rotateLeftButton=new a.Button({element:this.rotateLeftButton?a.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateLeft"),srcRest:c(this.prefixUrl,b.rotateleft.REST),srcGroup:c(this.prefixUrl,b.rotateleft.GROUP),srcHover:c(this.prefixUrl,b.rotateleft.HOVER),srcDown:c(this.prefixUrl,b.rotateleft.DOWN),onRelease:o,onFocus:e,onBlur:f}));d.push(this.rotateRightButton=new a.Button({element:this.rotateRightButton?a.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateRight"),srcRest:c(this.prefixUrl,b.rotateright.REST),srcGroup:c(this.prefixUrl,b.rotateright.GROUP),srcHover:c(this.prefixUrl,b.rotateright.HOVER),srcDown:c(this.prefixUrl,b.rotateright.DOWN),onRelease:m,onFocus:e,onBlur:f}))}if(j){this.buttons=new a.ButtonGroup({buttons:d,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold});this.navControl=this.buttons.element;this.addHandler("open",a.delegate(this,Y));if(this.toolbar)this.toolbar.addControl(this.navControl,{anchor:a.ControlAnchor.TOP_LEFT});else this.addControl(this.navControl,{anchor:this.navigationControlAnchor||a.ControlAnchor.TOP_LEFT})}if(this.container.clientHeight<this.hideNavCtrlPx||this.container.clientWidth<this.hideNavCtrlPx)this.buttons.element.style.display="none"}return this},currentPage:function(){return this._sequenceIndex},goToPage:function(a){if(this.tileSources&&a>=0&&a<this.tileSources.length){this.raiseEvent("page",{page:a});this._sequenceIndex=a;this._updateSequenceButtons(a);this.open(this.tileSources[a]);this.referenceStrip&&this.referenceStrip.setFocus(a)}return this},addOverlay:function(b,g,e,h){var c;if(a.isPlainObject(b))c=b;else c={element:b,location:g,placement:e,onDraw:h};b=a.getElement(c.element);if(f(this.currentOverlays,b)>=0)return this;var d=k(this,c);this.currentOverlays.push(d);d.drawHTML(this.overlaysContainer,this.viewport);this.raiseEvent("add-overlay",{element:b,location:c.location,placement:c.placement});return this},updateOverlay:function(c,g,e){var d;c=a.getElement(c);d=f(this.currentOverlays,c);if(d>=0){this.currentOverlays[d].update(g,e);b[this.hash].forceRedraw=true;this.raiseEvent("update-overlay",{element:c,location:g,placement:e})}return this},removeOverlay:function(c){var d;c=a.getElement(c);d=f(this.currentOverlays,c);if(d>=0){this.currentOverlays[d].destroy();this.currentOverlays.splice(d,1);b[this.hash].forceRedraw=true;this.raiseEvent("remove-overlay",{element:c})}return this},clearOverlays:function(){while(this.currentOverlays.length>0)this.currentOverlays.pop().destroy();b[this.hash].forceRedraw=true;this.raiseEvent("clear-overlay",{});return this},_updateSequenceButtons:function(a){if(this.nextButton)if(!this.tileSources||this.tileSources.length-1===a)!this.navPrevNextWrap&&this.nextButton.disable();else this.nextButton.enable();if(this.previousButton)if(a>0)this.previousButton.enable();else!this.navPrevNextWrap&&this.previousButton.disable()},_showMessage:function(c){this._hideMessage();var b=a.makeNeutralElement("div");b.appendChild(document.createTextNode(c));this.messageDiv=a.makeCenteredNode(b);a.addClass(this.messageDiv,"openseadragon-message");this.container.appendChild(this.messageDiv)},_hideMessage:function(){var a=this.messageDiv;if(a){a.parentNode.removeChild(a);delete this.messageDiv}},gestureSettingsByDeviceType:function(a){switch(a){case "mouse":return this.gestureSettingsMouse;case "touch":return this.gestureSettingsTouch;case "pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var b=this.currentOverlays.length,a=0;a<b;a++)this.currentOverlays[a].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]}});function m(b){b=a.getElement(b);return new a.Point(b.clientWidth===0?1:b.clientWidth,b.clientHeight===0?1:b.clientHeight)}function t(c,b,d,e){var g=c;if(a.type(b)=="string")if(b.match(/\s*<.*/))b=a.parseXml(b);else if(b.match(/\s*[\{\[].*/))b=a.parseJSON(b);function f(a,b){if(a.ready)d(a);else{a.addHandler("ready",function(){d(a)});a.addHandler("open-failed",function(a){e({message:a.message,source:b})})}}setTimeout(function(){if(a.type(b)=="string"){b=new a.TileSource({url:b,crossOriginPolicy:c.crossOriginPolicy,ajaxWithCredentials:c.ajaxWithCredentials,useCanvas:c.useCanvas,success:function(a){d(a.tileSource)}});b.addHandler("open-failed",function(a){e(a)})}else if(a.isPlainObject(b)||b.nodeType){if(!b.crossOriginPolicy&&c.crossOriginPolicy)b.crossOriginPolicy=c.crossOriginPolicy;if(b.ajaxWithCredentials===undefined)b.ajaxWithCredentials=c.ajaxWithCredentials;if(b.useCanvas===undefined)b.useCanvas=c.useCanvas;if(a.isFunction(b.getTileUrl)){var i=new a.TileSource(b);i.getTileUrl=b.getTileUrl;d(i)}else{var h=a.TileSource.determineType(g,b);if(!h){e({message:"Unable to load TileSource",source:b});return}var j=h.prototype.configure.apply(g,[b]);f(new h(j),b)}}else f(b,b)})}function k(f,b){if(b instanceof a.Overlay)return b;var c=null;if(b.element)c=a.getElement(b.element);else{var g=b.id?b.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);c=a.getElement(b.id);if(!c){c=document.createElement("a");c.href="#/overlay/"+g}c.id=g;a.addClass(c,b.className?b.className:"openseadragon-overlay")}var e=b.location;if(!e)if(b.width&&b.height)e=b.px!==undefined?f.viewport.imageToViewportRectangle(new a.Rect(b.px,b.py,b.width,b.height)):new a.Rect(b.x,b.y,b.width,b.height);else e=b.px!==undefined?f.viewport.imageToViewportCoordinates(new a.Point(b.px,b.py)):new a.Point(b.x,b.y);var d=b.placement;if(d&&a.type(d)==="string")d=a.OverlayPlacement[b.placement.toUpperCase()];return new a.Overlay({element:c,location:e,placement:d,onDraw:b.onDraw,checkResize:b.checkResize})}function f(b,c){for(var a=b.length-1;a>=0;a--)if(b[a].element===c)return a;return -1}function p(c,b){return a.requestAnimationFrame(function(){b(c)})}function j(b){a.requestAnimationFrame(function(){x(b)})}function d(b){if(!b.autoHideControls)return;b.controlsShouldFade=true;b.controlsFadeBeginTime=a.now()+b.controlsFadeDelay;window.setTimeout(function(){j(b)},b.controlsFadeDelay)}function x(c){var e,f,b,d;if(c.controlsShouldFade){e=a.now();f=e-c.controlsFadeBeginTime;b=1-f/c.controlsFadeLength;b=Math.min(1,b);b=Math.max(0,b);for(d=c.controls.length-1;d>=0;d--)c.controls[d].autoFade&&c.controls[d].setOpacity(b);b>0&&j(c)}}function e(b){var a;b.controlsShouldFade=false;for(a=b.controls.length-1;a>=0;a--)b.controls[a].setOpacity(1)}function r(){e(this)}function s(){d(this)}function F(b){if(!b.preventDefaultAction&&!b.ctrl&&!b.alt&&!b.meta)switch(b.keyCode){case 38:if(b.shift)this.viewport.zoomBy(1.1);else this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-40)));this.viewport.applyConstraints();return false;case 40:if(b.shift)this.viewport.zoomBy(.9);else this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,40)));this.viewport.applyConstraints();return false;case 37:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-40,0)));this.viewport.applyConstraints();return false;case 39:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(40,0)));this.viewport.applyConstraints();return false;default:return true}else return true}function B(b){if(!b.preventDefaultAction&&!b.ctrl&&!b.alt&&!b.meta)switch(b.keyCode){case 43:case 61:this.viewport.zoomBy(1.1);this.viewport.applyConstraints();return false;case 45:this.viewport.zoomBy(.9);this.viewport.applyConstraints();return false;case 48:this.viewport.goHome();this.viewport.applyConstraints();return false;case 119:case 87:if(b.shift)this.viewport.zoomBy(1.1);else this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-40)));this.viewport.applyConstraints();return false;case 115:case 83:if(b.shift)this.viewport.zoomBy(.9);else this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,40)));this.viewport.applyConstraints();return false;case 97:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-40,0)));this.viewport.applyConstraints();return false;case 100:this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(40,0)));this.viewport.applyConstraints();return false;default:return true}else return true}function K(a){var b,c=document.activeElement==this.canvas;!c&&this.canvas.focus();if(!a.preventDefaultAction&&this.viewport&&a.quick){b=this.gestureSettingsByDeviceType(a.pointerType);if(b.clickToZoom){this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(a.position,true));this.viewport.applyConstraints()}}this.raiseEvent("canvas-click",{tracker:a.eventSource,position:a.position,quick:a.quick,shift:a.shift,originalEvent:a.originalEvent})}function A(a){this.parentObj.isDoing="doubleclick";clearTimeout(h);var c;if(!a.preventDefaultAction&&this.viewport){c=this.gestureSettingsByDeviceType(a.pointerType);if(c.dblClickToZoom){this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(a.position,true));this.viewport.applyConstraints()}}if(this.viewport){var d=this.source.dimensions,b=this.viewport.pointFromPixel(a.position);b.x=Math.round(b.x*d.x);b.y=Math.round(b.y*d.x);this.parentObj.k8DoubleClick(this,b,a.position)}this.parentObj.isDoing="";return;this.raiseEvent("canvas-double-click",{tracker:a.eventSource,position:a.position,shift:a.shift,originalEvent:a.originalEvent})}function L(a){this.raiseEvent("canvas-enter",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function Q(a){this.raiseEvent("canvas-exit",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function y(b){if(b.pointerType!="mouse")return;if(this.viewport&&this.parentObj.isDoing==""){var c=this.source.dimensions,a=this.viewport.pointFromPixel(b.position);a.x=Math.round(a.x*c.x);a.y=Math.round(a.y*c.x);this.parentObj.k8Move(this,a,b.position)}}function N(a){dt=new Date;this.parentObj.pointerStartTime=dt.getTime();this.parentObj.pointerStartX=a.position.x;this.parentObj.pointerStartY=a.position.y;var b=this;this.parentObj.isDoing="click";i=setTimeout(z,b.parentObj.pressAndHoldTime,a,b);return;this.raiseEvent("canvas-press",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function z(c,a){if(a.parentObj.isDoing=="click"){a.parentObj.isDoing="clickandhold";var d=a.source.dimensions,b=a.viewport.pointFromPixel(c.position);b.x=Math.round(b.x*d.x);b.y=Math.round(b.y*d.x);a.parentObj.k8PressAndHold(b,c.position);a.parentObj.isDoing=""}}function o(a,c){if(a.isDoing!="click")return;if(a.osd.viewport){var d=a.osd.source.dimensions,b=a.osd.viewport.pointFromPixel(c.position);b.x=Math.round(b.x*d.x);b.y=Math.round(b.y*d.x);a.k8Click(a.osd,b,c.position,c.originalEvent.shiftKey)}a.isDoing=""}function G(a){clearTimeout(i);if(a.pointerType=="mouse"){if(this.parentObj.isDoing=="click")h=setTimeout(o,300,this.parentObj,a)}else if(this.parentObj.isDoing=="click"){dt=new Date;var b=dt.getTime(),c=b-this.parentObj.pointerStartTime;if(c<this.parentObj.pressAndHoldTime)h=setTimeout(o,300,this.parentObj,a)}return;this.raiseEvent("canvas-release",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function P(a){var b;dt=new Date;var g=dt.getTime(),e=a.position.x-this.parentObj.pointerStartX,f=a.position.y-this.parentObj.pointerStartY,j=g-this.parentObj.pointerStartTime;if(a.pointerType=="touch"){if(this.parentObj.isDoing=="click")if((Math.abs(e)>this.parentObj.moveThreshold||Math.abs(f)>this.parentObj.moveThreshold)&&j>this.parentObj.panTime)this.parentObj.isDoing="move";if(this.viewport&&this.parentObj.isDoing=="move"){var d=this.source.dimensions,c=this.viewport.pointFromPixel(a.position);c.x=Math.round(c.x*d.x);c.y=Math.round(c.y*d.x);this.parentObj.k8Move(this,c,a.position)}return}else{if(this.parentObj.isDoing=="click"&&(Math.abs(e)>this.parentObj.moveThreshold||Math.abs(f)>this.parentObj.moveThreshold)){clearTimeout(i);this.parentObj.isDoing="pan"}if(this.parentObj.isDoing!="pan")return}if(!a.preventDefaultAction&&this.viewport){b=this.gestureSettingsByDeviceType(a.pointerType);var h=b.flickEnabled;if(this.viewport.getBounds().x<0){a.delta.x=0;b.flickEnabled=false}if(this.viewport.getBounds().y<0){a.delta.y=0;b.flickEnabled=false}this.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta.negate()),b.flickEnabled);this.constrainDuringPan&&this.viewport.applyConstraints()}b.flickEnabled=h;return;this.raiseEvent("canvas-drag",{tracker:a.eventSource,position:a.position,delta:a.delta,speed:a.speed,direction:a.direction,shift:a.shift,originalEvent:a.originalEvent})}function E(b){if(b.pointerType=="mouse"){this.parentObj.isDoing="";return}var c;dt=new Date;var g=dt.getTime(),j=b.position.x-this.parentObj.pointerStartX,k=b.position.y-this.parentObj.pointerStartY,i=g-this.parentObj.pointerStartTime;if((Math.abs(j)>this.parentObj.moveThreshold||Math.abs(k)>this.parentObj.moveThreshold)&&i<this.parentObj.panTime&&!b.preventDefaultAction&&this.viewport){this.parentObj.isDoing="";c=this.gestureSettingsByDeviceType(b.pointerType);var d=c.flickMomentum*(b.speed*Math.cos(b.direction-Math.PI/180*this.viewport.degrees)),e=c.flickMomentum*(b.speed*Math.sin(b.direction-Math.PI/180*this.viewport.degrees));if(this.viewport.getBounds().x<0)d=0;if(this.viewport.getBounds().y<0)e=0;var f=this.viewport.pixelFromPoint(this.viewport.getCenter(true)),h=this.viewport.pointFromPixel(new a.Point(f.x-d,f.y-e));(d||e)&&this.viewport.panTo(h,false);this.viewport.applyConstraints()}return;this.raiseEvent("canvas-drag-end",{tracker:b.eventSource,position:b.position,speed:b.speed,direction:b.direction,shift:b.shift,originalEvent:b.originalEvent})}function w(a){if(this.viewport){var c=this.source.dimensions,b=this.viewport.pointFromPixel(a.position);b.x=Math.round(b.x*c.x);b.y=Math.round(b.y*c.x);this.parentObj.k8ContextMenu(this,b,a.position)}return;this.raiseEvent("canvas-nonprimary-press",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function u(a){this.raiseEvent("canvas-nonprimary-release",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function M(a){var b,c,e,d;if(!a.preventDefaultAction&&this.viewport){b=this.gestureSettingsByDeviceType(a.pointerType);if(b.pinchToZoom){c=this.viewport.pointFromPixel(a.center,true);e=this.viewport.pointFromPixel(a.lastCenter,true);d=e.minus(c);if(!this.panHorizontal)d.x=0;if(!this.panVertical)d.y=0;this.viewport.zoomBy(a.distance/a.lastDistance,c,true);this.viewport.applyConstraints()}if(b.pinchRotate){var f=Math.atan2(a.gesturePoints[0].currentPos.y-a.gesturePoints[1].currentPos.y,a.gesturePoints[0].currentPos.x-a.gesturePoints[1].currentPos.x),g=Math.atan2(a.gesturePoints[0].lastPos.y-a.gesturePoints[1].lastPos.y,a.gesturePoints[0].lastPos.x-a.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(f-g)*(180/Math.PI))}}this.raiseEvent("canvas-pinch",{tracker:a.eventSource,gesturePoints:a.gesturePoints,lastCenter:a.lastCenter,center:a.center,lastDistance:a.lastDistance,distance:a.distance,shift:a.shift,originalEvent:a.originalEvent});return false}function J(b){var c,f,d,e;d=a.now();e=d-this._lastScrollTime;if(e>this.minScrollDeltaTime){this._lastScrollTime=d;if(!b.preventDefaultAction&&this.viewport){c=this.gestureSettingsByDeviceType(b.pointerType);if(c.scrollToZoom){f=Math.pow(this.zoomPerScroll,b.scroll);this.viewport.zoomBy(f,this.viewport.pointFromPixel(b.position,true));this.viewport.applyConstraints()}}this.raiseEvent("canvas-scroll",{tracker:b.eventSource,position:b.position,scroll:b.scroll,shift:b.shift,originalEvent:b.originalEvent});if(c&&c.scrollToZoom)return false}else return false}function l(a){b[this.hash].mouseInside=true;e(this);this.raiseEvent("container-enter",{tracker:a.eventSource,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function n(a){if(a.pointers<1){b[this.hash].mouseInside=false;!b[this.hash].animating&&d(this)}this.raiseEvent("container-exit",{tracker:a.eventSource,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function q(a){V(a);if(a.isOpen())a._updateRequestId=p(a,q);else a._updateRequestId=false}function V(a){if(a._opening)return;var c;if(a.autoResize){c=m(a.container);if(!c.equals(b[a.hash].prevContainerSize)){if(a.preserveImageSizeOnResize){var i=b[a.hash].prevContainerSize,g=a.viewport.getBounds(true),n=c.x-i.x,o=c.y-i.y,h=a.viewport.deltaPointsFromPixels(new OpenSeadragon.Point(n,o),true);a.viewport.resize(new OpenSeadragon.Point(c.x,c.y),false);g.width+=h.x;g.height+=h.y;g.x-=h.x/2;g.y-=h.y/2;a.viewport.fitBoundsWithConstraints(g,true)}else{var k=a.viewport.getBounds(),l=a.viewport.getCenter();v(a,c,k,l)}b[a.hash].prevContainerSize=c;b[a.hash].forceRedraw=true}}var j=a.viewport.update(),f=a.world.update()||j;j&&a.raiseEvent("viewport-change");if(a.referenceStrip)f=a.referenceStrip.update(a.viewport)||f;if(!b[a.hash].animating&&f){a.raiseEvent("animation-start");e(a)}if(f||b[a.hash].forceRedraw||a.world.needsDraw()){W(a);a._drawOverlays();a.navigator&&a.navigator.update(a.viewport);b[a.hash].forceRedraw=false;f&&a.raiseEvent("animation")}if(b[a.hash].animating&&!f){a.raiseEvent("animation-finish");!b[a.hash].mouseInside&&d(a)}b[a.hash].animating=f}function v(b,d,c,e){if(b.showNavigationControl)if(d.x<b.hideNavCtrlPx||d.y<b.hideNavCtrlPx)b.buttons.element.style.display="none";else b.buttons.element.style.display="inline-block";var f=b.viewport;f.resize(d,true);var g=new a.Rect(e.x-c.width/2,e.y-c.height/2,c.width,c.height);f.fitBoundsWithConstraints(g,true)}function W(a){a.imageLoader.clear();a.drawer.clear();a.world.draw();a.raiseEvent("update-viewport",{})}function c(a,b){return a?a+b:b}function H(){b[this.hash].lastZoomTime=a.now();b[this.hash].zoomFactor=this.zoomPerSecond;b[this.hash].zooming=true;g(this)}function C(){b[this.hash].lastZoomTime=a.now();b[this.hash].zoomFactor=1/this.zoomPerSecond;b[this.hash].zooming=true;g(this)}function T(){b[this.hash].zooming=false}function g(b){a.requestAnimationFrame(a.delegate(b,Z))}function Z(){var c,e,d;if(b[this.hash].zooming&&this.viewport){c=a.now();e=c-b[this.hash].lastZoomTime;d=Math.pow(b[this.hash].zoomFactor,e/1e3);this.viewport.zoomBy(d);this.viewport.applyConstraints();b[this.hash].lastZoomTime=c;g(this)}}function I(){if(this.viewport){b[this.hash].zooming=false;this.viewport.zoomBy(this.zoomPerClick/1);this.viewport.applyConstraints()}}function D(){if(this.viewport){b[this.hash].zooming=false;this.viewport.zoomBy(1/this.zoomPerClick);this.viewport.applyConstraints()}}function Y(){this.buttons.emulateEnter();this.buttons.emulateExit()}function ab(){this.viewport&&this.viewport.goHome()}function R(){if(this.isFullPage()&&!a.isFullScreen())this.setFullPage(false);else this.setFullScreen(!this.isFullPage());this.buttons&&this.buttons.emulateExit();this.fullPageButton.element.focus();this.viewport&&this.viewport.applyConstraints()}function S(){if(this.viewport){var a=this.viewport.getRotation();if(a===0)a=270;else a-=90;this.viewport.setRotation(a)}}function O(){if(this.viewport){var a=this.viewport.getRotation();if(a===270)a=0;else a+=90;this.viewport.setRotation(a)}}function U(){var a=this._sequenceIndex-1;if(this.navPrevNextWrap&&a<0)a+=this.tileSources.length;this.goToPage(a)}function bb(){var a=this._sequenceIndex+1;if(this.navPrevNextWrap&&a>=this.tileSources.length)a=0;this.goToPage(a)}})(OpenSeadragon);(function(a){a.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3};a.Button=function(e){var d=this;a.EventSource.call(this);a.extend(true,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},e);this.element=e.element||a.makeNeutralElement("div");if(!e.element){this.imgRest=a.makeTransparentImage(this.srcRest);this.imgGroup=a.makeTransparentImage(this.srcGroup);this.imgHover=a.makeTransparentImage(this.srcHover);this.imgDown=a.makeTransparentImage(this.srcDown);this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip;this.element.style.position="relative";a.setElementTouchActionNone(this.element);this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute";this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px";this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px";this.imgHover.style.visibility=this.imgDown.style.visibility="hidden";if(a.Browser.vendor==a.BROWSERS.FIREFOX&&a.Browser.version<3)this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="";this.element.appendChild(this.imgRest);this.element.appendChild(this.imgGroup);this.element.appendChild(this.imgHover);this.element.appendChild(this.imgDown)}this.addHandler("press",this.onPress);this.addHandler("release",this.onRelease);this.addHandler("click",this.onClick);this.addHandler("enter",this.onEnter);this.addHandler("exit",this.onExit);this.addHandler("focus",this.onFocus);this.addHandler("blur",this.onBlur);this.currentState=a.ButtonState.GROUP;this.fadeBeginTime=null;this.shouldFade=false;this.element.style.display="inline-block";this.element.style.position="relative";this.element.title=this.tooltip;this.tracker=new a.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(b){if(b.insideElementPressed){c(d,a.ButtonState.DOWN);d.raiseEvent("enter",{originalEvent:b.originalEvent})}else!b.buttonDownAny&&c(d,a.ButtonState.HOVER)},focusHandler:function(a){this.enterHandler(a);d.raiseEvent("focus",{originalEvent:a.originalEvent})},exitHandler:function(c){b(d,a.ButtonState.GROUP);c.insideElementPressed&&d.raiseEvent("exit",{originalEvent:c.originalEvent})},blurHandler:function(a){this.exitHandler(a);d.raiseEvent("blur",{originalEvent:a.originalEvent})},pressHandler:function(b){c(d,a.ButtonState.DOWN);d.raiseEvent("press",{originalEvent:b.originalEvent})},releaseHandler:function(e){if(e.insideElementPressed&&e.insideElementReleased){b(d,a.ButtonState.HOVER);d.raiseEvent("release",{originalEvent:e.originalEvent})}else if(e.insideElementPressed)b(d,a.ButtonState.GROUP);else c(d,a.ButtonState.HOVER)},clickHandler:function(a){a.quick&&d.raiseEvent("click",{originalEvent:a.originalEvent})},keyHandler:function(a){if(13===a.keyCode){d.raiseEvent("click",{originalEvent:a.originalEvent});d.raiseEvent("release",{originalEvent:a.originalEvent});return false}return true}});b(this,a.ButtonState.REST)};a.extend(a.Button.prototype,a.EventSource.prototype,{notifyGroupEnter:function(){c(this,a.ButtonState.GROUP)},notifyGroupExit:function(){b(this,a.ButtonState.REST)},disable:function(){this.notifyGroupExit();this.element.disabled=true;a.setElementOpacity(this.element,.2,true)},enable:function(){this.element.disabled=false;a.setElementOpacity(this.element,1,true);this.notifyGroupEnter()}});function d(b){a.requestAnimationFrame(function(){g(b)})}function g(c){var e,f,b;if(c.shouldFade){e=a.now();f=e-c.fadeBeginTime;b=1-f/c.fadeLength;b=Math.min(1,b);b=Math.max(0,b);c.imgGroup&&a.setElementOpacity(c.imgGroup,b,true);b>0&&d(c)}}function e(b){b.shouldFade=true;b.fadeBeginTime=a.now()+b.fadeDelay;window.setTimeout(function(){d(b)},b.fadeDelay)}function f(b){b.shouldFade=false;b.imgGroup&&a.setElementOpacity(b.imgGroup,1,true)}function c(b,c){if(b.element.disabled)return;if(c>=a.ButtonState.GROUP&&b.currentState==a.ButtonState.REST){f(b);b.currentState=a.ButtonState.GROUP}if(c>=a.ButtonState.HOVER&&b.currentState==a.ButtonState.GROUP){if(b.imgHover)b.imgHover.style.visibility="";b.currentState=a.ButtonState.HOVER}if(c>=a.ButtonState.DOWN&&b.currentState==a.ButtonState.HOVER){if(b.imgDown)b.imgDown.style.visibility="";b.currentState=a.ButtonState.DOWN}}function b(b,c){if(b.element.disabled)return;if(c<=a.ButtonState.HOVER&&b.currentState==a.ButtonState.DOWN){if(b.imgDown)b.imgDown.style.visibility="hidden";b.currentState=a.ButtonState.HOVER}if(c<=a.ButtonState.GROUP&&b.currentState==a.ButtonState.HOVER){if(b.imgHover)b.imgHover.style.visibility="hidden";b.currentState=a.ButtonState.GROUP}if(c<=a.ButtonState.REST&&b.currentState==a.ButtonState.GROUP){e(b);b.currentState=a.ButtonState.REST}}})(OpenSeadragon);(function(a){a.ButtonGroup=function(d){a.extend(true,this,{buttons:[],clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},d);var e=this.buttons.concat([]),b=this,c;this.element=d.element||a.makeNeutralElement("div");if(!d.group){this.label=a.makeNeutralElement("label");this.element.style.display="inline-block";this.element.appendChild(this.label);for(c=0;c<e.length;c++)this.element.appendChild(e[c].element)}a.setElementTouchActionNone(this.element);this.tracker=new a.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){for(var a=0;a<b.buttons.length;a++)b.buttons[a].notifyGroupEnter()},exitHandler:function(c){var a;if(!c.insideElementPressed)for(a=0;a<b.buttons.length;a++)b.buttons[a].notifyGroupExit()}})};a.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}})(OpenSeadragon);(function(a){a.Rect=function(c,d,b,a){this.x=typeof c=="number"?c:0;this.y=typeof d=="number"?d:0;this.width=typeof b=="number"?b:0;this.height=typeof a=="number"?a:0};a.Rect.prototype={clone:function(){return new a.Rect(this.x,this.y,this.width,this.height)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new a.Point(this.x,this.y)},getBottomRight:function(){return new a.Point(this.x+this.width,this.y+this.height)},getTopRight:function(){return new a.Point(this.x+this.width,this.y)},getBottomLeft:function(){return new a.Point(this.x,this.y+this.height)},getCenter:function(){return new a.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new a.Point(this.width,this.height)},equals:function(b){return b instanceof a.Rect&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height},times:function(a){return new OpenSeadragon.Rect(this.x*a,this.y*a,this.width*a,this.height*a)},union:function(a){var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),e=Math.max(this.x+this.width,a.x+a.width),d=Math.max(this.y+this.height,a.y+a.height);return new OpenSeadragon.Rect(b,c,e-b,d-c)},rotate:function(c,e){var f=this.width,d=this.height,b;c=(c+360)%360;if(c%90!==0)throw new Error("Currently only 0, 90, 180, and 270 degrees are supported.");if(c===0)return new a.Rect(this.x,this.y,this.width,this.height);e=e||this.getCenter();switch(c){case 90:b=this.getBottomLeft();f=this.height;d=this.width;break;case 180:b=this.getBottomRight();break;case 270:b=this.getTopRight();f=this.height;d=this.width;break;default:b=this.getTopLeft()}b=b.rotate(c,e);return new a.Rect(b.x,b.y,f,d)},toString:function(){return "["+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+","+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+"]"}}})(OpenSeadragon);(function(a){a.DisplayRect=function(f,g,e,d,c,b){a.Rect.apply(this,[f,g,e,d]);this.minLevel=c;this.maxLevel=b};a.extend(a.DisplayRect.prototype,a.Rect.prototype)})(OpenSeadragon);(function(a){a.TileSource=function(e){var f=this,c=arguments,b,d;if(a.isPlainObject(e))b=e;else b={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]};a.EventSource.call(this);a.extend(true,this,b);if(!this.success)for(d=0;d<arguments.length;d++)if(a.isFunction(arguments[d])){this.success=arguments[d];break}this.success&&this.addHandler("ready",function(a){f.success(a)});if("string"==a.type(arguments[0]))this.url=arguments[0];if(this.url){this.aspectRatio=1;this.dimensions=new a.Point(10,10);this._tileWidth=0;this._tileHeight=0;this.tileOverlap=0;this.minLevel=0;this.maxLevel=0;this.ready=false;this.getImageInfo(this.url)}else{this.ready=true;this.aspectRatio=b.width&&b.height?b.width/b.height:1;this.dimensions=new a.Point(b.width,b.height);if(this.tileSize){this._tileWidth=this._tileHeight=this.tileSize;delete this.tileSize}else{if(this.tileWidth){this._tileWidth=this.tileWidth;delete this.tileWidth}else this._tileWidth=0;if(this.tileHeight){this._tileHeight=this.tileHeight;delete this.tileHeight}else this._tileHeight=0}this.tileOverlap=b.tileOverlap?b.tileOverlap:0;this.minLevel=b.minLevel?b.minLevel:0;this.maxLevel=undefined!==b.maxLevel&&null!==b.maxLevel?b.maxLevel:b.width&&b.height?Math.ceil(Math.log(Math.max(b.width,b.height))/Math.log(2)):0;this.success&&a.isFunction(this.success)&&this.success(this)}};a.TileSource.prototype={getTileSize:function(){a.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead");return this._tileWidth},getTileWidth:function(a){if(!this._tileWidth)return this.getTileSize(a);return this._tileWidth},getTileHeight:function(a){if(!this._tileHeight)return this.getTileSize(a);return this._tileHeight},getLevelScale:function(c){for(var b={},a=0;a<=this.maxLevel;a++)b[a]=1/Math.pow(2,this.maxLevel-a);this.getLevelScale=function(a){return b[a]};return this.getLevelScale(c)},getNumTiles:function(b){var c=this.getLevelScale(b),d=Math.ceil(c*this.dimensions.x/this.getTileWidth(b)),e=Math.ceil(c*this.dimensions.y/this.getTileHeight(b));return new a.Point(d,e)},getPixelRatio:function(c){var b=this.dimensions.times(this.getLevelScale(c)),d=1/b.x,e=1/b.y;return new a.Point(d,e)},getClosestLevel:function(e){for(var c,d,b=this.minLevel;b<this.maxLevel;b++){d=this.getNumTiles(b);c=new a.Point(Math.floor(e.x/this.getTileWidth(b)),Math.floor(e.y/this.getTileHeight(b)));if(d.x+1>=c.x&&d.y+1>=c.y)break}return Math.max(0,b-1)},getTileAtPoint:function(b,d){var c=d.times(this.dimensions.x).times(this.getLevelScale(b)),e=Math.floor(c.x/this.getTileWidth(b)),f=Math.floor(c.y/this.getTileHeight(b));return new a.Point(e,f)},getTileBounds:function(d,g,h){var c=this.dimensions.times(this.getLevelScale(d)),j=this.getTileWidth(d),i=this.getTileHeight(d),k=g===0?0:j*g-this.tileOverlap,l=h===0?0:i*h-this.tileOverlap,e=j+(g===0?1:2)*this.tileOverlap,f=i+(h===0?1:2)*this.tileOverlap,b=1/c.x;e=Math.min(e,c.x-k);f=Math.min(f,c.y-l);return new a.Rect(k*b,l*b,e*b,f*b)},getImageInfo:function(c){var d=this,j,g,k,f,e,h,i;if(c){e=c.split("/");h=e[e.length-1];i=h.lastIndexOf(".");if(i>-1)e[e.length-1]=h.slice(0,i)}g=function(b){if(typeof b==="string")b=a.parseXml(b);var e=a.TileSource.determineType(d,b,c);if(!e){d.raiseEvent("open-failed",{message:"Unable to load TileSource",source:c});return}f=e.prototype.configure.apply(d,[b,c]);if(f.ajaxWithCredentials===undefined)f.ajaxWithCredentials=d.ajaxWithCredentials;k=new e(f);d.ready=true;d.raiseEvent("ready",{tileSource:k})};if(c.match(/\.js$/)){j=c.split("/").pop().replace(".js","");a.jsonp({url:c,async:false,callbackName:j,callback:g})}else a.makeAjaxRequest({url:c,withCredentials:this.ajaxWithCredentials,success:function(c){var a=b(c);g(a)},error:function(f,b){var e;try{e="HTTP "+f.status+" attempting to load TileSource"}catch(g){var a;if(typeof b=="undefined"||!b.toString)a="Unknown error";else a=b.toString();e=a+" attempting to load TileSource"}d.raiseEvent("open-failed",{message:e,source:c})}})},supports:function(){return false},configure:function(){throw new Error("Method not implemented.");},getTileUrl:function(){throw new Error("Method not implemented.");},tileExists:function(a,c,d){var b=this.getNumTiles(a);return a>=this.minLevel&&a<=this.maxLevel&&c>=0&&d>=0&&c<b.x&&d<b.y}};a.extend(true,a.TileSource.prototype,a.EventSource.prototype);function b(b){var c=b.responseText,e=b.status,f,d;if(!b)throw new Error(a.getString("Errors.Security"));else if(b.status!==200&&b.status!==0){e=b.status;f=e==404?"Not Found":b.statusText;throw new Error(a.getString("Errors.Status",e,f));}if(c.match(/\s*<.*/))try{d=b.responseXML&&b.responseXML.documentElement?b.responseXML:a.parseXml(c)}catch(g){d=b.responseText}else if(c.match(/\s*[\{\[].*/))d=a.parseJSON(c);else d=c;return d}a.TileSource.determineType=function(e,c,d){var b;for(b in OpenSeadragon)if(b.match(/.+TileSource$/)&&a.isFunction(OpenSeadragon[b])&&a.isFunction(OpenSeadragon[b].prototype.supports)&&OpenSeadragon[b].prototype.supports.call(e,c,d))return OpenSeadragon[b];a.console.error("No TileSource was able to open %s %s",d,c)}})(OpenSeadragon);(function(a){a.Drawer=function(b){a.console.assert(b.viewer,"[Drawer] options.viewer is required");var c=arguments;if(!a.isPlainObject(b))b={source:c[0],viewport:c[1],element:c[2]};a.console.assert(b.viewport,"[Drawer] options.viewport is required");a.console.assert(b.element,"[Drawer] options.element is required");b.source&&a.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead");this.viewer=b.viewer;this.viewport=b.viewport;this.debugGridColor=b.debugGridColor||a.DEFAULT_SETTINGS.debugGridColor;b.opacity&&a.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead");this.useCanvas=a.supportsCanvas&&(this.viewer?this.viewer.useCanvas:true);this.container=a.getElement(b.element);this.canvas=a.makeNeutralElement(this.useCanvas?"canvas":"div");this.context=this.useCanvas?this.canvas.getContext("2d"):null;this.sketchCanvas=null;this.sketchContext=null;this.element=this.container;this.container.dir="ltr";if(this.useCanvas){var d=this._calculateCanvasSize();this.canvas.width=d.x;this.canvas.height=d.y}this.canvas.style.width="100%";this.canvas.style.height="100%";this.canvas.style.position="absolute";a.setElementOpacity(this.canvas,this.opacity,true);this.container.style.textAlign="left";this.container.appendChild(this.canvas)};a.Drawer.prototype={addOverlay:function(d,c,b,e){a.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead.");this.viewer.addOverlay(d,c,b,e);return this},updateOverlay:function(d,c,b){a.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead.");this.viewer.updateOverlay(d,c,b);return this},removeOverlay:function(b){a.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead.");this.viewer.removeOverlay(b);return this},clearOverlays:function(){a.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead.");this.viewer.clearOverlays();return this},setOpacity:function(d){a.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var c=this.viewer.world,b=0;b<c.getItemCount();b++)c.getItemAt(b).setOpacity(d);return this},getOpacity:function(){a.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,b=0,c=0;c<e.getItemCount();c++){var d=e.getItemAt(c).getOpacity();if(d>b)b=d}return b},needsUpdate:function(){a.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead.");return this.viewer.world.needsDraw()},numTilesLoaded:function(){a.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead.");return this.viewer.tileCache.numTilesLoaded()},reset:function(){a.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead.");this.viewer.world.resetItems();return this},update:function(){a.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead.");this.clear();this.viewer.world.draw();return this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1;this.canvas.height=1;this.sketchCanvas=null;this.sketchContext=null},clear:function(){this.canvas.innerHTML="";if(this.useCanvas){var a=this._calculateCanvasSize();if(this.canvas.width!=a.x||this.canvas.height!=a.y){this.canvas.width=a.x;this.canvas.height=a.y;if(this.sketchCanvas!==null){this.sketchCanvas.width=this.canvas.width;this.sketchCanvas.height=this.canvas.height}}this._clear()}},_clear:function(c){if(!this.useCanvas)return;var a=this._getContext(c),b=a.canvas;a.clearRect(0,0,b.width,b.height)},viewportToDrawerRectangle:function(b){var c=this.viewport.pixelFromPoint(b.getTopLeft(),true),d=this.viewport.deltaPixelsFromPoints(b.getSize(),true);return new a.Rect(c.x*a.pixelDensityRatio,c.y*a.pixelDensityRatio,d.x*a.pixelDensityRatio,d.y*a.pixelDensityRatio)},drawTile:function(b,c,d){a.console.assert(b,"[Drawer.drawTile] tile is required");a.console.assert(c,"[Drawer.drawTile] drawingHandler is required");if(this.useCanvas){var e=this._getContext(d);if(this.viewport.degrees!==0){this._offsetForRotation(b,this.viewport.degrees,d);b.drawCanvas(e,c);this._restoreRotationChanges(b,d)}else b.drawCanvas(e,c)}else b.drawHTML(this.canvas)},_getContext:function(b){var a=this.context;if(b){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");this.sketchCanvas.width=this.canvas.width;this.sketchCanvas.height=this.canvas.height;this.sketchContext=this.sketchCanvas.getContext("2d")}a=this.sketchContext}return a},saveContext:function(a){if(!this.useCanvas)return;this._getContext(a).save()},restoreContext:function(a){if(!this.useCanvas)return;this._getContext(a).restore()},setClip:function(a,c){if(!this.useCanvas)return;var b=this._getContext(c);b.beginPath();b.rect(a.x,a.y,a.width,a.height);b.clip()},drawRectangle:function(b,c,d){if(!this.useCanvas)return;var a=this._getContext(d);a.save();a.fillStyle=c;a.fillRect(b.x,b.y,b.width,b.height);a.restore()},blendSketch:function(a){if(!this.useCanvas||!this.sketchCanvas)return;this.context.save();this.context.globalAlpha=a;this.context.drawImage(this.sketchCanvas,0,0);this.context.restore()},drawDebugInfo:function(b,f,g){if(!this.useCanvas)return;var c=this.context;c.save();c.lineWidth=2*a.pixelDensityRatio;c.font="small-caps bold "+13*a.pixelDensityRatio+"px arial";c.strokeStyle=this.debugGridColor;c.fillStyle=this.debugGridColor;this.viewport.degrees!==0&&this._offsetForRotation(b,this.viewport.degrees);c.strokeRect(b.position.x*a.pixelDensityRatio,b.position.y*a.pixelDensityRatio,b.size.x*a.pixelDensityRatio,b.size.y*a.pixelDensityRatio);var d=(b.position.x+b.size.x/2)*a.pixelDensityRatio,e=(b.position.y+b.size.y/2)*a.pixelDensityRatio;c.translate(d,e);c.rotate(Math.PI/180*-this.viewport.degrees);c.translate(-d,-e);if(b.x===0&&b.y===0){c.fillText("Zoom: "+this.viewport.getZoom(),b.position.x*a.pixelDensityRatio,(b.position.y-30)*a.pixelDensityRatio);c.fillText("Pan: "+this.viewport.getBounds().toString(),b.position.x*a.pixelDensityRatio,(b.position.y-20)*a.pixelDensityRatio)}c.fillText("Level: "+b.level,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+20)*a.pixelDensityRatio);c.fillText("Column: "+b.x,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+30)*a.pixelDensityRatio);c.fillText("Row: "+b.y,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+40)*a.pixelDensityRatio);c.fillText("Order: "+g+" of "+f,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+50)*a.pixelDensityRatio);c.fillText("Size: "+b.size.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+60)*a.pixelDensityRatio);c.fillText("Position: "+b.position.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+70)*a.pixelDensityRatio);this.viewport.degrees!==0&&this._restoreRotationChanges(b);c.restore()},debugRect:function(c){if(this.useCanvas){var b=this.context;b.save();b.lineWidth=2*a.pixelDensityRatio;b.strokeStyle=this.debugGridColor;b.fillStyle=this.debugGridColor;b.strokeRect(c.x*a.pixelDensityRatio,c.y*a.pixelDensityRatio,c.width*a.pixelDensityRatio,c.height*a.pixelDensityRatio);b.restore()}},_offsetForRotation:function(f,e,d){var b=this.canvas.width/2,c=this.canvas.height/2,a=this._getContext(d);a.save();a.translate(b,c);a.rotate(Math.PI/180*e);a.translate(-b,-c)},_restoreRotationChanges:function(c,a){var b=this._getContext(a);b.restore()},_calculateCanvasSize:function(){var b=a.pixelDensityRatio,c=this.viewport.getContainerSize();return {x:c.x*b,y:c.y*b}}}})(OpenSeadragon);(function(a){a.DziTileSource=function(f){var e,d,c,b;if(a.isPlainObject(f))b=f;else b={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]};this._levelRects={};this.tilesUrl=b.tilesUrl;this.fileFormat=b.fileFormat;this.displayRects=b.displayRects;if(this.displayRects)for(e=this.displayRects.length-1;e>=0;e--){d=this.displayRects[e];for(c=d.minLevel;c<=d.maxLevel;c++){if(!this._levelRects[c])this._levelRects[c]=[];this._levelRects[c].push(d)}}a.TileSource.apply(this,[b])};a.extend(a.DziTileSource.prototype,a.TileSource.prototype,{supports:function(a){var b;if(a.Image)b=a.Image.xmlns;else if(a.documentElement)if("Image"==a.documentElement.localName||"Image"==a.documentElement.tagName)b=a.documentElement.namespaceURI;return "http://schemas.microsoft.com/deepzoom/2008"==b||"http://schemas.microsoft.com/deepzoom/2009"==b},configure:function(f,e){var d;if(!a.isPlainObject(f))d=c(this,f);else d=b(this,f);if(e&&!d.tilesUrl){d.tilesUrl=e.replace(/([^\/]+)\.(dzi|xml|js)(\?.*|$)/,"$1_files/");if(e.search(/\.(dzi|xml|js)\?/)!=-1)d.queryParams=e.match(/\?.*/);else d.queryParams=""}return d},getTileUrl:function(a,b,c){return [this.tilesUrl,a,"/",b,"_",c,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,j,k){var f=this._levelRects[e],a,b,c,d,g,h,i;if(!f||!f.length)return true;for(i=f.length-1;i>=0;i--){a=f[i];if(e<a.minLevel||e>a.maxLevel)continue;b=this.getLevelScale(e);c=a.x*b;d=a.y*b;g=c+a.width*b;h=d+a.height*b;c=Math.floor(c/this.tileSize);d=Math.floor(d/this.tileSize);g=Math.ceil(g/this.tileSize);h=Math.ceil(h/this.tileSize);if(c<=j&&j<g&&d<=k&&k<h)return true}return false}});function c(o,i){if(!i||!i.documentElement)throw new Error(a.getString("Errors.Xml"));var c=i.documentElement,l=c.localName||c.tagName,m=i.documentElement.namespaceURI,e=null,k=[],f,g,d,h,j;if(l=="Image")try{h=c.getElementsByTagName("Size")[0];if(h===undefined)h=c.getElementsByTagNameNS(m,"Size")[0];e={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:c.getAttribute("Url"),Format:c.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(c.getAttribute("Overlap"),10),TileSize:parseInt(c.getAttribute("TileSize"),10),Size:{Height:parseInt(h.getAttribute("Height"),10),Width:parseInt(h.getAttribute("Width"),10)}}};if(!a.imageFormatSupported(e.Image.Format))throw new Error(a.getString("Errors.ImageFormat",e.Image.Format.toUpperCase()));f=c.getElementsByTagName("DisplayRect");if(f===undefined)f=c.getElementsByTagNameNS(m,"DisplayRect")[0];for(j=0;j<f.length;j++){g=f[j];d=g.getElementsByTagName("Rect")[0];if(d===undefined)d=g.getElementsByTagNameNS(m,"Rect")[0];k.push({Rect:{X:parseInt(d.getAttribute("X"),10),Y:parseInt(d.getAttribute("Y"),10),Width:parseInt(d.getAttribute("Width"),10),Height:parseInt(d.getAttribute("Height"),10),MinLevel:parseInt(g.getAttribute("MinLevel"),10),MaxLevel:parseInt(g.getAttribute("MaxLevel"),10)}})}if(k.length)e.Image.DisplayRect=k;return b(o,e)}catch(n){throw n instanceof Error?n:new Error(a.getString("Errors.Dzi"));}else if(l=="Collection")throw new Error(a.getString("Errors.Dzc"));else if(l=="Error")return a._processDZIError(c);throw new Error(a.getString("Errors.Dzi"));}function b(o,e){for(var c=e.Image,l=c.Url,j=c.Format,h=c.Size,g=c.DisplayRect||[],n=parseInt(h.Width,10),m=parseInt(h.Height,10),k=parseInt(c.TileSize,10),i=parseInt(c.Overlap,10),f=[],b,d=0;d<g.length;d++){b=g[d].Rect;f.push(new a.DisplayRect(parseInt(b.X,10),parseInt(b.Y,10),parseInt(b.Width,10),parseInt(b.Height,10),parseInt(b.MinLevel,10),parseInt(b.MaxLevel,10)))}return a.extend(true,{width:n,height:m,tileSize:k,tileOverlap:i,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:j,displayRects:f},e)}})(OpenSeadragon);(function(b){var a={supportsFullScreen:false,isFullScreen:function(){return false},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};if(document.exitFullscreen){a.supportsFullScreen=true;a.getFullScreenElement=function(){return document.fullscreenElement};a.requestFullScreen=function(a){return a.requestFullscreen()};a.exitFullScreen=function(){document.exitFullscreen()};a.fullScreenEventName="fullscreenchange";a.fullScreenErrorEventName="fullscreenerror"}else if(document.msExitFullscreen){a.supportsFullScreen=true;a.getFullScreenElement=function(){return document.msFullscreenElement};a.requestFullScreen=function(a){return a.msRequestFullscreen()};a.exitFullScreen=function(){document.msExitFullscreen()};a.fullScreenEventName="MSFullscreenChange";a.fullScreenErrorEventName="MSFullscreenError"}else if(document.webkitExitFullscreen){a.supportsFullScreen=true;a.getFullScreenElement=function(){return document.webkitFullscreenElement};a.requestFullScreen=function(a){return a.webkitRequestFullscreen()};a.exitFullScreen=function(){document.webkitExitFullscreen()};a.fullScreenEventName="webkitfullscreenchange";a.fullScreenErrorEventName="webkitfullscreenerror"}else if(document.webkitCancelFullScreen){a.supportsFullScreen=true;a.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement};a.requestFullScreen=function(a){return a.webkitRequestFullScreen()};a.exitFullScreen=function(){document.webkitCancelFullScreen()};a.fullScreenEventName="webkitfullscreenchange";a.fullScreenErrorEventName="webkitfullscreenerror"}else if(document.mozCancelFullScreen){a.supportsFullScreen=true;a.getFullScreenElement=function(){return document.mozFullScreenElement};a.requestFullScreen=function(a){return a.mozRequestFullScreen()};a.exitFullScreen=function(){document.mozCancelFullScreen()};a.fullScreenEventName="mozfullscreenchange";a.fullScreenErrorEventName="mozfullscreenerror"}a.isFullScreen=function(){return a.getFullScreenElement()!==null};a.cancelFullScreen=function(){b.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead.");a.exitFullScreen()};b.extend(b,a)})(OpenSeadragon);(function(a){a.IIIFTileSource=function(b){a.extend(true,this,b);if(!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");b.tileSizePerScaleFactor={};if(this.tile_width&&this.tile_height){b.tileWidth=this.tile_width;b.tileHeight=this.tile_height}else if(this.tile_width)b.tileSize=this.tile_width;else if(this.tile_height)b.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1){b.tileWidth=this.tiles[0].width;b.tileHeight=this.tiles[0].height||this.tiles[0].width;this.scale_factors=this.tiles[0].scaleFactors}else{this.scale_factors=[];for(var c=0;c<this.tiles.length;c++)for(var g=0;g<this.tiles[c].scaleFactors.length;g++){var h=this.tiles[c].scaleFactors[g];this.scale_factors.push(h);b.tileSizePerScaleFactor[h]={width:this.tiles[c].width,height:this.tiles[c].height||this.tiles[c].width}}}else{for(var i=Math.min(this.height,this.width),f=[256,512,1024],e=[],d=0;d<f.length;d++)f[d]<=i&&e.push(f[d]);if(e.length>0)b.tileSize=Math.max.apply(null,e);else b.tileSize=i}if(!b.maxLevel)if(!this.scale_factors)b.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else b.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5));a.TileSource.apply(this,[b])};a.extend(a.IIIFTileSource.prototype,a.TileSource.prototype,{supports:function(a){if(a.protocol&&a.protocol=="http://iiif.io/api/image")return true;else if(a["@context"]&&(a["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]=="http://iiif.io/api/image/1/context.json"))return true;else if(a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0)return true;else if(a.identifier&&a.width&&a.height)return true;else if(a.documentElement&&"info"==a.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==a.documentElement.namespaceURI)return true;else return false},configure:function(b,e){if(!a.isPlainObject(b)){var d=c(b);d["@context"]="http://iiif.io/api/image/1.0/context.json";d["@id"]=e.replace("/info.xml","");return d}else if(!b["@context"]){b["@context"]="http://iiif.io/api/image/1.0/context.json";b["@id"]=e.replace("/info.json","");return b}else return b},getTileWidth:function(b){var a=Math.pow(2,this.maxLevel-b);if(this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a])return this.tileSizePerScaleFactor[a].width;return this._tileWidth},getTileHeight:function(b){var a=Math.pow(2,this.maxLevel-b);if(this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a])return this.tileSizePerScaleFactor[a].height;return this._tileHeight},getTileUrl:function(l,r,s){var p="0",a=Math.pow(.5,this.maxLevel-l),m=Math.ceil(this.width*a),q=Math.ceil(this.height*a),j,f,c,b,e,h,i,g,n,k,d,o;j=this.getTileWidth(l);f=this.getTileHeight(l);c=Math.ceil(j/a);b=Math.ceil(f/a);if(this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1)d="native.jpg";else d="default.jpg";if(m<j&&q<f){k=m+",";e="full"}else{h=r*c;i=s*b;g=Math.min(c,this.width-h);n=Math.min(b,this.height-i);k=Math.ceil(g*a)+",";e=[h,i,g,n].join(",")}o=[this["@id"],e,k,p,d].join("/");return o}});function c(d){if(!d||!d.documentElement)throw new Error(a.getString("Errors.Xml"));var f=d.documentElement,g=f.tagName,c=null;if(g=="info")try{c={};b(f,c);return c}catch(e){throw e instanceof Error?e:new Error(a.getString("Errors.IIIF"));}throw new Error(a.getString("Errors.IIIF"));}function b(f,c,d){var g,e;if(f.nodeType==3&&d){e=f.nodeValue.trim();if(e.match(/^\d*$/))e=Number(e);if(!c[d])c[d]=e;else{if(!a.isArray(c[d]))c[d]=[c[d]];c[d].push(e)}}else if(f.nodeType==1)for(g=0;g<f.childNodes.length;g++)b(f.childNodes[g],c,f.nodeName)}})(OpenSeadragon);(function(a){function b(b){a.extend(true,this,{timeout:a.DEFAULT_SETTINGS.timeout,jobId:null},b);this.image=null}b.prototype={errorMsg:null,start:function(){var a=this;this.image=new Image;if(this.crossOriginPolicy!==false)this.image.crossOrigin=this.crossOriginPolicy;this.image.onload=function(){a.finish(true)};this.image.onabort=this.image.onerror=function(){a.errorMsg="Image load aborted";a.finish(false)};this.jobId=window.setTimeout(function(){a.errorMsg="Image load exceeded timeout";a.finish(false)},this.timeout);this.image.src=this.src},finish:function(a){this.image.onload=this.image.onerror=this.image.onabort=null;if(!a)this.image=null;this.jobId&&window.clearTimeout(this.jobId);this.callback(this)}};a.ImageLoader=function(b){a.extend(true,this,{jobLimit:a.DEFAULT_SETTINGS.imageLoaderLimit,jobQueue:[],jobsInProgress:0},b)};a.ImageLoader.prototype={addJob:function(a){var g=this,f=function(b){c(g,b,a.callback)},e={src:a.src,crossOriginPolicy:a.crossOriginPolicy,callback:f,abort:a.abort},d=new b(e);if(!this.jobLimit||this.jobsInProgress<this.jobLimit){d.start();this.jobsInProgress++}else this.jobQueue.push(d)},clear:function(){for(var a=0;a<this.jobQueue.length;a++){var b=this.jobQueue[a];typeof b.abort==="function"&&b.abort()}this.jobQueue=[]}};function c(a,c,d){var b;a.jobsInProgress--;if((!a.jobLimit||a.jobsInProgress<a.jobLimit)&&a.jobQueue.length>0){b=a.jobQueue.shift();b.start();a.jobsInProgress++}d(c.image,c.errorMsg)}})(OpenSeadragon);(function(a){a.ImageTileSource=function(b){b=a.extend({buildPyramid:true,crossOriginPolicy:false,ajaxWithCredentials:false,useCanvas:true},b);a.TileSource.apply(this,[b])};a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(a){return a.type&&a.type==="image"},configure:function(a){return a},getImageInfo:function(d){var c=this._image=new Image,b=this;if(this.crossOriginPolicy)c.crossOrigin=this.crossOriginPolicy;if(this.ajaxWithCredentials)c.useCredentials=this.ajaxWithCredentials;a.addEvent(c,"load",function(){b.width=c.naturalWidth;b.height=c.naturalHeight;b.aspectRatio=b.width/b.height;b.dimensions=new a.Point(b.width,b.height);b._tileWidth=b.width;b._tileHeight=b.height;b.tileOverlap=0;b.minLevel=0;b.levels=b._buildLevels();b.maxLevel=b.levels.length-1;b.ready=true;b.raiseEvent("ready",{tileSource:b})});a.addEvent(c,"error",function(){b.raiseEvent("open-failed",{message:"Error loading image at "+d,source:d})});c.src=d},getLevelScale:function(a){var b=NaN;if(a>=this.minLevel&&a<=this.maxLevel)b=this.levels[a].width/this.levels[this.maxLevel].width;return b},getNumTiles:function(b){var c=this.getLevelScale(b);if(c)return new a.Point(1,1);else return new a.Point(0,0)},getTileAtPoint:function(){return new a.Point(0,0)},getTileUrl:function(a){var b=null;if(a>=this.minLevel&&a<=this.maxLevel)b=this.levels[a].url;return b},getContext2D:function(a){var b=null;if(a>=this.minLevel&&a<=this.maxLevel)b=this.levels[a].context2D;return b},_buildLevels:function(){var e=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!a.supportsCanvas||!this.useCanvas){delete this._image;return e}var c=this._image.naturalWidth,b=this._image.naturalHeight,d=document.createElement("canvas"),h=d.getContext("2d");d.width=c;d.height=b;h.drawImage(this._image,0,0,c,b);e[0].context2D=h;delete this._image;if(a.isCanvasTainted(d))return e;while(c>=2&&b>=2){c=Math.floor(c/2);b=Math.floor(b/2);var f=document.createElement("canvas"),g=f.getContext("2d");f.width=c;f.height=b;g.drawImage(d,0,0,c,b);e.splice(0,0,{context2D:g,width:c,height:b});d=f;h=g}return e}})})(OpenSeadragon);(function(a){a.LegacyTileSource=function(f){var b,e,c;if(a.isArray(f))b={type:"legacy-image-pyramid",levels:f};b.levels=d(b.levels);if(b.levels.length>0){e=b.levels[b.levels.length-1].width;c=b.levels[b.levels.length-1].height}else{e=0;c=0;a.console.error("No supported image formats found")}a.extend(true,b,{width:e,height:c,tileSize:Math.max(c,e),tileOverlap:0,minLevel:0,maxLevel:b.levels.length>0?b.levels.length-1:0});a.TileSource.apply(this,[b]);this.levels=b.levels};a.extend(a.LegacyTileSource.prototype,a.TileSource.prototype,{supports:function(a){return a.type&&"legacy-image-pyramid"==a.type||a.documentElement&&"legacy-image-pyramid"==a.documentElement.getAttribute("type")},configure:function(d){var e;if(!a.isPlainObject(d))e=c(this,d);else e=b(this,d);return e},getLevelScale:function(a){var b=NaN;if(this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel)b=this.levels[a].width/this.levels[this.maxLevel].width;return b},getNumTiles:function(b){var c=this.getLevelScale(b);if(c)return new a.Point(1,1);else return new a.Point(0,0)},getTileAtPoint:function(){return new a.Point(0,0)},getTileUrl:function(a){var b=null;if(this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel)b=this.levels[a].url;return b}});function d(e){for(var d=[],b,c=0;c<e.length;c++){b=e[c];if(b.height&&b.width&&b.url&&(b.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||b.mimetype&&b.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/)))d.push({url:b.url,width:Number(b.width),height:Number(b.height)});else a.console.error("Unsupported image format: %s",b.url?b.url:"<no URL>")}return d.sort(function(a,b){return a.height-b.height})}function c(k,d){if(!d||!d.documentElement)throw new Error(a.getString("Errors.Xml"));var i=d.documentElement,c=i.tagName,h=null,g=[],e,f;if(c=="image")try{h={type:i.getAttribute("type"),levels:[]};g=i.getElementsByTagName("level");for(f=0;f<g.length;f++){e=g[f];h.levels.push({url:e.getAttribute("url"),width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10)})}return b(k,h)}catch(j){throw j instanceof Error?j:new Error("Unknown error parsing Legacy Image Pyramid XML.");}else if(c=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");else if(c=="error")throw new Error("Error: "+d);throw new Error("Unknown element "+c);}function b(b,a){return a.levels}})(OpenSeadragon);(function(a){var d=[],e={};a.MouseTracker=function(c){d.push(this);var f=arguments;if(!a.isPlainObject(c))c={element:f[0],clickTimeThreshold:f[1],clickDistThreshold:f[2]};this.hash=Math.random();this.element=a.getElement(c.element);this.clickTimeThreshold=c.clickTimeThreshold||a.DEFAULT_SETTINGS.clickTimeThreshold;this.clickDistThreshold=c.clickDistThreshold||a.DEFAULT_SETTINGS.clickDistThreshold;this.dblClickTimeThreshold=c.dblClickTimeThreshold||a.DEFAULT_SETTINGS.dblClickTimeThreshold;this.dblClickDistThreshold=c.dblClickDistThreshold||a.DEFAULT_SETTINGS.dblClickDistThreshold;this.userData=c.userData||null;this.stopDelay=c.stopDelay||50;this.enterHandler=c.enterHandler||null;this.exitHandler=c.exitHandler||null;this.pressHandler=c.pressHandler||null;this.nonPrimaryPressHandler=c.nonPrimaryPressHandler||null;this.releaseHandler=c.releaseHandler||null;this.nonPrimaryReleaseHandler=c.nonPrimaryReleaseHandler||null;this.moveHandler=c.moveHandler||null;this.scrollHandler=c.scrollHandler||null;this.clickHandler=c.clickHandler||null;this.dblClickHandler=c.dblClickHandler||null;this.dragHandler=c.dragHandler||null;this.dragEndHandler=c.dragEndHandler||null;this.pinchHandler=c.pinchHandler||null;this.stopHandler=c.stopHandler||null;this.keyDownHandler=c.keyDownHandler||null;this.keyUpHandler=c.keyUpHandler||null;this.keyHandler=c.keyHandler||null;this.focusHandler=c.focusHandler||null;this.blurHandler=c.blurHandler||null;var b=this;e[this.hash]={click:function(a){mb(b,a)},dblclick:function(a){gb(b,a)},keydown:function(a){kb(b,a)},keyup:function(a){ob(b,a)},keypress:function(a){hb(b,a)},focus:function(a){nb(b,a)},blur:function(a){qb(b,a)},wheel:function(a){pb(b,a)},mousewheel:function(a){q(b,a)},DOMMouseScroll:function(a){q(b,a)},MozMousePixelScroll:function(a){q(b,a)},mouseenter:function(a){Z(b,a)},mouseleave:function(a){ab(b,a)},mouseover:function(a){eb(b,a)},mouseout:function(a){ib(b,a)},mousedown:function(a){cb(b,a)},mouseup:function(a){lb(b,a)},mouseupcaptured:function(a){U(b,a)},mousemove:function(a){db(b,a)},mousemovecaptured:function(a){P(b,a)},touchstart:function(a){bb(b,a)},touchend:function(a){jb(b,a)},touchendcaptured:function(a){S(b,a)},touchmove:function(a){fb(b,a)},touchmovecaptured:function(a){R(b,a)},touchcancel:function(a){X(b,a)},gesturestart:function(a){W(b,a)},gesturechange:function(a){V(b,a)},pointerover:function(a){J(b,a)},MSPointerOver:function(a){J(b,a)},pointerout:function(a){K(b,a)},MSPointerOut:function(a){K(b,a)},pointerdown:function(a){H(b,a)},MSPointerDown:function(a){H(b,a)},pointerup:function(a){M(b,a)},MSPointerUp:function(a){M(b,a)},pointermove:function(a){I(b,a)},MSPointerMove:function(a){I(b,a)},pointercancel:function(a){E(b,a)},MSPointerCancel:function(a){E(b,a)},pointerupcaptured:function(a){Q(b,a)},pointermovecaptured:function(a){N(b,a)},tracking:false,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null};!c.startDisabled&&this.setTracking(true)};a.MouseTracker.prototype={destroy:function(){var a;L(this);this.element=null;for(a=0;a<d.length;a++)if(d[a]===this){d.splice(a,1);break}e[this.hash]=null;delete e[this.hash]},isTracking:function(){return e[this.hash].tracking},setTracking:function(a){if(a)Y(this);else L(this);return this},getActivePointersListByType:function(f){for(var b=e[this.hash],g=b.activePointersLists.length,d,c=0;c<g;c++)if(b.activePointersLists[c].type===f)return b.activePointersLists[c];d=new a.MouseTracker.GesturePointList(f);b.activePointersLists.push(d);return d},getActivePointerCount:function(){for(var b=e[this.hash],d=b.activePointersLists.length,c=0,a=0;a<d;a++)c+=b.activePointersLists[a].getLength();return c},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};a.MouseTracker.gesturePointVelocityTracker=function(){var b=[],e=0,c=0,d=function(b,a){return b.hash.toString()+a.type+a.id.toString()},g=function(){var f,k=b.length,e,d,j=a.now(),g,h,i;g=j-c;c=j;for(f=0;f<k;f++){e=b[f];d=e.gPoint;d.direction=Math.atan2(d.currentPos.y-e.lastPos.y,d.currentPos.x-e.lastPos.x);h=e.lastPos.distanceTo(d.currentPos);e.lastPos=d.currentPos;i=1e3*h/(g+1);d.speed=.75*i+.25*d.speed}},h=function(h,f){var i=d(h,f);b.push({guid:i,gPoint:f,lastPos:f.currentPos});if(b.length===1){c=a.now();e=window.setInterval(g,50)}},f=function(f,g){for(var h=d(f,g),c=b.length,a=0;a<c;a++)if(b[a].guid===h){b.splice(a,1);c--;c===0&&window.clearInterval(e);break}};return {addPoint:h,removePoint:f}}();a.MouseTracker.captureElement=document;a.MouseTracker.wheelEventName=a.Browser.vendor==a.BROWSERS.IE&&a.Browser.version>8||"onwheel" in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";a.MouseTracker.supportsMouseCapture=function(){var b=document.createElement("div");return a.isFunction(b.setCapture)&&a.isFunction(b.releaseCapture)}();a.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",a.MouseTracker.wheelEventName];a.MouseTracker.wheelEventName=="DOMMouseScroll"&&a.MouseTracker.subscribeEvents.push("MozMousePixelScroll");if(window.PointerEvent&&(window.navigator.pointerEnabled||a.Browser.vendor!==a.BROWSERS.IE)){a.MouseTracker.havePointerEvents=true;a.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel");a.MouseTracker.unprefixedPointerEvents=true;if(navigator.maxTouchPoints)a.MouseTracker.maxTouchPoints=navigator.maxTouchPoints;else a.MouseTracker.maxTouchPoints=0;a.MouseTracker.haveMouseEnter=false}else if(window.MSPointerEvent&&window.navigator.msPointerEnabled){a.MouseTracker.havePointerEvents=true;a.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel");a.MouseTracker.unprefixedPointerEvents=false;if(navigator.msMaxTouchPoints)a.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints;else a.MouseTracker.maxTouchPoints=0;a.MouseTracker.haveMouseEnter=false}else{a.MouseTracker.havePointerEvents=false;if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9){a.MouseTracker.subscribeEvents.push("mouseenter","mouseleave");a.MouseTracker.haveMouseEnter=true}else{a.MouseTracker.subscribeEvents.push("mouseover","mouseout");a.MouseTracker.haveMouseEnter=false}a.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove");"ontouchstart" in window&&a.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel");"ongesturestart" in window&&a.MouseTracker.subscribeEvents.push("gesturestart","gesturechange");a.MouseTracker.mousePointerId="legacy-mouse";a.MouseTracker.maxTouchPoints=10}a.MouseTracker.GesturePointList=function(a){this._gPoints=[];this.type=a;this.buttons=0;this.contacts=0;this.clicks=0;this.captureCount=0};a.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(a){return this._gPoints.push(a)},removeById:function(c){for(var b=this._gPoints.length,a=0;a<b;a++)if(this._gPoints[a].id===c){this._gPoints.splice(a,1);break}return this._gPoints.length},getByIndex:function(a){if(a<this._gPoints.length)return this._gPoints[a];return null},getById:function(c){for(var b=this._gPoints.length,a=0;a<b;a++)if(this._gPoints[a].id===c)return this._gPoints[a];return null},getPrimary:function(){for(var b=this._gPoints.length,a=0;a<b;a++)if(this._gPoints[a].isPrimary)return this._gPoints[a];return null}};function t(f){for(var b=e[f.hash],d=b.activePointersLists.length,c=0;c<d;c++)if(b.activePointersLists[c].captureCount>0){a.removeEvent(a.MouseTracker.captureElement,"mousemove",b.mousemovecaptured,true);a.removeEvent(a.MouseTracker.captureElement,"mouseup",b.mouseupcaptured,true);a.removeEvent(a.MouseTracker.captureElement,a.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",b.pointermovecaptured,true);a.removeEvent(a.MouseTracker.captureElement,a.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",b.pointerupcaptured,true);a.removeEvent(a.MouseTracker.captureElement,"touchmove",b.touchmovecaptured,true);a.removeEvent(a.MouseTracker.captureElement,"touchend",b.touchendcaptured,true);b.activePointersLists[c].captureCount=0}for(c=0;c<d;c++)b.activePointersLists.pop()}function Y(d){var c=e[d.hash],f,b;if(!c.tracking){for(b=0;b<a.MouseTracker.subscribeEvents.length;b++){f=a.MouseTracker.subscribeEvents[b];a.addEvent(d.element,f,c[f],false)}t(d);c.tracking=true}}function L(d){var c=e[d.hash],f,b;if(c.tracking){for(b=0;b<a.MouseTracker.subscribeEvents.length;b++){f=a.MouseTracker.subscribeEvents[b];a.removeEvent(d.element,f,c[f],false)}t(d);c.tracking=false}}function r(d,c){var b=e[d.hash];if(c==="pointerevent")return {upName:a.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:b.pointerupcaptured,moveName:a.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:b.pointermovecaptured};else if(c==="mouse")return {upName:"mouseup",upHandler:b.mouseupcaptured,moveName:"mousemove",moveHandler:b.mousemovecaptured};else if(c==="touch")return {upName:"touchend",upHandler:b.touchendcaptured,moveName:"touchmove",moveHandler:b.touchmovecaptured};else throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.");}function p(c,d){var e=c.getActivePointersListByType(d),b;e.captureCount++;if(e.captureCount===1)if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9)c.element.setCapture(true);else{b=r(c,a.MouseTracker.havePointerEvents?"pointerevent":d);a.addEvent(a.MouseTracker.captureElement,b.upName,b.upHandler,true);a.addEvent(a.MouseTracker.captureElement,b.moveName,b.moveHandler,true)}}function l(c,d){var e=c.getActivePointersListByType(d),b;e.captureCount--;if(e.captureCount===0)if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9)c.element.releaseCapture();else{b=r(c,a.MouseTracker.havePointerEvents?"pointerevent":d);a.removeEvent(a.MouseTracker.captureElement,b.moveName,b.moveHandler,true);a.removeEvent(a.MouseTracker.captureElement,b.upName,b.upHandler,true)}}function f(c){var b;if(a.MouseTracker.unprefixedPointerEvents)b=c.pointerType;else switch(c.pointerType){case 2:b="touch";break;case 3:b="pen";break;case 4:b="mouse";break;default:b=""}return b}function c(b){return a.getMousePosition(b)}function x(d,a){return b(c(d),a)}function b(d,b){var c=a.getElementOffset(b);return d.minus(c)}function k(b,c){return new a.Point((b.x+c.x)/2,(b.y+c.y)/2)}function mb(b,c){b.clickHandler&&a.cancelEvent(c)}function gb(b,c){b.dblClickHandler&&a.cancelEvent(c)}function kb(c,b){var d;if(c.keyDownHandler){b=a.getEvent(b);d=c.keyDownHandler({eventSource:c,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefaultAction:false,userData:c.userData});!d&&a.cancelEvent(b)}}function ob(c,b){var d;if(c.keyUpHandler){b=a.getEvent(b);d=c.keyUpHandler({eventSource:c,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefaultAction:false,userData:c.userData});!d&&a.cancelEvent(b)}}function hb(c,b){var d;if(c.keyHandler){b=a.getEvent(b);d=c.keyHandler({eventSource:c,keyCode:b.keyCode?b.keyCode:b.charCode,ctrl:b.ctrlKey,shift:b.shiftKey,alt:b.altKey,meta:b.metaKey,originalEvent:b,preventDefaultAction:false,userData:c.userData});!d&&a.cancelEvent(b)}}function nb(b,c){var d;if(b.focusHandler){c=a.getEvent(c);d=b.focusHandler({eventSource:b,originalEvent:c,preventDefaultAction:false,userData:b.userData});d===false&&a.cancelEvent(c)}}function qb(b,c){var d;if(b.blurHandler){c=a.getEvent(c);d=b.blurHandler({eventSource:b,originalEvent:c,preventDefaultAction:false,userData:b.userData});d===false&&a.cancelEvent(c)}}function pb(b,a){z(b,a,a)}function q(d,b){b=a.getEvent(b);var c={target:b.target||b.srcElement,type:"wheel",shiftKey:b.shiftKey||false,clientX:b.clientX,clientY:b.clientY,pageX:b.pageX?b.pageX:b.clientX,pageY:b.pageY?b.pageY:b.clientY,deltaMode:b.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};if(a.MouseTracker.wheelEventName=="mousewheel")c.deltaY=-1/a.DEFAULT_SETTINGS.pixelsPerWheelLine*b.wheelDelta;else c.deltaY=b.detail;z(d,c,b)}function z(b,c,d){var f=0,e;f=c.deltaY<0?1:-1;if(b.scrollHandler){e=b.scrollHandler({eventSource:b,pointerType:"mouse",position:x(c,b.element),scroll:f,shift:c.shiftKey,isTouchEvent:false,originalEvent:d,preventDefaultAction:false,userData:b.userData});e===false&&a.cancelEvent(d)}}function h(b,a){if(b===a)return false;while(a&&a!==b)a=a.parentNode;return a===b}function Z(c,b){b=a.getEvent(b);y(c,b)}function eb(c,b){b=a.getEvent(b);if(b.currentTarget===b.relatedTarget||h(b.currentTarget,b.relatedTarget))return;y(c,b)}function y(d,b){var e={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:c(b),currentTime:a.now()};j(d,b,[e])}function ab(c,b){b=a.getEvent(b);A(c,b)}function ib(c,b){b=a.getEvent(b);if(b.currentTarget===b.relatedTarget||h(b.currentTarget,b.relatedTarget))return;A(c,b)}function A(d,b){var e={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:c(b),currentTime:a.now()};g(d,b,[e])}function s(b){if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9)if(b===1)return 0;else if(b===2)return 2;else if(b===4)return 1;else return -1;else return b}function cb(b,d){var e;d=a.getEvent(d);e={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:c(d),currentTime:a.now()};if(n(b,d,[e],s(d.button))){a.stopEvent(d);p(b,"mouse")}(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler)&&a.cancelEvent(d)}function lb(a,b){G(a,b)}function U(c,b){G(c,b);a.stopEvent(b)}function G(d,b){var e;b=a.getEvent(b);e={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:c(b),currentTime:a.now()};i(d,b,[e],s(b.button))&&l(d,"mouse")}function db(a,b){B(a,b)}function P(c,b){B(c,b);a.stopEvent(b)}function B(e,b){var d;b=a.getEvent(b);d={id:a.MouseTracker.mousePointerId,type:"mouse",isPrimary:true,currentPos:c(b),currentTime:a.now()};o(e,b,[d])}function v(c,e,b){for(var f=b.getLength(),a=[],d=0;d<f;d++)a.push(b.getByIndex(d));if(a.length>0){i(c,e,a,0);b.captureCount=1;l(c,"touch");g(c,e,a)}}function bb(f,b){console.log("onTouchStart");var m,e,g,k=b.changedTouches.length,l=[],i,o=f.getActivePointersListByType("touch");m=a.now();if(o.getLength()>b.touches.length-k){a.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers.");v(f,b,o)}for(e=0;e<k;e++)l.push({id:b.changedTouches[e].identifier,type:"touch",currentPos:c(b.changedTouches[e]),currentTime:m});j(f,b,l);for(e=0;e<d.length;e++)if(d[e]!==f&&d[e].isTracking()&&h(d[e].element,f.element)){i=[];for(g=0;g<k;g++)i.push({id:b.changedTouches[g].identifier,type:"touch",currentPos:c(b.changedTouches[g]),currentTime:m});j(d[e],b,i)}if(n(f,b,l,0)){a.stopEvent(b);p(f,"touch")}a.cancelEvent(b)}function jb(a,b){console.log("onTouchEnd");F(a,b)}function S(c,b){console.log("onTouchEndCaptured");F(c,b);a.stopEvent(b)}function F(f,e){var n,b,j,o=e.changedTouches.length,m=[],k;n=a.now();for(b=0;b<o;b++)m.push({id:e.changedTouches[b].identifier,type:"touch",currentPos:c(e.changedTouches[b]),currentTime:n});i(f,e,m,0)&&l(f,"touch");g(f,e,m);for(b=0;b<d.length;b++)if(d[b]!==f&&d[b].isTracking()&&h(d[b].element,f.element)){k=[];for(j=0;j<o;j++)k.push({id:e.changedTouches[j].identifier,type:"touch",currentPos:c(e.changedTouches[j]),currentTime:n});g(d[b],e,k)}a.cancelEvent(e)}function fb(a,b){D(a,b)}function R(c,b){D(c,b);a.stopEvent(b)}function D(g,b){for(var f=b.changedTouches.length,e=[],d=0;d<f;d++)e.push({id:b.changedTouches[d].identifier,type:"touch",currentPos:c(b.changedTouches[d]),currentTime:a.now()});o(g,b,e);a.cancelEvent(b)}function X(a,b){var f,d=b.changedTouches.length,e=[],c=a.getActivePointersListByType("touch");v(a,b,c)}function W(b,a){console.log("onGestureStart");a.stopPropagation();a.preventDefault();return false}function V(b,a){console.log("onGestureChange");a.stopPropagation();a.preventDefault();return false}function J(e,b){console.log("onPointerOver");var d;if(b.currentTarget===b.relatedTarget||h(b.currentTarget,b.relatedTarget))return;d={id:b.pointerId,type:f(b),isPrimary:b.isPrimary,currentPos:c(b),currentTime:a.now()};j(e,b,[d])}function K(e,b){console.log("onPointerOut");var d;if(b.currentTarget===b.relatedTarget||h(b.currentTarget,b.relatedTarget))return;d={id:b.pointerId,type:f(b),isPrimary:b.isPrimary,currentPos:c(b),currentTime:a.now()};g(e,b,[d])}function H(b,d){console.log("onPointerDown");var e;e={id:d.pointerId,type:f(d),isPrimary:d.isPrimary,currentPos:c(d),currentTime:a.now()};if(n(b,d,[e],d.button)){a.stopEvent(d);p(b,e.type)}(b.clickHandler||b.dblClickHandler||b.pressHandler||b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.cancelEvent(d)}function M(a,b){console.log("onPointerUp");C(a,b)}function Q(c,b){console.log("onPointerUpCaptured");var d=c.getActivePointersListByType(f(b));d.getById(b.pointerId)&&C(c,b);a.stopEvent(b)}function C(e,b){var d;d={id:b.pointerId,type:f(b),isPrimary:b.isPrimary,currentPos:c(b),currentTime:a.now()};i(e,b,[d],b.button)&&l(e,d.type)}function I(a,b){console.log("onPointerMove");w(a,b)}function N(c,b){console.log("onPointerMoveCaptured");var d=c.getActivePointersListByType(f(b));d.getById(b.pointerId)&&w(c,b);a.stopEvent(b)}function w(e,b){var d;d={id:b.pointerId,type:f(b),isPrimary:b.isPrimary,currentPos:c(b),currentTime:a.now()};o(e,b,[d])}function E(c,a){var b;b={id:a.pointerId,type:f(a)};O(c,a,[b])}function m(b,a){if(!a.hasOwnProperty("isPrimary"))if(b.getLength()===0)a.isPrimary=true;else a.isPrimary=false;a.speed=0;a.direction=0;a.contactPos=a.currentPos;a.contactTime=a.currentTime;a.lastPos=a.currentPos;a.lastTime=a.currentTime;return b.add(a)}function u(b,d){var c,a;if(b.getById(d.id)){c=b.removeById(d.id);if(!d.hasOwnProperty("isPrimary")){a=b.getPrimary();if(!a){a=b.getByIndex(0);if(a)a.isPrimary=true}}}else c=b.getLength();return c}function j(e,j,g){for(var f=e.getActivePointersListByType(g[0].type),k=g.length,c,d,i,h=0;h<k;h++){c=g[h];d=f.getById(c.id);if(d){d.insideElement=true;d.lastPos=d.currentPos;d.lastTime=d.currentTime;d.currentPos=c.currentPos;d.currentTime=c.currentTime;c=d}else{c.captured=false;c.insideElementPressed=false;c.insideElement=true;m(f,c)}if(e.enterHandler){i=e.enterHandler({eventSource:e,pointerType:c.type,position:b(c.currentPos,e.element),buttons:f.buttons,pointers:e.getActivePointerCount(),insideElementPressed:c.insideElementPressed,buttonDownAny:f.buttons!==0,isTouchEvent:c.type==="touch",originalEvent:j,preventDefaultAction:false,userData:e.userData});i===false&&a.cancelEvent(j)}}}function g(f,k,h){for(var m=e[f.hash],g=f.getActivePointersListByType(h[0].type),l=h.length,d,c,j,i=0;i<l;i++){d=h[i];c=g.getById(d.id);if(c){if(c.captured){c.insideElement=false;c.lastPos=c.currentPos;c.lastTime=c.currentTime;c.currentPos=d.currentPos;c.currentTime=d.currentTime}else u(g,c);d=c}if(f.exitHandler){j=f.exitHandler({eventSource:f,pointerType:d.type,position:b(d.currentPos,f.element),buttons:g.buttons,pointers:f.getActivePointerCount(),insideElementPressed:c?c.insideElementPressed:false,buttonDownAny:g.buttons!==0,isTouchEvent:d.type==="touch",originalEvent:k,preventDefaultAction:false,userData:f.userData});j===false&&a.cancelEvent(k)}}}function n(d,l,j,g){var i=e[d.hash],n,c=d.getActivePointersListByType(j[0].type),o,p=j.length,f,h;if(typeof l.buttons!=="undefined")c.buttons=l.buttons;else if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9){if(g===0)c.buttons+=1;else if(g===1)c.buttons+=4;else if(g===2)c.buttons+=2;else if(g===3)c.buttons+=8;else if(g===4)c.buttons+=16;else if(g===5)c.buttons+=32}else if(g===0)c.buttons|=1;else if(g===1)c.buttons|=4;else if(g===2)c.buttons|=2;else if(g===3)c.buttons|=8;else if(g===4)c.buttons|=16;else if(g===5)c.buttons|=32;if(g!==0){if(d.nonPrimaryPressHandler){n=d.nonPrimaryPressHandler({eventSource:d,pointerType:j[0].type,position:b(j[0].currentPos,d.element),button:g,buttons:c.buttons,isTouchEvent:j[0].type==="touch",originalEvent:l,preventDefaultAction:false,userData:d.userData});n===false&&a.cancelEvent(l)}return false}for(o=0;o<p;o++){f=j[o];h=c.getById(f.id);if(h){h.captured=true;h.insideElementPressed=true;h.insideElement=true;h.contactPos=f.currentPos;h.contactTime=f.currentTime;h.lastPos=h.currentPos;h.lastTime=h.currentTime;h.currentPos=f.currentPos;h.currentTime=f.currentTime;f=h}else{f.captured=true;f.insideElementPressed=true;f.insideElement=true;m(c,f)}c.contacts++;(d.dragHandler||d.dragEndHandler||d.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.addPoint(d,f);if(c.contacts===1){if(d.pressHandler){n=d.pressHandler({eventSource:d,pointerType:f.type,position:b(f.contactPos,d.element),buttons:c.buttons,isTouchEvent:f.type==="touch",originalEvent:l,preventDefaultAction:false,userData:d.userData});n===false&&a.cancelEvent(l)}}else if(c.contacts===2)if(d.pinchHandler&&f.type==="touch"){i.pinchGPoints=c.asArray();i.lastPinchDist=i.currentPinchDist=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos);i.lastPinchCenter=i.currentPinchCenter=k(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos)}}return true}function i(c,g,m,h){var i=e[c.hash],f=c.getActivePointersListByType(m[0].type),j,v,l,r,o,t=m.length,n,d,q=false,s=false,p;if(typeof g.buttons!=="undefined")f.buttons=g.buttons;else if(a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<9){if(h===0)f.buttons-=1;else if(h===1)f.buttons-=4;else if(h===2)f.buttons-=2;else if(h===3)f.buttons-=8;else if(h===4)f.buttons-=16;else if(h===5)f.buttons-=32}else if(h===0)f.buttons^=~1;else if(h===1)f.buttons^=~4;else if(h===2)f.buttons^=~2;else if(h===3)f.buttons^=~8;else if(h===4)f.buttons^=~16;else if(h===5)f.buttons^=~32;if(h!==0){if(c.nonPrimaryReleaseHandler){j=c.nonPrimaryReleaseHandler({eventSource:c,pointerType:m[0].type,position:b(m[0].currentPos,c.element),button:h,buttons:f.buttons,isTouchEvent:m[0].type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}return false}for(o=0;o<t;o++){n=m[o];d=f.getById(n.id);if(d){if(d.captured){d.captured=false;q=true;s=true}d.lastPos=d.currentPos;d.lastTime=d.currentTime;d.currentPos=n.currentPos;d.currentTime=n.currentTime;!d.insideElement&&u(f,d);l=d.currentPos;r=d.currentTime;if(s){f.contacts--;(c.dragHandler||c.dragEndHandler||c.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.removePoint(c,d);if(f.contacts===0){if(c.releaseHandler){j=c.releaseHandler({eventSource:c,pointerType:d.type,position:b(l,c.element),buttons:f.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}if(c.dragEndHandler&&!d.currentPos.equals(d.contactPos)){j=c.dragEndHandler({eventSource:c,pointerType:d.type,position:b(d.currentPos,c.element),speed:d.speed,direction:d.direction,shift:g.shiftKey,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}if((c.clickHandler||c.dblClickHandler)&&d.insideElement){p=r-d.contactTime<=c.clickTimeThreshold&&d.contactPos.distanceTo(l)<=c.clickDistThreshold;if(c.clickHandler){j=c.clickHandler({eventSource:c,pointerType:d.type,position:b(d.currentPos,c.element),quick:p,shift:g.shiftKey,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}if(c.dblClickHandler&&p){f.clicks++;if(f.clicks===1){i.lastClickPos=l;i.dblClickTimeOut=setTimeout(function(){f.clicks=0},c.dblClickTimeThreshold)}else if(f.clicks===2){clearTimeout(i.dblClickTimeOut);f.clicks=0;if(i.lastClickPos.distanceTo(l)<=c.dblClickDistThreshold){j=c.dblClickHandler({eventSource:c,pointerType:d.type,position:b(d.currentPos,c.element),shift:g.shiftKey,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}i.lastClickPos=null}}}}else if(f.contacts===2)if(c.pinchHandler&&d.type==="touch"){i.pinchGPoints=f.asArray();i.lastPinchDist=i.currentPinchDist=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos);i.lastPinchCenter=i.currentPinchCenter=k(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos)}}else if(c.releaseHandler){j=c.releaseHandler({eventSource:c,pointerType:d.type,position:b(l,c.element),buttons:f.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}}}return q}function o(c,g,l){var f=e[c.hash],h=c.getActivePointersListByType(l[0].type),p,q=l.length,i,d,n,o,j;if(typeof g.buttons!=="undefined")h.buttons=g.buttons;for(p=0;p<q;p++){i=l[p];d=h.getById(i.id);if(d){if(i.hasOwnProperty("isPrimary"))d.isPrimary=i.isPrimary;d.lastPos=d.currentPos;d.lastTime=d.currentTime;d.currentPos=i.currentPos;d.currentTime=i.currentTime}else{i.captured=false;i.insideElementPressed=false;i.insideElement=true;m(h,i)}}if(c.stopHandler&&l[0].type==="mouse"){clearTimeout(c.stopTimeOut);c.stopTimeOut=setTimeout(function(){T(c,g,l[0].type)},c.stopDelay)}if(h.contacts===0){if(c.moveHandler){j=c.moveHandler({eventSource:c,pointerType:l[0].type,position:b(l[0].currentPos,c.element),buttons:h.buttons,isTouchEvent:l[0].type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}}else if(h.contacts===1){if(c.moveHandler){d=h.asArray()[0];j=c.moveHandler({eventSource:c,pointerType:d.type,position:b(d.currentPos,c.element),buttons:h.buttons,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}if(c.dragHandler){d=h.asArray()[0];o=d.currentPos.minus(d.lastPos);j=c.dragHandler({eventSource:c,pointerType:d.type,position:b(d.currentPos,c.element),buttons:h.buttons,delta:o,speed:d.speed,direction:d.direction,shift:g.shiftKey,isTouchEvent:d.type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}}else if(h.contacts===2){if(c.moveHandler){n=h.asArray();j=c.moveHandler({eventSource:c,pointerType:n[0].type,position:b(k(n[0].currentPos,n[1].currentPos),c.element),buttons:h.buttons,isTouchEvent:n[0].type==="touch",originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}if(c.pinchHandler&&l[0].type==="touch"){o=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos);if(o!=f.currentPinchDist){f.lastPinchDist=f.currentPinchDist;f.currentPinchDist=o;f.lastPinchCenter=f.currentPinchCenter;f.currentPinchCenter=k(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos);j=c.pinchHandler({eventSource:c,pointerType:"touch",gesturePoints:f.pinchGPoints,lastCenter:b(f.lastPinchCenter,c.element),center:b(f.currentPinchCenter,c.element),lastDistance:f.lastPinchDist,distance:f.currentPinchDist,shift:g.shiftKey,originalEvent:g,preventDefaultAction:false,userData:c.userData});j===false&&a.cancelEvent(g)}}}}function O(b,c,a){i(b,c,a,0);g(b,c,a)}function T(a,c,b){a.stopHandler&&a.stopHandler({eventSource:a,pointerType:b,position:x(c,a.element),buttons:a.getActivePointersListByType(b).buttons,isTouchEvent:b==="touch",originalEvent:c,preventDefaultAction:false,userData:a.userData})}})(OpenSeadragon);(function(a){a.Navigator=function(g){var i=g.viewer,h=this,j,k;if(!g.id){g.id="navigator-"+a.now();this.element=a.makeNeutralElement("div");g.controlOptions={anchor:a.ControlAnchor.TOP_RIGHT,attachToViewer:true,autoFade:true};if(g.position)if("BOTTOM_RIGHT"==g.position)g.controlOptions.anchor=a.ControlAnchor.BOTTOM_RIGHT;else if("BOTTOM_LEFT"==g.position)g.controlOptions.anchor=a.ControlAnchor.BOTTOM_LEFT;else if("TOP_RIGHT"==g.position)g.controlOptions.anchor=a.ControlAnchor.TOP_RIGHT;else if("TOP_LEFT"==g.position)g.controlOptions.anchor=a.ControlAnchor.TOP_LEFT;else if("ABSOLUTE"==g.position){g.controlOptions.anchor=a.ControlAnchor.ABSOLUTE;g.controlOptions.top=g.top;g.controlOptions.left=g.left;g.controlOptions.height=g.height;g.controlOptions.width=g.width}}else{this.element=document.getElementById(g.id);g.controlOptions={anchor:a.ControlAnchor.NONE,attachToViewer:false,autoFade:false}}this.element.id=g.id;this.element.className+=" navigator";g=a.extend(true,{sizeRatio:a.DEFAULT_SETTINGS.navigatorSizeRatio},g,{element:this.element,tabIndex:-1,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false,immediateRender:true,blendTime:0,animationTime:0,autoResize:g.autoResize,minZoomImageRatio:1});g.minPixelRatio=this.minPixelRatio=i.minPixelRatio;a.setElementTouchActionNone(this.element);this.borderWidth=2;this.fudge=new a.Point(1,1);this.totalBorderWidths=(new a.Point(this.borderWidth*2,this.borderWidth*2)).minus(this.fudge);g.controlOptions.anchor!=a.ControlAnchor.NONE&&(function(a,b){a.margin="0px";a.border=b+"px solid #555";a.padding="0px";a.background="#000";a.opacity=.8;a.overflow="hidden"})(this.element.style,this.borderWidth);this.displayRegion=a.makeNeutralElement("div");this.displayRegion.id=this.element.id+"-displayregion";this.displayRegion.className="displayregion";(function(a,b){a.position="relative";a.top="0px";a.left="0px";a.fontSize="0px";a.overflow="hidden";a.border=b+"px solid #900";a.margin="0px";a.padding="0px";a.background="transparent";a["float"]="left";a.cssFloat="left";a.styleFloat="left";a.zIndex=999999999;a.cursor="default"})(this.displayRegion.style,this.borderWidth);this.displayRegionContainer=a.makeNeutralElement("div");this.displayRegionContainer.id=this.element.id+"-displayregioncontainer";this.displayRegionContainer.className="displayregioncontainer";this.displayRegionContainer.style.width="100%";this.displayRegionContainer.style.height="100%";i.addControl(this.element,g.controlOptions);this._resizeWithViewer=g.controlOptions.anchor!=a.ControlAnchor.ABSOLUTE&&g.controlOptions.anchor!=a.ControlAnchor.NONE;if(this._resizeWithViewer){if(g.width&&g.height){this.element.style.height=typeof g.height=="number"?g.height+"px":g.height;this.element.style.width=typeof g.width=="number"?g.width+"px":g.width}else{j=a.getElementSize(i.element);this.element.style.height=Math.round(j.y*g.sizeRatio)+"px";this.element.style.width=Math.round(j.x*g.sizeRatio)+"px";this.oldViewerSize=j}k=a.getElementSize(this.element);this.elementArea=k.x*k.y}this.oldContainerSize=new a.Point(0,0);a.Viewer.apply(this,[g]);this.displayRegionContainer.appendChild(this.displayRegion);this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);g.navigatorRotate&&g.viewer.addHandler("rotate",function(a){b(h.displayRegionContainer,a.degrees);b(h.displayRegion,-a.degrees);h.viewport.setRotation(a.degrees)});this.innerTracker.destroy();this.innerTracker=new a.MouseTracker({element:this.element,dragHandler:a.delegate(this,f),clickHandler:a.delegate(this,e),releaseHandler:a.delegate(this,c),scrollHandler:a.delegate(this,d)});this.addHandler("reset-size",function(){h.viewport&&h.viewport.goHome(true)});this.addHandler("reset-size",function(){h.viewport&&h.viewport.goHome(true)});i.world.addHandler("item-index-change",function(a){var b=h.world.getItemAt(a.previousIndex);h.world.setItemIndex(b,a.newIndex)});i.world.addHandler("remove-item",function(c){var b=c.item,a=h._getMatchingItem(b);a&&h.world.removeItem(a)});this.update(i.viewport)};a.extend(a.Navigator.prototype,a.EventSource.prototype,a.Viewer.prototype,{updateSize:function(){if(this.viewport){var b=new a.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);if(!b.equals(this.oldContainerSize)){this.viewport.resize(b,true);this.viewport.goHome(true);this.oldContainerSize=b;this.drawer.clear();this.world.draw()}}},update:function(i){var b,c,f,h,d,g;b=a.getElementSize(this.viewer.element);if(this._resizeWithViewer&&b.x&&b.y&&!b.equals(this.oldViewerSize)){this.oldViewerSize=b;if(this.maintainSizeRatio||!this.elementArea){c=b.x*this.sizeRatio;f=b.y*this.sizeRatio}else{c=Math.sqrt(this.elementArea*(b.x/b.y));f=this.elementArea/c}this.element.style.width=Math.round(c)+"px";this.element.style.height=Math.round(f)+"px";if(!this.elementArea)this.elementArea=c*f;this.updateSize()}if(i&&this.viewport){h=i.getBounds(true);d=this.viewport.pixelFromPoint(h.getTopLeft(),false);g=this.viewport.pixelFromPoint(h.getBottomRight(),false).minus(this.totalBorderWidths);var e=this.displayRegion.style;e.display=this.world.getItemCount()?"block":"none";e.top=Math.round(d.y)+"px";e.left=Math.round(d.x)+"px";var k=Math.abs(d.x-g.x),j=Math.abs(d.y-g.y);e.width=Math.round(Math.max(k,0))+"px";e.height=Math.round(Math.max(j,0))+"px"}},addTiledImage:function(c){var d=this,b=c.originalTiledImage;delete c.original;var e=a.extend({},c,{success:function(c){var a=c.item;a._originalForNavigator=b;d._matchBounds(a,b,true);b.addHandler("bounds-change",function(){d._matchBounds(a,b)})}});return a.Viewer.prototype.addTiledImage.apply(this,[e])},_getMatchingItem:function(c){for(var d=this.world.getItemCount(),a,b=0;b<d;b++){a=this.world.getItemAt(b);if(a._originalForNavigator===c)return a}return null},_matchBounds:function(c,d,a){var b=d.getBounds();c.setPosition(b.getTopLeft(),a);c.setWidth(b.width,a)}});function e(a){if(a.quick&&this.viewer.viewport){this.viewer.viewport.panTo(this.viewport.pointFromPixel(a.position).rotate(-this.viewer.viewport.degrees,this.viewer.viewport.getHomeBounds().getCenter()));this.viewer.viewport.applyConstraints()}}function f(a){console.log("navigator onCanvasDrag");if(this.viewer.viewport){if(!this.panHorizontal)a.delta.x=0;if(!this.panVertical)a.delta.y=0;this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta))}}function c(a){a.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function d(a){this.viewer.raiseEvent("navigator-scroll",{tracker:a.eventSource,position:a.position,scroll:a.scroll,shift:a.shift,originalEvent:a.originalEvent});return false}function b(b,a){b.style.webkitTransform="rotate("+a+"deg)";b.style.mozTransform="rotate("+a+"deg)";b.style.msTransform="rotate("+a+"deg)";b.style.oTransform="rotate("+a+"deg)";b.style.transform="rotate("+a+"deg)"}})(OpenSeadragon);(function(a){a.OsmTileSource=function(c){var b;if(a.isPlainObject(c))b=c;else b={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};if(!b.width||!b.height){b.width=65572864;b.height=65572864}if(!b.tileSize){b.tileSize=256;b.tileOverlap=0}if(!b.tilesUrl)b.tilesUrl="http://tile.openstreetmap.org/";b.minLevel=8;a.TileSource.apply(this,[b])};a.extend(a.OsmTileSource.prototype,a.TileSource.prototype,{supports:function(a){return a.type&&"openstreetmaps"==a.type},configure:function(a){return a},getTileUrl:function(a,b,c){return this.tilesUrl+(a-8)+"/"+b+"/"+c+".png"}})})(OpenSeadragon);(function(a){a.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8};a.Overlay=function(c,e,d){var b;if(a.isPlainObject(c))b=c;else b={element:c,location:e,placement:d};this.element=b.element;this.scales=b.location instanceof a.Rect;this.bounds=new a.Rect(b.location.x,b.location.y,b.location.width,b.location.height);this.position=new a.Point(b.location.x,b.location.y);this.size=new a.Point(b.location.width,b.location.height);this.style=b.element.style;this.placement=b.location instanceof a.Point?b.placement:a.OverlayPlacement.TOP_LEFT;this.onDraw=b.onDraw;this.checkResize=b.checkResize===undefined?true:b.checkResize};a.Overlay.prototype={adjust:function(b,c){switch(this.placement){case a.OverlayPlacement.TOP_LEFT:break;case a.OverlayPlacement.TOP:b.x-=c.x/2;break;case a.OverlayPlacement.TOP_RIGHT:b.x-=c.x;break;case a.OverlayPlacement.RIGHT:b.x-=c.x;b.y-=c.y/2;break;case a.OverlayPlacement.BOTTOM_RIGHT:b.x-=c.x;b.y-=c.y;break;case a.OverlayPlacement.BOTTOM:b.x-=c.x/2;b.y-=c.y;break;case a.OverlayPlacement.BOTTOM_LEFT:b.y-=c.y;break;case a.OverlayPlacement.LEFT:b.y-=c.y/2;break;default:case a.OverlayPlacement.CENTER:b.x-=c.x/2;b.y-=c.y/2}},destroy:function(){var b=this.element,a=this.style;if(b.parentNode){b.parentNode.removeChild(b);if(b.prevElementParent){a.display="none";document.body.appendChild(b)}}this.onDraw=null;a.top="";a.left="";a.position="";if(this.scales){a.width="";a.height=""}},drawHTML:function(i,f){var d=this.element,e=this.style,j=this.scales,h=f.degrees,c=f.pixelFromPoint(this.bounds.getTopLeft(),true),b,g;if(d.parentNode!=i){d.prevElementParent=d.parentNode;d.prevNextSibling=d.nextSibling;i.appendChild(d);this.size=a.getElementSize(d)}if(j)b=f.deltaPixelsFromPoints(this.bounds.getSize(),true);else if(this.checkResize)b=a.getElementSize(d);else b=this.size;this.position=c;this.size=b;this.adjust(c,b);c=c.apply(Math.round);b=b.apply(Math.round);if(h!==0&&this.scales){g=new a.Point(b.x/2,b.y/2);var k=new a.Point(f.viewer.drawer.canvas.width/2,f.viewer.drawer.canvas.height/2);c=c.plus(g).rotate(h,k).minus(g);b=b.rotate(h,new a.Point(0,0));b=new a.Point(Math.abs(b.x),Math.abs(b.y))}if(this.onDraw)this.onDraw(c,b,d);else{e.left=c.x+"px";e.top=c.y+"px";e.position="absolute";if(e.display!="none")e.display="block";if(j){e.width=b.x+"px";e.height=b.y+"px"}}},update:function(b,c){this.scales=b instanceof a.Rect;this.bounds=new a.Rect(b.x,b.y,b.width,b.height);this.placement=b instanceof a.Point?c:a.OverlayPlacement.TOP_LEFT}}})(OpenSeadragon);(function(a){a.Point=function(a,b){this.x=typeof a=="number"?a:0;this.y=typeof b=="number"?b:0};a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},plus:function(b){return new a.Point(this.x+b.x,this.y+b.y)},minus:function(b){return new a.Point(this.x-b.x,this.y-b.y)},times:function(b){return new a.Point(this.x*b,this.y*b)},divide:function(b){return new a.Point(this.x/b,this.y/b)},negate:function(){return new a.Point(-this.x,-this.y)},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},apply:function(b){return new a.Point(b(this.x),b(this.y))},equals:function(b){return b instanceof a.Point&&this.x===b.x&&this.y===b.y},rotate:function(d,b){var c=d*Math.PI/180,e=Math.cos(c)*(this.x-b.x)-Math.sin(c)*(this.y-b.y)+b.x,f=Math.sin(c)*(this.x-b.x)+Math.cos(c)*(this.y-b.y)+b.y;return new a.Point(e,f)},toString:function(){return "("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}})(OpenSeadragon);(function(a){a.Profiler=function(){this.midUpdate=false;this.numUpdates=0;this.lastBeginTime=null;this.lastEndTime=null;this.minUpdateTime=Infinity;this.avgUpdateTime=0;this.maxUpdateTime=0;this.minIdleTime=Infinity;this.avgIdleTime=0;this.maxIdleTime=0};a.Profiler.prototype={beginUpdate:function(){this.midUpdate&&this.endUpdate();this.midUpdate=true;this.lastBeginTime=a.now();if(this.numUpdates<1)return;var b=this.lastBeginTime-this.lastEndTime;this.avgIdleTime=(this.avgIdleTime*(this.numUpdates-1)+b)/this.numUpdates;if(b<this.minIdleTime)this.minIdleTime=b;if(b>this.maxIdleTime)this.maxIdleTime=b},endUpdate:function(){if(!this.midUpdate)return;this.lastEndTime=a.now();this.midUpdate=false;var b=this.lastEndTime-this.lastBeginTime;this.numUpdates++;this.avgUpdateTime=(this.avgUpdateTime*(this.numUpdates-1)+b)/this.numUpdates;if(b<this.minUpdateTime)this.minUpdateTime=b;if(b>this.maxUpdateTime)this.maxUpdateTime=b},clearProfile:function(){this.midUpdate=false;this.numUpdates=0;this.lastBeginTime=null;this.lastEndTime=null;this.minUpdateTime=Infinity;this.avgUpdateTime=0;this.maxUpdateTime=0;this.minIdleTime=Infinity;this.avgIdleTime=0;this.maxIdleTime=0}}})(OpenSeadragon);(function(a){var e={};a.ReferenceStrip=function(j){var p=this,l=j.viewer,n=a.getElementSize(l.element),k,m,o;if(!j.id){j.id="referencestrip-"+a.now();this.element=a.makeNeutralElement("div");this.element.id=j.id;this.element.className="referencestrip"}j=a.extend(true,{sizeRatio:a.DEFAULT_SETTINGS.referenceStripSizeRatio,position:a.DEFAULT_SETTINGS.referenceStripPosition,scroll:a.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold},j,{element:this.element,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false});a.extend(this,j);e[this.id]={animating:false};this.minPixelRatio=this.viewer.minPixelRatio;m=this.element.style;m.marginTop="0px";m.marginRight="0px";m.marginBottom="0px";m.marginLeft="0px";m.left="0px";m.bottom="0px";m.border="0px";m.background="#000";m.position="relative";a.setElementTouchActionNone(this.element);a.setElementOpacity(this.element,.8);this.viewer=l;this.innerTracker=new a.MouseTracker({element:this.element,dragHandler:a.delegate(this,f),scrollHandler:a.delegate(this,c),enterHandler:a.delegate(this,d),exitHandler:a.delegate(this,g),keyDownHandler:a.delegate(this,i),keyHandler:a.delegate(this,h)});if(j.width&&j.height){this.element.style.width=j.width+"px";this.element.style.height=j.height+"px";l.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})}else if("horizontal"==j.scroll){this.element.style.width=n.x*j.sizeRatio*l.tileSources.length+12*l.tileSources.length+"px";this.element.style.height=n.y*j.sizeRatio+"px";l.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})}else{this.element.style.height=n.y*j.sizeRatio*l.tileSources.length+12*l.tileSources.length+"px";this.element.style.width=n.x*j.sizeRatio+"px";l.addControl(this.element,{anchor:a.ControlAnchor.TOP_LEFT})}this.panelWidth=n.x*this.sizeRatio+8;this.panelHeight=n.y*this.sizeRatio+8;this.panels=[];for(o=0;o<l.tileSources.length;o++){k=a.makeNeutralElement("div");k.id=this.element.id+"-"+o;k.style.width=p.panelWidth+"px";k.style.height=p.panelHeight+"px";k.style.display="inline";k.style.float="left";k.style.cssFloat="left";k.style.styleFloat="left";k.style.padding="2px";a.setElementTouchActionNone(k);k.innerTracker=new a.MouseTracker({element:k,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(b){b.eventSource.dragging=a.now()},releaseHandler:function(c){var b=c.eventSource,f=b.element.id,d=Number(f.split("-")[2]),e=a.now();if(c.insideElementPressed&&c.insideElementReleased&&b.dragging&&e-b.dragging<b.clickTimeThreshold){b.dragging=null;l.goToPage(d)}}});this.element.appendChild(k);k.activePanel=false;this.panels.push(k)}b(this,this.scroll=="vertical"?n.y:n.x,0);this.setFocus(0)};a.extend(a.ReferenceStrip.prototype,a.EventSource.prototype,a.Viewer.prototype,{setFocus:function(f){var g=a.getElement(this.element.id+"-"+f),e=a.getElementSize(this.viewer.canvas),k=Number(this.element.style.width.replace("px","")),j=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),i=-Number(this.element.style.marginTop.replace("px","")),c;if(this.currentSelected!==g){if(this.currentSelected)this.currentSelected.style.background="#000";this.currentSelected=g;this.currentSelected.style.background="#999";if("horizontal"==this.scroll){c=Number(f)*(this.panelWidth+3);if(c>h+e.x-this.panelWidth){c=Math.min(c,k-e.x);this.element.style.marginLeft=-c+"px";b(this,e.x,-c)}else if(c<h){c=Math.max(0,c-e.x/2);this.element.style.marginLeft=-c+"px";b(this,e.x,-c)}}else{c=Number(f)*(this.panelHeight+3);if(c>i+e.y-this.panelHeight){c=Math.min(c,j-e.y);this.element.style.marginTop=-c+"px";b(this,e.y,-c)}else if(c<i){c=Math.max(0,c-e.y/2);this.element.style.marginTop=-c+"px";b(this,e.y,-c)}}this.currentPage=f;a.getElement(g.id+"-displayregion").focus();d.call(this,{eventSource:this.innerTracker})}},update:function(){if(e[this.id].animating){a.console.log("image reference strip update");return true}return false},destroy:function(){this.element&&this.element.parentNode.removeChild(this.element)}});function f(c){var d=Number(this.element.style.marginLeft.replace("px","")),f=Number(this.element.style.marginTop.replace("px","")),h=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),e=a.getElementSize(this.viewer.canvas);this.dragging=true;if(this.element)if("horizontal"==this.scroll){if(-c.delta.x>0){if(d>-(h-e.x)){this.element.style.marginLeft=d+c.delta.x*2+"px";b(this,e.x,d+c.delta.x*2)}}else if(-c.delta.x<0)if(d<0){this.element.style.marginLeft=d+c.delta.x*2+"px";b(this,e.x,d+c.delta.x*2)}}else if(-c.delta.y>0){if(f>-(g-e.y)){this.element.style.marginTop=f+c.delta.y*2+"px";b(this,e.y,f+c.delta.y*2)}}else if(-c.delta.y<0)if(f<0){this.element.style.marginTop=f+c.delta.y*2+"px";b(this,e.y,f+c.delta.y*2)}return false}function c(c){var d=Number(this.element.style.marginLeft.replace("px","")),f=Number(this.element.style.marginTop.replace("px","")),h=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),e=a.getElementSize(this.viewer.canvas);if(this.element)if("horizontal"==this.scroll){if(c.scroll>0){if(d>-(h-e.x)){this.element.style.marginLeft=d-c.scroll*60+"px";b(this,e.x,d-c.scroll*60)}}else if(c.scroll<0)if(d<0){this.element.style.marginLeft=d-c.scroll*60+"px";b(this,e.x,d-c.scroll*60)}}else if(c.scroll<0){if(f>e.y-g){this.element.style.marginTop=f+c.scroll*60+"px";b(this,e.y,f+c.scroll*60)}}else if(c.scroll>0)if(f<0){this.element.style.marginTop=f+c.scroll*60+"px";b(this,e.y,f+c.scroll*60)}return false}function b(c,j,k){var h,e,i,d,b,g,f;if("horizontal"==c.scroll)h=c.panelWidth;else h=c.panelHeight;e=Math.ceil(j/h)+5;i=Math.ceil((Math.abs(k)+j)/h)+1;e=i-e;e=e<0?0:e;for(g=e;g<i&&g<c.panels.length;g++){f=c.panels[g];if(!f.activePanel){d=new a.Viewer({id:f.id,tileSources:[c.viewer.tileSources[g]],element:f,navigatorSizeRatio:c.sizeRatio,showNavigator:false,mouseNavEnabled:false,showNavigationControl:false,showSequenceControl:false,immediateRender:true,blendTime:0,animationTime:0});d.displayRegion=a.makeNeutralElement("textarea");d.displayRegion.id=f.id+"-displayregion";d.displayRegion.className="displayregion";b=d.displayRegion.style;b.position="relative";b.top="0px";b.left="0px";b.fontSize="0px";b.overflow="hidden";b.float="left";b.cssFloat="left";b.styleFloat="left";b.zIndex=999999999;b.cursor="default";b.width=c.panelWidth-4+"px";b.height=c.panelHeight-4+"px";d.displayRegion.innerTracker=new a.MouseTracker({element:d.displayRegion,startDisabled:true});f.getElementsByTagName("div")[0].appendChild(d.displayRegion);f.activePanel=true}}}function d(b){var a=b.eventSource.element;if("horizontal"==this.scroll)a.style.marginBottom="0px";else a.style.marginLeft="0px";return false}function g(c){var b=c.eventSource.element;if("horizontal"==this.scroll)b.style.marginBottom="-"+a.getElementSize(b).y/2+"px";else b.style.marginLeft="-"+a.getElementSize(b).x/2+"px";return false}function i(a){if(!a.preventDefaultAction&&!a.ctrl&&!a.alt&&!a.meta)switch(a.keyCode){case 38:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 40:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 37:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 39:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;default:return true}else return true}function h(a){if(!a.preventDefaultAction&&!a.ctrl&&!a.alt&&!a.meta)switch(a.keyCode){case 61:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 45:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 48:case 119:case 87:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;case 115:case 83:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 97:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null});return false;case 100:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null});return false;default:return true}else return true}})(OpenSeadragon);(function(a){a.Spring=function(b){var c=arguments;if(typeof b!="object")b={initial:c.length&&typeof c[0]=="number"?c[0]:undefined,springStiffness:c.length>1?c[1].springStiffness:5,animationTime:c.length>1?c[1].animationTime:1.5};a.console.assert(typeof b.springStiffness==="number"&&b.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number");a.console.assert(typeof b.animationTime==="number"&&b.springStiffness!==0,"[OpenSeadragon.Spring] options.animationTime must be a non-zero number");if(b.exponential){this._exponential=true;delete b.exponential}a.extend(true,this,b);this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:a.now()};a.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs");this.start={value:this.current.value,time:this.current.time};this.target={value:this.current.value,time:this.current.time};if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}};a.Spring.prototype={resetTo:function(b){a.console.assert(!this._exponential||b!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs");this.start.value=this.target.value=this.current.value=b;this.start.time=this.target.time=this.current.time=a.now();if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}},springTo:function(b){a.console.assert(!this._exponential||b!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs");this.start.value=this.current.value;this.start.time=this.current.time;this.target.value=b;this.target.time=this.start.time+1e3*this.animationTime;if(this._exponential){this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value)}},shiftBy:function(b){this.start.value+=b;this.target.value+=b;if(this._exponential){a.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs");this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value)}},setExponential:function(b){this._exponential=b;if(this._exponential){a.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs");this.start._logValue=Math.log(this.start.value);this.target._logValue=Math.log(this.target.value);this.current._logValue=Math.log(this.current.value)}},update:function(){this.current.time=a.now();var d,c;if(this._exponential){d=this.start._logValue;c=this.target._logValue}else{d=this.start.value;c=this.target.value}var e=this.current.time>=this.target.time?c:d+(c-d)*b(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));if(this._exponential)this.current.value=Math.exp(e);else this.current.value=e}};function b(a,b){return (1-Math.exp(a*-b))/(1-Math.exp(-a))}})(OpenSeadragon);(function(a){var b={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};a.extend(a,{getString:function(h){for(var f=h.split("."),c=null,g=arguments,e=b,d=0;d<f.length-1;d++)e=e[f[d]]||{};c=e[f[d]];if(typeof c!="string"){a.console.debug("Untranslated source string:",h);c=""}return c.replace(/\{\d+\}/g,function(b){var a=parseInt(b.match(/\d+/),10)+1;return a<g.length?g[a]:""})},setString:function(f,e){for(var d=f.split("."),c=b,a=0;a<d.length-1;a++){if(!c[d[a]])c[d[a]]={};c=c[d[a]]}c[d[a]]=e}})})(OpenSeadragon);(function(a){a.Tile=function(d,f,g,b,c,e,a){this.level=d;this.x=f;this.y=g;this.bounds=b;this.exists=c;this.url=e;this.context2D=a;this.loaded=false;this.loading=false;this.element=null;this.imgElement=null;this.image=null;this.style=null;this.position=null;this.size=null;this.blendStart=null;this.opacity=null;this.distance=null;this.visibility=null;this.beingDrawn=false;this.lastTouchTime=0};a.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(b){if(!this.cacheImageRecord){a.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){this.element=a.makeNeutralElement("div");this.imgElement=this.cacheImageRecord.getImage().cloneNode();this.imgElement.style.msInterpolationMode="nearest-neighbor";this.imgElement.style.width="100%";this.imgElement.style.height="100%";this.style=this.element.style;this.style.position="absolute"}this.element.parentNode!=b&&b.appendChild(this.element);this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement);this.style.top=this.position.y+"px";this.style.left=this.position.x+"px";this.style.height=this.size.y+"px";this.style.width=this.size.x+"px";a.setElementOpacity(this.element,this.opacity)},drawCanvas:function(b,f){var d=this.position,e=this.size,c;if(!this.context2D&&!this.cacheImageRecord){a.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}c=this.context2D||this.cacheImageRecord.getRenderedContext();if(!this.loaded||!c){a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}b.save();b.globalAlpha=this.opacity;b.globalAlpha===1&&(this.context2D||this.url.match(".png"))&&b.clearRect(d.x*a.pixelDensityRatio+1,d.y*a.pixelDensityRatio+1,e.x*a.pixelDensityRatio-2,e.y*a.pixelDensityRatio-2);f({context:b,tile:this,rendered:c});b.drawImage(c.canvas,0,0,c.canvas.width,c.canvas.height,d.x*a.pixelDensityRatio,d.y*a.pixelDensityRatio,e.x*a.pixelDensityRatio,e.y*a.pixelDensityRatio);b.restore()},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement);this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;this.imgElement=null;this.loaded=false;this.loading=false}}})(OpenSeadragon);(function(a){var c=function(b){a.console.assert(b,"[TileCache.cacheTile] options is required");a.console.assert(b.tile,"[TileCache.cacheTile] options.tile is required");a.console.assert(b.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");this.tile=b.tile;this.tiledImage=b.tiledImage},b=function(b){a.console.assert(b,"[ImageRecord] options is required");a.console.assert(b.image,"[ImageRecord] options.image is required");this._image=b.image;this._tiles=[]};b.prototype={destroy:function(){this._image=null;this._renderedContext=null;this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var a=document.createElement("canvas");a.width=this._image.width;a.height=this._image.height;this._renderedContext=a.getContext("2d");this._renderedContext.drawImage(this._image,0,0);this._image=null}return this._renderedContext},setRenderedContext:function(b){a.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext.");this._renderedContext=b},addTile:function(b){a.console.assert(b,"[ImageRecord.addTile] tile is required");this._tiles.push(b)},removeTile:function(c){for(var b=0;b<this._tiles.length;b++)if(this._tiles[b]===c){this._tiles.splice(b,1);return}a.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",c)},getTileCount:function(){return this._tiles.length}};a.TileCache=function(b){b=b||{};this._maxImageCacheCount=b.maxImageCacheCount||a.DEFAULT_SETTINGS.maxImageCacheCount;this._tilesLoaded=[];this._imagesLoaded=[];this._imagesLoadedCount=0};a.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(d){a.console.assert(d,"[TileCache.cacheTile] options is required");a.console.assert(d.tile,"[TileCache.cacheTile] options.tile is required");a.console.assert(d.tile.url,"[TileCache.cacheTile] options.tile.url is required");a.console.assert(d.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var q=d.cutoff||0,n=this._tilesLoaded.length,j=this._imagesLoaded[d.tile.url];if(!j){a.console.assert(d.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord");j=this._imagesLoaded[d.tile.url]=new b({image:d.image});this._imagesLoadedCount++}j.addTile(d.tile);d.tile.cacheImageRecord=j;if(this._imagesLoadedCount>this._maxImageCacheCount){for(var f=null,i=-1,k=null,e,l,o,m,p,h,g=this._tilesLoaded.length-1;g>=0;g--){h=this._tilesLoaded[g];e=h.tile;if(e.level<=q||e.beingDrawn)continue;else if(!f){f=e;i=g;k=h;continue}m=e.lastTouchTime;l=f.lastTouchTime;p=e.level;o=f.level;if(m<l||m==l&&p>o){f=e;i=g;k=h}}if(f&&i>=0){this._unloadTile(k);n=i}}this._tilesLoaded[n]=new c({tile:d.tile,tiledImage:d.tiledImage})},clearTilesFor:function(d){a.console.assert(d,"[TileCache.clearTilesFor] tiledImage is required");for(var c,b=0;b<this._tilesLoaded.length;++b){c=this._tilesLoaded[b];if(c.tiledImage===d){this._unloadTile(c);this._tilesLoaded.splice(b,1);b--}}},getImageRecord:function(b){a.console.assert(b,"[TileCache.getImageRecord] url is required");return this._imagesLoaded[b]},_unloadTile:function(d){a.console.assert(d,"[TileCache._unloadTile] tileRecord is required");var b=d.tile,e=d.tiledImage;b.unload();b.cacheImageRecord=null;var c=this._imagesLoaded[b.url];c.removeTile(b);if(!c.getTileCount()){c.destroy();delete this._imagesLoaded[b.url];this._imagesLoadedCount--}e.viewer.raiseEvent("tile-unloaded",{tile:b,tiledImage:e})}}})(OpenSeadragon);(function(a){a.TiledImage=function(b){var d=this;a.console.assert(b.tileCache,"[TiledImage] options.tileCache is required");a.console.assert(b.drawer,"[TiledImage] options.drawer is required");a.console.assert(b.viewer,"[TiledImage] options.viewer is required");a.console.assert(b.imageLoader,"[TiledImage] options.imageLoader is required");a.console.assert(b.source,"[TiledImage] options.source is required");a.console.assert(!b.clip||b.clip instanceof a.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present");a.EventSource.call(this);this._tileCache=b.tileCache;delete b.tileCache;this._drawer=b.drawer;delete b.drawer;this._imageLoader=b.imageLoader;delete b.imageLoader;if(b.clip instanceof a.Rect)this._clip=b.clip.clone();delete b.clip;var e=b.x||0;delete b.x;var f=b.y||0;delete b.y;this.normHeight=b.source.dimensions.y/b.source.dimensions.x;this.contentAspectX=b.source.dimensions.x/b.source.dimensions.y;var c=1;if(b.width){c=b.width;delete b.width;if(b.height){a.console.error("specifying both width and height to a tiledImage is not supported");delete b.height}}else if(b.height){c=b.height/this.normHeight;delete b.height}a.extend(true,this,{viewer:null,tilesMatrix:{},coverage:{},lastDrawn:[],lastResetTime:0,_midDraw:false,_needsDraw:true,_hasOpaqueTile:false,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,immediateRender:a.DEFAULT_SETTINGS.immediateRender,blendTime:a.DEFAULT_SETTINGS.blendTime,alwaysBlend:a.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:a.DEFAULT_SETTINGS.minPixelRatio,debugMode:a.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:a.DEFAULT_SETTINGS.crossOriginPolicy,placeholderFillStyle:a.DEFAULT_SETTINGS.placeholderFillStyle,opacity:a.DEFAULT_SETTINGS.opacity},b);this._xSpring=new a.Spring({initial:e,springStiffness:this.springStiffness,animationTime:this.animationTime});this._ySpring=new a.Spring({initial:f,springStiffness:this.springStiffness,animationTime:this.animationTime});this._scaleSpring=new a.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime});this._updateForScale();this._drawingHandler=function(b){d.viewer.raiseEvent("tile-drawing",a.extend({tiledImage:d},b))}};a.extend(a.TiledImage.prototype,a.EventSource.prototype,{needsDraw:function(){return this._needsDraw},reset:function(){this._tileCache.clearTilesFor(this);this.lastResetTime=a.now();this._needsDraw=true},update:function(){var b=this._xSpring.current.value,c=this._ySpring.current.value,a=this._scaleSpring.current.value;this._xSpring.update();this._ySpring.update();this._scaleSpring.update();if(this._xSpring.current.value!==b||this._ySpring.current.value!==c||this._scaleSpring.current.value!==a){this._updateForScale();this._needsDraw=true;return true}return false},draw:function(){this._midDraw=true;f(this);this._midDraw=false},destroy:function(){this.reset()},getBounds:function(b){if(b)return new a.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent);return new a.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){a.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead");return this.getBounds()},getContentSize:function(){return new a.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(d,e,c){var b=c?this._scaleSpring.current.value:this._scaleSpring.target.value;return new a.Point(d*(this.source.dimensions.x/b),e*(this.source.dimensions.y*this.contentAspectX/b))},viewportToImageCoordinates:function(b,c,d){if(b instanceof a.Point){d=c;c=b.y;b=b.x}if(d)return this._viewportToImageDelta(b-this._xSpring.current.value,c-this._ySpring.current.value);return this._viewportToImageDelta(b-this._xSpring.target.value,c-this._ySpring.target.value)},_imageToViewportDelta:function(d,e,c){var b=c?this._scaleSpring.current.value:this._scaleSpring.target.value;return new a.Point(d/this.source.dimensions.x*b,e/this.source.dimensions.y/this.contentAspectX*b)},imageToViewportCoordinates:function(b,d,e){if(b instanceof a.Point){e=d;d=b.y;b=b.x}var c=this._imageToViewportDelta(b,d);if(e){c.x+=this._xSpring.current.value;c.y+=this._ySpring.current.value}else{c.x+=this._xSpring.target.value;c.y+=this._ySpring.target.value}return c},imageToViewportRectangle:function(b,d,f,e,c){if(b instanceof a.Rect){c=d;f=b.width;e=b.height;d=b.y;b=b.x}var g=this.imageToViewportCoordinates(b,d,c),h=this._imageToViewportDelta(f,e,c);return new a.Rect(g.x,g.y,h.x,h.y)},viewportToImageRectangle:function(b,d,f,e,c){if(b instanceof a.Rect){c=d;f=b.width;e=b.height;d=b.y;b=b.x}var g=this.viewportToImageCoordinates(b,d,c),h=this._viewportToImageDelta(f,e,c);return new a.Rect(g.x,g.y,h.x,h.y)},viewerElementToImageCoordinates:function(a){var b=this.viewport.pointFromPixel(a,true);return this.viewportToImageCoordinates(b)},imageToViewerElementCoordinates:function(a){var b=this.imageToViewportCoordinates(a);return this.viewport.pixelFromPoint(b,true)},windowToImageCoordinates:function(b){var a=b.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(a)},imageToWindowCoordinates:function(b){var a=this.imageToViewerElementCoordinates(b);return a.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(a){var b=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return b*a},imageToViewportZoom:function(a){var b=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return a/b},setPosition:function(a,c){var b=this._xSpring.target.value===a.x&&this._ySpring.target.value===a.y;if(c){if(b&&this._xSpring.current.value===a.x&&this._ySpring.current.value===a.y)return;this._xSpring.resetTo(a.x);this._ySpring.resetTo(a.y);this._needsDraw=true}else{if(b)return;this._xSpring.springTo(a.x);this._ySpring.springTo(a.y);this._needsDraw=true}!b&&this._raiseBoundsChange()},setWidth:function(b,a){this._setScale(b,a)},setHeight:function(b,a){this._setScale(b/this.normHeight,a)},getClip:function(){if(this._clip)return this._clip.clone();return null},setClip:function(b){a.console.assert(!b||b instanceof a.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null");if(b instanceof a.Rect)this._clip=b.clone();else this._clip=null;this._needsDraw=true},getOpacity:function(){return this.opacity},setOpacity:function(a){this.opacity=a;this._needsDraw=true},_setScale:function(a,c){var b=this._scaleSpring.target.value===a;if(c){if(b&&this._scaleSpring.current.value===a)return;this._scaleSpring.resetTo(a);this._updateForScale();this._needsDraw=true}else{if(b)return;this._scaleSpring.springTo(a);this._updateForScale();this._needsDraw=true}!b&&this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value;this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value;this._worldWidthCurrent=this._scaleSpring.current.value;this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")}});function f(c){c._needsDraw=false;var y,e,i=null,m=false,w=a.now(),d=c.viewport.getBoundsWithMargins(true),z=c.viewport.deltaPixelsFromPoints(c.source.getPixelRatio(0),true).x*c._scaleSpring.current.value,k=Math.max(c.source.minLevel,Math.floor(Math.log(c.minZoomImageRatio)/Math.log(2))),u=Math.min(Math.abs(c.source.maxLevel),Math.abs(Math.floor(Math.log(z/c.minPixelRatio)/Math.log(2)))),h=c.viewport.degrees,o,s,x,q,v,t;d.x-=c._xSpring.current.value;d.y-=c._ySpring.current.value;while(c.lastDrawn.length>0){y=c.lastDrawn.pop();y.beingDrawn=false}if(h===90||h===270)d=d.rotate(h);else if(h!==0&&h!==180){var l=d.rotate(90);d.x-=l.width/2;d.y-=l.height/2;d.width+=l.width;d.height+=l.height}var g=d.getTopLeft(),f=d.getBottomRight();if(!c.wrapHorizontal&&(f.x<0||g.x>c._worldWidthCurrent))return;if(!c.wrapVertical&&(f.y<0||g.y>c._worldHeightCurrent))return;if(!c.wrapHorizontal){g.x=Math.max(g.x,0);f.x=Math.min(f.x,c._worldWidthCurrent)}if(!c.wrapVertical){g.y=Math.max(g.y,0);f.y=Math.min(f.y,c._worldHeightCurrent)}k=Math.min(k,u);var r;for(e=u;e>=k;e--){r=false;o=c.viewport.deltaPixelsFromPoints(c.source.getPixelRatio(e),true).x*c._scaleSpring.current.value;if(!m&&o>=c.minPixelRatio||e==k){r=true;m=true}else if(!m)continue;s=c.viewport.deltaPixelsFromPoints(c.source.getPixelRatio(e),false).x*c._scaleSpring.current.value;x=c.viewport.deltaPixelsFromPoints(c.source.getPixelRatio(Math.max(c.source.getClosestLevel(c.viewport.containerSize)-1,0)),false).x*c._scaleSpring.current.value;q=c.immediateRender?1:x;v=Math.min(1,(o-.5)/.5);t=q/Math.abs(q-s);i=j(c,m,r,e,v,t,g,f,w,i);if(b(c.coverage,e))break}n(c,c.lastDrawn);i&&!i.context2D&&p(c,i,w)}function j(a,p,r,c,k,j,o,n,m,e){var f,h,i,b,d,q=a.viewport.pixelFromPoint(a.viewport.getCenter());a.viewer&&a.viewer.raiseEvent("update-level",{tiledImage:a,havedrawn:p,level:c,opacity:k,visibility:j,topleft:o,bottomright:n,currenttime:m,best:e});i=a.source.getTileAtPoint(c,o.divide(a._scaleSpring.current.value));b=a.source.getTileAtPoint(c,n.divide(a._scaleSpring.current.value));d=a.source.getNumTiles(c);g(a.coverage,c);if(!a.wrapHorizontal)b.x=Math.min(b.x,d.x-1);if(!a.wrapVertical)b.y=Math.min(b.y,d.y-1);for(f=i.x;f<=b.x;f++)for(h=i.y;h<=b.y;h++)e=l(a,r,p,f,h,c,k,j,q,d,m,e);return e}function l(a,u,v,g,j,e,t,p,r,s,l,f){var b=q(g,j,e,a.source,a.tilesMatrix,l,s,a._worldWidthCurrent,a._worldHeightCurrent),k=u;a.viewer&&a.viewer.raiseEvent("update-tile",{tiledImage:a,tile:b});d(a.coverage,e,g,j,false);if(!b.exists)return f;if(v&&!k)if(o(a.coverage,e,g,j))d(a.coverage,e,g,j,true);else k=true;if(!k)return f;i(b,a.source.tileOverlap,a.viewport,r,p,a);if(!b.loaded)if(b.context2D)c(a,b);else{var n=a._tileCache.getImageRecord(b.url);if(n){var x=n.getImage();c(a,b,x)}}if(b.loaded){var w=m(a,b,g,j,e,t,l);if(w)a._needsDraw=true}else if(!b.loading)f=h(f,b);return f}function q(d,h,b,i,e,q,c,p,o){var f,g,j,m,n,l,k;if(!e[b])e[b]={};if(!e[b][d])e[b][d]={};if(!e[b][d][h]){f=(c.x+d%c.x)%c.x;g=(c.y+h%c.y)%c.y;j=i.getTileBounds(b,f,g);m=i.tileExists(b,f,g);n=i.getTileUrl(b,f,g);l=i.getContext2D?i.getContext2D(b,f,g):undefined;j.x+=(d-f)/c.x;j.y+=o/p*((h-g)/c.y);e[b][d][h]=new a.Tile(b,d,h,j,m,n,l)}k=e[b][d][h];k.lastTouchTime=q;return k}function p(b,a,c){a.loading=true;b._imageLoader.addJob({src:a.url,crossOriginPolicy:b.crossOriginPolicy,callback:function(e,d){k(b,a,c,e,d)},abort:function(){a.loading=false}})}function k(d,b,h,g,e){if(!g){a.console.log("Tile %s failed to load: %s - error: %s",b,b.url,e);d.viewer.raiseEvent("tile-load-failed",{tile:b,tiledImage:d,time:h,message:e});if(!d.debugMode){b.loading=false;b.exists=false;return}}else if(h<d.lastResetTime){a.console.log("Ignoring tile %s loaded before reset: %s",b,b.url);b.loading=false;return}var f=function(){var a=Math.ceil(Math.log(d.source.getTileWidth(b.level))/Math.log(2));c(d,b,g,a)};if(!d._midDraw)f();else window.setTimeout(f,1)}function c(a,b,e,g){var c=0;function d(){c++;return f}function f(){c--;if(c===0){b.loading=false;b.loaded=true;!b.context2D&&a._tileCache.cacheTile({image:e,tile:b,cutoff:g,tiledImage:a});a._needsDraw=true}}a.viewer.raiseEvent("tile-loaded",{tile:b,tiledImage:a,image:e,getCompletionCallback:d});d()()}function i(d,n,f,i,h,b){var c=d.bounds.getTopLeft();c.x*=b._scaleSpring.current.value;c.y*=b._scaleSpring.current.value;c.x+=b._xSpring.current.value;c.y+=b._ySpring.current.value;var e=d.bounds.getSize();e.x*=b._scaleSpring.current.value;e.y*=b._scaleSpring.current.value;var l=f.pixelFromPoint(c,true),m=f.pixelFromPoint(c,false),g=f.deltaPixelsFromPoints(e,true),o=f.deltaPixelsFromPoints(e,false),k=m.plus(o.divide(2)),j=i.distanceTo(k);if(!n)g=g.plus(new a.Point(1,1));d.position=l;d.size=g;d.distance=j;d.visibility=h}function m(a,b,j,k,i,h,g){var e=1e3*a.blendTime,f,c;if(!b.blendStart)b.blendStart=g;f=g-b.blendStart;c=e?Math.min(1,f/e):1;if(a.alwaysBlend)c*=h;b.opacity=c;a.lastDrawn.push(b);if(c==1){d(a.coverage,i,j,k,true);a._hasOpaqueTile=true}else if(f<e)return true;return false}function b(a,b,e,h){var d,c,f,g;if(!a[b])return false;if(e===undefined||h===undefined){d=a[b];for(f in d)if(d.hasOwnProperty(f)){c=d[f];for(g in c)if(c.hasOwnProperty(g)&&!c[g])return false}return true}return a[b][e]===undefined||a[b][e][h]===undefined||a[b][e][h]===true}function o(a,c,d,e){if(d===undefined||e===undefined)return b(a,c+1);else return b(a,c+1,2*d,2*e)&&b(a,c+1,2*d,2*e+1)&&b(a,c+1,2*d+1,2*e)&&b(a,c+1,2*d+1,2*e+1)}function d(c,b,d,f,e){if(!c[b]){a.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",b);return}if(!c[b][d])c[b][d]={};c[b][d][f]=e}function g(a,b){a[b]={}}function h(b,a){if(!b)return a;if(a.visibility>b.visibility)return a;else if(a.visibility==b.visibility)if(a.distance<b.distance)return a;return b}function n(a,c){var f,d;if(a.opacity<=0){e(a,c);return}var b=a.opacity<1;b&&a._drawer._clear(true);var h=false;if(a._clip){a._drawer.saveContext(b);var k=a.imageToViewportRectangle(a._clip,true),j=a._drawer.viewportToDrawerRectangle(k);a._drawer.setClip(j,b);h=true}if(a.placeholderFillStyle&&a._hasOpaqueTile===false){var i=a._drawer.viewportToDrawerRectangle(a.getBounds(true)),g=null;if(typeof a.placeholderFillStyle==="function")g=a.placeholderFillStyle(a,a._drawer.context);else g=a.placeholderFillStyle;a._drawer.drawRectangle(i,g,b)}for(f=c.length-1;f>=0;f--){d=c[f];a._drawer.drawTile(d,a._drawingHandler,b);d.beingDrawn=true;a.viewer&&a.viewer.raiseEvent("tile-drawn",{tiledImage:a,tile:d})}h&&a._drawer.restoreContext(b);b&&a._drawer.blendSketch(a.opacity);e(a,c)}function e(d,c){if(d.debugMode)for(var b=c.length-1;b>=0;b--){var f=c[b];try{d._drawer.drawDebugInfo(f,c.length,b)}catch(e){a.console.error(e)}}}})(OpenSeadragon);(function(a){a.TileSourceCollection=function(){a.console.error("TileSourceCollection is deprecated; use World instead")}})(OpenSeadragon);(function(a){a.TmsTileSource=function(f){var b;if(a.isPlainObject(f))b=f;else b={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var d=Math.ceil(b.width/256)*256,c=Math.ceil(b.height/256)*256,e;if(d>c)e=d/256;else e=c/256;b.maxLevel=Math.ceil(Math.log(e)/Math.log(2))-1;b.tileSize=256;b.width=d;b.height=c;a.TileSource.apply(this,[b])};a.extend(a.TmsTileSource.prototype,a.TileSource.prototype,{supports:function(a){return a.type&&"tiledmapservice"==a.type},configure:function(a){return a},getTileUrl:function(a,c,d){var b=this.getNumTiles(a).y-1;return this.tilesUrl+a+"/"+c+"/"+(b-d)+".png"}})})(OpenSeadragon);(function(a){a.Viewport=function(b){var c=arguments;if(c.length&&c[0]instanceof a.Point)b={containerSize:c[0],contentSize:c[1],config:c[2]};if(b.config){a.extend(true,b,b.config);delete b.config}this._margins=a.extend({left:0,top:0,right:0,bottom:0},b.margins||{});delete b.margins;a.extend(true,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:a.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:a.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:a.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:a.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:a.DEFAULT_SETTINGS.maxZoomLevel,degrees:a.DEFAULT_SETTINGS.degrees,homeFillsViewer:a.DEFAULT_SETTINGS.homeFillsViewer},b);this._updateContainerInnerSize();this.centerSpringX=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime});this.centerSpringY=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime});this.zoomSpring=new a.Spring({exponential:true,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime});this._oldCenterX=this.centerSpringX.current.value;this._oldCenterY=this.centerSpringY.current.value;this._oldZoom=this.zoomSpring.current.value;if(this.contentSize)this.resetContentSize(this.contentSize);else this.setHomeBounds(new a.Rect(0,0,1,1),1);this.goHome(true);this.update()};a.Viewport.prototype={resetContentSize:function(b){a.console.assert(b,"[Viewport.resetContentSize] contentSize is required");a.console.assert(b instanceof a.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point");a.console.assert(b.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0");a.console.assert(b.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0");this.setHomeBounds(new a.Rect(0,0,1,b.y/b.x),b.x);return this},setHomeBounds:function(b,c){a.console.assert(b,"[Viewport.setHomeBounds] bounds is required");a.console.assert(b instanceof a.Rect,"[Viewport.setHomeBounds] bounds must be an OpenSeadragon.Rect");a.console.assert(b.width>0,"[Viewport.setHomeBounds] bounds.width must be greater than 0");a.console.assert(b.height>0,"[Viewport.setHomeBounds] bounds.height must be greater than 0");this.homeBounds=b.clone();this.contentSize=this.homeBounds.getSize().times(c);this.contentAspectX=this.contentSize.x/this.contentSize.y;this.contentAspectY=this.contentSize.y/this.contentSize.x;this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this.contentSize.clone(),contentFactor:c,homeBounds:this.homeBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;else{var a=this.contentAspectX/this.getAspectRatio(),b;if(this.homeFillsViewer)b=a>=1?a:1;else b=a>=1?1:a;return b/this.homeBounds.width}},getHomeBounds:function(){var c=this.homeBounds.getCenter(),b=1/this.getHomeZoom(),d=b/this.getAspectRatio();return new a.Rect(c.x-b/2,c.y-d/2,b,d)},goHome:function(a){this.viewer&&this.viewer.raiseEvent("home",{immediately:a});return this.fitBounds(this.getHomeBounds(),a)},getMinZoom:function(){var a=this.getHomeZoom(),b=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*a;return b},getMaxZoom:function(){var a=this.maxZoomLevel;if(!a){a=this.contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x;a/=this.homeBounds.width}return Math.max(a,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new a.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return a.extend({},this._margins)},setMargins:function(b){a.console.assert(a.type(b)==="object","[Viewport.setMargins] margins must be an object");this._margins=a.extend({left:0,top:0,right:0,bottom:0},b);this._updateContainerInnerSize();this.viewer.forceRedraw()},getBounds:function(c){var d=this.getCenter(c),b=1/this.getZoom(c),e=b/this.getAspectRatio();return new a.Rect(d.x-b/2,d.y-e/2,b,e)},getBoundsWithMargins:function(c){var a=this.getBounds(c),b=this._containerInnerSize.x*this.getZoom(c);a.x-=this._margins.left/b;a.y-=this._margins.top/b;a.width+=(this._margins.left+this._margins.right)/b;a.height+=(this._margins.top+this._margins.bottom)/b;return a},getCenter:function(l){var c=new a.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),h=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),j,e,b,d,k,i,f,g;if(l)return c;else if(!this.zoomPoint)return h;j=this.pixelFromPoint(this.zoomPoint,true);e=this.getZoom();b=1/e;d=b/this.getAspectRatio();k=new a.Rect(c.x-b/2,c.y-d/2,b,d);i=this._pixelFromPoint(this.zoomPoint,k);f=i.minus(j);g=f.divide(this._containerInnerSize.x*e);return h.plus(g)},getZoom:function(a){if(a)return this.zoomSpring.current.value;else return this.zoomSpring.target.value},_applyBoundaryConstraints:function(e,p){var c=0,d=0,b=new a.Rect(e.x,e.y,e.width,e.height),f=this.visibilityRatio*b.width,g=this.visibilityRatio*b.height;if(!this.wrapHorizontal){var j=b.x+(b.width-f);if(this.homeBounds.x>j)c=this.homeBounds.x-j;var m=this.homeBounds.x+this.homeBounds.width,i=b.x+f;if(m<i){var n=m-i;if(c)c=(c+n)/2;else c=n}}if(!this.wrapVertical){var k=b.y+(b.height-g);if(this.homeBounds.y>k)d=this.homeBounds.y-k;var l=this.homeBounds.y+this.homeBounds.height,h=b.y+g;if(l<h){var o=l-h;if(d)d=(d+o)/2;else d=o}}if(c||d){b.x+=c;b.y+=d}this.viewer&&this.viewer.raiseEvent("constrain",{immediately:p});return b},applyConstraints:function(b){var e=this.getZoom(),d=Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom()),c,a;e!=d&&this.zoomTo(d,this.zoomPoint,b);c=this.getBounds();a=this._applyBoundaryConstraints(c,b);(c.x!==a.x||c.y!==a.y||b)&&this.fitBounds(a,b);return this},ensureVisible:function(a){return this.applyConstraints(a)},_fitBounds:function(d,h){h=h||{};var g=h.immediately||false,m=h.constraints||false,j=this.getAspectRatio(),e=d.getCenter(),b=new a.Rect(d.x,d.y,d.width,d.height),f,n,c,l,k,i;if(b.getAspectRatio()>=j){b.height=d.width/j;b.y=e.y-b.height/2}else{b.width=d.height*j;b.x=e.x-b.width/2}if(m)k=b.getAspectRatio();this.panTo(this.getCenter(true),true);this.zoomTo(this.getZoom(true),null,true);f=this.getBounds();n=this.getZoom();c=1/b.width;if(m){i=Math.max(Math.min(c,this.getMaxZoom()),this.getMinZoom());if(c!==i){c=i;b.width=1/c;b.x=e.x-b.width/2;b.height=b.width/k;b.y=e.y-b.height/2}b=this._applyBoundaryConstraints(b,g);e=b.getCenter()}if(g){this.panTo(e,true);return this.zoomTo(c,null,true)}if(Math.abs(c-n)<1e-8||Math.abs(b.width-f.width)<1e-8)return this.panTo(e,g);l=f.getTopLeft().times(this._containerInnerSize.x/f.width).minus(b.getTopLeft().times(this._containerInnerSize.x/b.width)).divide(this._containerInnerSize.x/f.width-this._containerInnerSize.x/b.width);return this.zoomTo(c,l,g)},fitBounds:function(b,a){return this._fitBounds(b,{immediately:a,constraints:false})},fitBoundsWithConstraints:function(b,a){return this._fitBounds(b,{immediately:a,constraints:true})},fitVertically:function(b){var c=new a.Rect(this.homeBounds.x+this.homeBounds.width/2,this.homeBounds.y,0,this.homeBounds.height);return this.fitBounds(c,b)},fitHorizontally:function(b){var c=new a.Rect(this.homeBounds.x,this.homeBounds.y+this.homeBounds.height/2,this.homeBounds.width,0);return this.fitBounds(c,b)},panBy:function(b,c){var d=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);b=b.rotate(-this.degrees,new a.Point(0,0));return this.panTo(d.plus(b),c)},panTo:function(a,b){if(b){this.centerSpringX.resetTo(a.x);this.centerSpringY.resetTo(a.y)}else{this.centerSpringX.springTo(a.x);this.centerSpringY.springTo(a.y)}this.viewer&&this.viewer.raiseEvent("pan",{center:a,immediately:b});return this},zoomBy:function(d,b,c){if(b instanceof a.Point&&!isNaN(b.x)&&!isNaN(b.y))b=b.rotate(-this.degrees,new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value));return this.zoomTo(this.zoomSpring.target.value*d,b,c)},zoomTo:function(c,b,d){this.zoomPoint=b instanceof a.Point&&!isNaN(b.x)&&!isNaN(b.y)?b:null;if(d)this.zoomSpring.resetTo(c);else this.zoomSpring.springTo(c);this.viewer&&this.viewer.raiseEvent("zoom",{zoom:c,refPoint:b,immediately:d});return this},setRotation:function(a){if(!(this.viewer&&this.viewer.drawer.canRotate()))return this;a=(a+360)%360;this.degrees=a;this.viewer.forceRedraw();this.viewer!==null&&this.viewer.raiseEvent("rotate",{degrees:a});return this},getRotation:function(){return this.degrees},resize:function(a,e){var d=this.getBounds(),b=d,c;this.containerSize.x=a.x;this.containerSize.y=a.y;this._updateContainerInnerSize();if(e){c=a.x/this.containerSize.x;b.width=d.width*c;b.height=b.width/this.getAspectRatio()}this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:a,maintain:e});return this.fitBounds(b,true)},_updateContainerInnerSize:function(){this._containerInnerSize=new a.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var d,c,b,a;if(this.zoomPoint)d=this.pixelFromPoint(this.zoomPoint,true);this.zoomSpring.update();if(this.zoomPoint&&this.zoomSpring.current.value!=this._oldZoom){c=this.pixelFromPoint(this.zoomPoint,true);b=c.minus(d);a=this.deltaPointsFromPixels(b,true);this.centerSpringX.shiftBy(a.x);this.centerSpringY.shiftBy(a.y)}else this.zoomPoint=null;this.centerSpringX.update();this.centerSpringY.update();var e=this.centerSpringX.current.value!=this._oldCenterX||this.centerSpringY.current.value!=this._oldCenterY||this.zoomSpring.current.value!=this._oldZoom;this._oldCenterX=this.centerSpringX.current.value;this._oldCenterY=this.centerSpringY.current.value;this._oldZoom=this.zoomSpring.current.value;return e},deltaPixelsFromPoints:function(a,b){return a.times(this._containerInnerSize.x*this.getZoom(b))},deltaPointsFromPixels:function(a,b){return a.divide(this._containerInnerSize.x*this.getZoom(b))},pixelFromPoint:function(b,a){return this._pixelFromPoint(b,this.getBounds(a))},_pixelFromPoint:function(c,b){return c.minus(b.getTopLeft()).times(this._containerInnerSize.x/b.width).plus(new a.Point(this._margins.left,this._margins.top))},pointFromPixel:function(d,c){var b=this.getBounds(c);return d.minus(new a.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/b.width).plus(b.getTopLeft())},_viewportToImageDelta:function(c,d){var b=this.homeBounds.width;return new a.Point(c*(this.contentSize.x/b),d*(this.contentSize.y*this.contentAspectX/b))},viewportToImageCoordinates:function(b,c){if(arguments.length==1)return this.viewportToImageCoordinates(b.x,b.y);this.viewer&&this.viewer.world.getItemCount()>1&&a.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");return this._viewportToImageDelta(b-this.homeBounds.x,c-this.homeBounds.y)},_imageToViewportDelta:function(c,d){var b=this.homeBounds.width;return new a.Point(c/this.contentSize.x*b,d/this.contentSize.y/this.contentAspectX*b)},imageToViewportCoordinates:function(b,d){if(arguments.length==1)return this.imageToViewportCoordinates(b.x,b.y);this.viewer&&this.viewer.world.getItemCount()>1&&a.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");var c=this._imageToViewportDelta(b,d);c.x+=this.homeBounds.x;c.y+=this.homeBounds.y;return c},imageToViewportRectangle:function(e,h,g,f){var c,d,b;if(arguments.length==1){b=e;return this.imageToViewportRectangle(b.x,b.y,b.width,b.height)}c=this.imageToViewportCoordinates(e,h);d=this._imageToViewportDelta(g,f);return new a.Rect(c.x,c.y,d.x,d.y)},viewportToImageRectangle:function(e,h,g,f){var c,d,b;if(arguments.length==1){b=e;return this.viewportToImageRectangle(b.x,b.y,b.width,b.height)}c=this.viewportToImageCoordinates(e,h);d=this._viewportToImageDelta(g,f);return new a.Rect(c.x,c.y,d.x,d.y)},viewerElementToImageCoordinates:function(a){var b=this.pointFromPixel(a,true);return this.viewportToImageCoordinates(b)},imageToViewerElementCoordinates:function(a){var b=this.imageToViewportCoordinates(a);return this.pixelFromPoint(b,true)},windowToImageCoordinates:function(b){var a=b.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(a)},imageToWindowCoordinates:function(b){var a=this.imageToViewerElementCoordinates(b);return a.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(a){return this.pointFromPixel(a,true)},viewportToViewerElementCoordinates:function(a){return this.pixelFromPoint(a,true)},windowToViewportCoordinates:function(b){var a=b.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(a)},viewportToWindowCoordinates:function(b){var a=this.viewportToViewerElementCoordinates(b);return a.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(d){this.viewer&&this.viewer.world.getItemCount()>1&&a.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");var e=this.contentSize.x,c=this._containerInnerSize.x,f=this.homeBounds.width,b=c/e*f;return d*b},imageToViewportZoom:function(e){this.viewer&&this.viewer.world.getItemCount()>1&&a.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");var d=this.contentSize.x,c=this._containerInnerSize.x,f=this.homeBounds.width,b=d/c/f;return e*b}}})(OpenSeadragon);(function(a){a.World=function(c){var b=this;a.console.assert(c.viewer,"[World] options.viewer is required");a.EventSource.call(this);this.viewer=c.viewer;this._items=[];this._needsDraw=false;this._autoRefigureSizes=true;this._needsSizesFigured=false;this._delegatedFigureSizes=function(){if(b._autoRefigureSizes)b._figureSizes();else b._needsSizesFigured=true};this._figureSizes()};a.extend(a.World.prototype,a.EventSource.prototype,{addItem:function(b,c){a.console.assert(b,"[World.addItem] item is required");a.console.assert(b instanceof a.TiledImage,"[World.addItem] only TiledImages supported at this time");c=c||{};if(c.index!==undefined){var d=Math.max(0,Math.min(this._items.length,c.index));this._items.splice(d,0,b)}else this._items.push(b);if(this._autoRefigureSizes)this._figureSizes();else this._needsSizesFigured=true;this._needsDraw=true;b.addHandler("bounds-change",this._delegatedFigureSizes);this.raiseEvent("add-item",{item:b})},getItemAt:function(b){a.console.assert(b!==undefined,"[World.getItemAt] index is required");return this._items[b]},getIndexOfItem:function(b){a.console.assert(b,"[World.getIndexOfItem] item is required");return a.indexOf(this._items,b)},getItemCount:function(){return this._items.length},setItemIndex:function(d,b){a.console.assert(d,"[World.setItemIndex] item is required");a.console.assert(b!==undefined,"[World.setItemIndex] index is required");var c=this.getIndexOfItem(d);if(b>=this._items.length)throw new Error("Index bigger than number of layers.");if(b===c||c===-1)return;this._items.splice(c,1);this._items.splice(b,0,d);this._needsDraw=true;this.raiseEvent("item-index-change",{item:d,previousIndex:c,newIndex:b})},removeItem:function(b){a.console.assert(b,"[World.removeItem] item is required");var c=a.indexOf(this._items,b);if(c===-1)return;b.removeHandler("bounds-change",this._delegatedFigureSizes);b.destroy();this._items.splice(c,1);this._figureSizes();this._needsDraw=true;this._raiseRemoveItem(b)},removeAll:function(){this.viewer._cancelPendingImages();for(var b,a=0;a<this._items.length;a++){b=this._items[a];b.removeHandler("bounds-change",this._delegatedFigureSizes);b.destroy()}var c=this._items;this._items=[];this._figureSizes();this._needsDraw=true;for(a=0;a<c.length;a++){b=c[a];this._raiseRemoveItem(b)}},resetItems:function(){for(var a=0;a<this._items.length;a++)this._items[a].reset()},update:function(){for(var a=false,b=0;b<this._items.length;b++)a=this._items[b].update()||a;return a},draw:function(){for(var a=0;a<this._items.length;a++)this._items[a].draw();this._needsDraw=false},needsDraw:function(){for(var a=0;a<this._items.length;a++)if(this._items[a].needsDraw())return true;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(a){this._autoRefigureSizes=a;if(a&this._needsSizesFigured){this._figureSizes();this._needsSizesFigured=false}},arrange:function(b){b=b||{};var l=b.immediately||false,p=b.layout||a.DEFAULT_SETTINGS.collectionLayout,r=b.rows||a.DEFAULT_SETTINGS.collectionRows,n=b.columns||a.DEFAULT_SETTINGS.collectionColumns,d=b.tileSize||a.DEFAULT_SETTINGS.collectionTileSize,q=b.tileMargin||a.DEFAULT_SETTINGS.collectionTileMargin,g=d+q,k;if(!b.rows&&n)k=n;else k=Math.ceil(this._items.length/r);var i=0,j=0,h,c,e,o,m;this.setAutoRefigureSizes(false);for(var f=0;f<this._items.length;f++){if(f&&f%k===0)if(p==="horizontal"){j+=g;i=0}else{i+=g;j=0}h=this._items[f];c=h.getBounds();if(c.width>c.height)e=d;else e=d*(c.width/c.height);o=e*(c.height/c.width);m=new a.Point(i+(d-e)/2,j+(d-o)/2);h.setPosition(m,l);h.setWidth(e,l);if(p==="horizontal")i+=g;else j+=g}this.setAutoRefigureSizes(true)},_figureSizes:function(){var k=this._homeBounds?this._homeBounds.clone():null,j=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(!this._items.length){this._homeBounds=new a.Rect(0,0,1,1);this._contentSize=new a.Point(1,1);this._contentFactor=1}else{var c=this._items[0].getBounds();this._contentFactor=this._items[0].getContentSize().x/c.width;for(var d=c.x,e=c.y,h=c.x+c.width,g=c.y+c.height,b,f=1;f<this._items.length;f++){b=this._items[f].getBounds();this._contentFactor=Math.max(this._contentFactor,this._items[f].getContentSize().x/b.width);d=Math.min(d,b.x);e=Math.min(e,b.y);h=Math.max(h,b.x+b.width);g=Math.max(g,b.y+b.height)}this._homeBounds=new a.Rect(d,e,h-d,g-e);this._contentSize=new a.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==i||!this._homeBounds.equals(k)||!this._contentSize.equals(j))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(a){this.raiseEvent("remove-item",{item:a})}})})(OpenSeadragon);